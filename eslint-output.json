[{"filePath":"C:\\Projects\\better-cloudflare\\e2e\\home.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\eslint.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\playwright.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\postcss.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\scripts\\check-spf.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\scripts\\cleanup-src-js.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\scripts\\debug-rbac-run.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[426,429],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[426,429],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[514,517],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[514,517],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[534,537],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[534,537],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[853,856],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[853,856],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[916,919],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[916,919],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1000,1003],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1000,1003],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":18,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":21,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1026,1029],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1026,1029],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":10,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":13,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1062,1065],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1062,1065],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1321,1324],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1321,1324],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":39,"column":70,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":73,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1523,1526],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1523,1526],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1680,1683],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1680,1683],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1714,1717],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1714,1717],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":133,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":136,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1818,1821],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1818,1821],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":59,"column":117,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":59,"endColumn":120,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2554,2557],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2554,2557],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":60,"column":107,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":110,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2666,2669],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2666,2669],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":60,"column":154,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":60,"endColumn":157,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2713,2716],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2713,2716],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2836,2839],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2836,2839],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":67,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":70,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3076,3079],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3076,3079],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":71,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":71,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3194,3197],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3194,3197],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\scripts\\migrate-vault-to-sqlite.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\scripts\\migrate-vault-to-sqlite.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[828,831],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[828,831],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"#!/usr/bin/env tsx\r\n/*\r\n * Migrate existing passkeys from vault to SQLite DB.\r\n */\r\nimport { vaultManager } from '../src/server/vault';\r\nimport path from 'path';\r\nimport openSqlite from '../src/lib/sqlite-driver';\r\n\r\nlet args = process.argv.slice(2);\r\nlet dbPath = path.resolve(process.cwd(), 'data', 'credentials.db');\r\nif (args.length && (args[0].includes('/') || args[0].includes('\\\\') || args[0].endsWith('.db'))) {\r\n  dbPath = args[0];\r\n  args = args.slice(1);\r\n}\r\nconst db = openSqlite(dbPath);\r\n\r\nasync function ensureSchema() {\r\n  await db.run(`CREATE TABLE IF NOT EXISTS credentials (\r\n    id TEXT NOT NULL,\r\n    credential_id TEXT NOT NULL,\r\n    public_key TEXT,\r\n    counter INTEGER DEFAULT 0,\r\n    created_at TEXT,\r\n    label TEXT,\r\n    PRIMARY KEY(id, credential_id)\r\n  )`);\r\n}\r\n\r\nfunction insert(id: string, cred: any) {\r\n  return db.run('INSERT OR REPLACE INTO credentials (id, credential_id, public_key, counter, created_at, label) VALUES (?, ?, ?, ?, ?, ?)', [\r\n    id,\r\n    cred.credentialID || cred.id,\r\n    cred.credentialPublicKey || cred.publicKey,\r\n    cred.counter ?? 0,\r\n    cred.createdAt ?? new Date().toISOString(),\r\n    cred.label ?? null\r\n  ]);\r\n}\r\n\r\n(async () => {\r\n  await ensureSchema();\r\n  // Warning: this uses the vault API, which may be keytar or memory.\r\n  // Iterate all ids - for vault we don't have an index, so accept `ids` as argv\r\n  const ids = args;\r\n  if (ids.length === 0) {\r\n    console.error('usage: migrate-vault-to-sqlite.ts <id> <id>... (dbPath optional)');\r\n    process.exit(1);\r\n  }\r\n  // if first arg looks like a path and exists as file, use it\r\n  const maybePath = ids[0];\r\n  if (maybePath.includes('/') || maybePath.includes('\\\\')) {\r\n    // treat as db path\r\n    // shift\r\n  }\r\n  for (const id of ids) {\r\n    const s = await vaultManager.getSecret(`passkey:${id}`);\r\n    if (!s) continue;\r\n    try {\r\n      const creds = JSON.parse(s);\r\n      for (const c of creds) await insert(id, c);\r\n      console.log(`Migrated ${creds.length} credentials for ${id}`);\r\n      // Optionally clear the vault: vaultManager.deleteSecret(`passkey:${id}`)\r\n    } catch (e) {\r\n      console.error('Invalid creds for', id, e);\r\n    }\r\n  }\r\n  process.exit(0);\r\n})();\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\scripts\\run-tests-seq.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\server.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\App.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\components\\auth\\AddKeyDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\components\\auth\\EditKeyDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\components\\auth\\EncryptionSettingsDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\components\\auth\\PasskeyManagerDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\components\\auth\\login-form.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 't'. Either include it or remove the dependency array.","line":76,"column":6,"nodeType":"ArrayExpression","endLine":76,"endColumn":22,"suggestions":[{"desc":"Update the dependencies array to be: [backend, t, toast]","fix":{"range":[3586,3602],"text":"[backend, t, toast]"}}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":214,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":214,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7818,7821],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7818,7821],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":223,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":223,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8271,8274],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8271,8274],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":249,"column":12,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":249,"endColumn":15,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9260,9263],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9260,9263],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":258,"column":73,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":258,"endColumn":76,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9695,9698],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9695,9698],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":259,"column":65,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":259,"endColumn":68,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9808,9811],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9808,9811],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":260,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":260,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9888,9891],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9888,9891],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":260,"column":99,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":260,"endColumn":102,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9947,9950],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9947,9950],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":264,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":264,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10107,10110],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10107,10110],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Login / Key selection UI used to open a session by decrypting a stored\r\n * API key and verifying it with the server.\r\n */\r\nimport { useState, useEffect } from 'react';\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\n\r\nimport { storageManager } from '@/lib/storage';\r\nimport { useCloudflareAPI } from '@/hooks/use-cloudflare-api';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { storageBackend } from '@/lib/storage-util';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { Key, Trash2, Pencil } from 'lucide-react';\r\nimport { cryptoManager } from '@/lib/crypto';\r\nimport { AddKeyDialog } from './AddKeyDialog';\r\nimport PasskeyManagerDialog from './PasskeyManagerDialog';\r\nimport { ServerClient } from '@/lib/server-client';\r\nimport { EncryptionSettingsDialog } from './EncryptionSettingsDialog';\r\nimport { EditKeyDialog } from './EditKeyDialog';\r\nimport type { ApiKey } from '@/types/dns';\r\n\r\n/**\r\n * Props for the login form used on the main page to select and decrypt\r\n * an API key and authenticate the user.\r\n */\r\ninterface LoginFormProps {\r\n  /** Callback invoked on successful login with the decrypted apiKey */\r\n  onLogin: (apiKey: string) => void;\r\n}\r\n\r\n/**\r\n * Login form component responsible for decrypting stored API keys and\r\n * verifying them with the server. On success the decrypted key is passed\r\n * via `onLogin` for the parent to use.\r\n */\r\nexport function LoginForm({ onLogin }: LoginFormProps) {\r\n  const [selectedKeyId, setSelectedKeyId] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [showAddKey, setShowAddKey] = useState(false);\r\n  const [showSettings, setShowSettings] = useState(false);\r\n  const [newKeyLabel, setNewKeyLabel] = useState('');\r\n  const [newApiKey, setNewApiKey] = useState('');\r\n  const [newEmail, setNewEmail] = useState('');\r\n  const [newPassword, setNewPassword] = useState('');\r\n  const [showEditKey, setShowEditKey] = useState(false);\r\n  const [editingKeyId, setEditingKeyId] = useState('');\r\n  const [editLabel, setEditLabel] = useState('');\r\n  const [editEmail, setEditEmail] = useState('');\r\n  const [currentPassword, setCurrentPassword] = useState('');\r\n  const [editPassword, setEditPassword] = useState('');\r\n  const [encryptionSettings, setEncryptionSettings] = useState(cryptoManager.getConfig());\r\n  const [benchmarkResult, setBenchmarkResult] = useState<number | null>(null);\r\n  const [passkeyRegisterLoading, setPasskeyRegisterLoading] = useState(false);\r\n  const [passkeyAuthLoading, setPasskeyAuthLoading] = useState(false);\r\n  const [showManagePasskeys, setShowManagePasskeys] = useState(false);\r\n  const [passkeyViewKey, setPasskeyViewKey] = useState('');\r\n  const [passkeyViewEmail, setPasskeyViewEmail] = useState<string | undefined>(undefined);\r\n  \r\n  const { toast } = useToast();\r\n  const { verifyToken } = useCloudflareAPI();\r\n  const [apiKeys, setApiKeys] = useState(storageManager.getApiKeys());\r\n  const backend = storageBackend();\r\n  const { t } = useTranslation();\r\n  useEffect(() => {\r\n    if (backend !== 'indexeddb') {\r\n      toast({\r\n        title: t('Note'),\r\n        description: `Using ${backend} storage. IndexedDB not available or in use. Some features may be limited.`,\r\n      });\r\n    }\r\n  }, [backend, toast]);\r\n\r\n  useEffect(() => {\r\n    cryptoManager.reloadConfig();\r\n    setEncryptionSettings(cryptoManager.getConfig());\r\n  }, []);\r\n\r\n  const handleLogin = async () => {\r\n    if (!selectedKeyId || !password) {\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Please select an API key and enter your password\",\r\n        variant: \"destructive\"\r\n      });\r\n      return;\r\n    }\r\n\r\n    setIsLoading(true);\r\n    try {\r\n      const decrypted = await storageManager.getDecryptedApiKey(selectedKeyId, password);\r\n      const decryptedKey = decrypted?.key;\r\n      const email = decrypted?.email;\r\n      if (!decryptedKey) {\r\n        toast({\r\n          title: \"Error\",\r\n          description: \"Invalid password or corrupted key\",\r\n          variant: \"destructive\"\r\n        });\r\n        return;\r\n      }\r\n\r\n      // Verify the API key works\r\n      try {\r\n        await verifyToken(decryptedKey, email);\r\n      } catch (err) {\r\n        toast({\r\n          title: \"Error\",\r\n          description: (err as Error).message,\r\n          variant: \"destructive\"\r\n        });\r\n        return;\r\n      }\r\n\r\n      storageManager.setCurrentSession(selectedKeyId);\r\n      onLogin(decryptedKey);\r\n      \r\n      toast({\r\n        title: \"Success\",\r\n        description: \"Logged in successfully\"\r\n      });\r\n    } catch (error) {\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to login: \" + (error as Error).message,\r\n        variant: \"destructive\"\r\n      });\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleAddKey = async () => {\r\n    if (!newKeyLabel || !newApiKey || !newPassword) {\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Please fill in all fields\",\r\n        variant: \"destructive\"\r\n      });\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Test the API key first\r\n      try {\r\n        await verifyToken(newApiKey, newEmail || undefined);\r\n      } catch (err) {\r\n        toast({\r\n          title: \"Error\",\r\n          description: (err as Error).message,\r\n          variant: \"destructive\"\r\n        });\r\n        return;\r\n      }\r\n\r\n      await storageManager.addApiKey(newKeyLabel, newApiKey, newPassword, newEmail || undefined);\r\n      setApiKeys(storageManager.getApiKeys());\r\n      setNewKeyLabel('');\r\n      setNewApiKey('');\r\n      setNewEmail('');\r\n      setNewPassword('');\r\n      setShowAddKey(false);\r\n      \r\n      toast({\r\n        title: \"Success\",\r\n        description: \"API key added successfully\"\r\n      });\r\n    } catch (error) {\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to add API key: \" + (error as Error).message,\r\n        variant: \"destructive\"\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleRegisterPasskey = async () => {\r\n    if (!selectedKeyId) {\r\n      toast({ title: 'Error', description: 'Select a key before registering a passkey', variant: 'destructive' });\r\n      return;\r\n    }\r\n\r\n    if (!password) {\r\n      toast({ title: 'Error', description: 'Enter your password to decrypt the key for registration', variant: 'destructive' });\r\n      return;\r\n    }\r\n\r\n    setPasskeyRegisterLoading(true);\r\n    try {\r\n      const decrypted = await storageManager.getDecryptedApiKey(selectedKeyId, password);\r\n      if (!decrypted?.key) {\r\n        toast({ title: 'Error', description: 'Invalid password or corrupted key', variant: 'destructive' });\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const sc = new ServerClient(decrypted.key, undefined, decrypted.email);\r\n        await sc.storeVaultSecret(selectedKeyId, decrypted.key);\r\n      } catch (err) {\r\n        toast({ title: 'Warning', description: 'Failed to store key to OS vault: ' + (err as Error).message });\r\n      }\r\n      const sc2 = new ServerClient(decrypted.key, undefined, decrypted.email);\r\n      const options = await sc2.getPasskeyRegistrationOptions(selectedKeyId);\r\n      const challenge = Uint8Array.from(atob(options.challenge), c => c.charCodeAt(0));\r\n      const publicKey = {\r\n        challenge,\r\n        rp: { name: 'Better Cloudflare' },\r\n        user: { id: Uint8Array.from(new TextEncoder().encode(selectedKeyId)), name: selectedKeyId, displayName: selectedKeyId },\r\n        pubKeyCredParams: [{ alg: -7, type: 'public-key' }],\r\n      } as any;\r\n      const credential = await navigator.credentials.create({ publicKey });\r\n      if (credential) {\r\n        const att = credential as PublicKeyCredential;\r\n        const attObj = {\r\n          id: att.id,\r\n          rawId: Array.from(new Uint8Array(att.rawId)),\r\n          response: {\r\n            clientDataJSON: Array.from(new Uint8Array(att.response.clientDataJSON)),\r\n            attestationObject: Array.from(new Uint8Array((att.response as any).attestationObject || new ArrayBuffer(0))),\r\n          },\r\n        };\r\n        await sc2.registerPasskey(selectedKeyId, attObj);\r\n        toast({ title: 'Success', description: 'Passkey registered to this key' });\r\n      }\r\n    } catch (error) {\r\n      toast({ title: 'Error', description: 'Passkey registration failed: ' + (error as Error).message, variant: 'destructive' });\r\n    } finally {\r\n      setPasskeyRegisterLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleUsePasskey = async () => {\r\n    if (!selectedKeyId) {\r\n      toast({ title: 'Error', description: 'Select a key to authenticate', variant: 'destructive' });\r\n      return;\r\n    }\r\n    setPasskeyAuthLoading(true);\r\n    try {\r\n      const scx = new ServerClient('', undefined);\r\n      const opts = await scx.getPasskeyAuthOptions(selectedKeyId);\r\n      const challenge = Uint8Array.from(atob(opts.challenge), c => c.charCodeAt(0));\r\n      const publicKey = {\r\n        challenge,\r\n        allowCredentials: [],\r\n      } as any;\r\n      const assertion = await navigator.credentials.get({ publicKey });\r\n      if (assertion) {\r\n        const a = assertion as PublicKeyCredential;\r\n        const auth = {\r\n          id: a.id,\r\n          rawId: Array.from(new Uint8Array(a.rawId)),\r\n          response: {\r\n            clientDataJSON: Array.from(new Uint8Array(a.response.clientDataJSON)),\r\n            authenticatorData: Array.from(new Uint8Array((a.response as any).authenticatorData || new ArrayBuffer(0))),\r\n            signature: Array.from(new Uint8Array((a.response as any).signature || new ArrayBuffer(0))),\r\n            userHandle: (a.response as any).userHandle ? Array.from(new Uint8Array((a.response as any).userHandle)) : null,\r\n          },\r\n        };\r\n        const serverResp = await scx.authenticatePasskey(selectedKeyId, auth);\r\n        if ((serverResp as any).success) {\r\n          const secret = await scx.getVaultSecret(selectedKeyId);\r\n          if (secret) {\r\n            storageManager.setCurrentSession(selectedKeyId);\r\n            onLogin(secret);\r\n            toast({ title: 'Success', description: 'Logged in using passkey' });\r\n          } else {\r\n            toast({ title: 'Error', description: 'No secret in vault for this key', variant: 'destructive' });\r\n          }\r\n        } else {\r\n          toast({ title: 'Error', description: 'Passkey authentication failed', variant: 'destructive' });\r\n        }\r\n      }\r\n    } catch (error) {\r\n      toast({ title: 'Error', description: 'Passkey auth failed: ' + (error as Error).message, variant: 'destructive' });\r\n    } finally {\r\n      setPasskeyAuthLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleEditKeyInit = (key: ApiKey) => {\r\n    setEditingKeyId(key.id);\r\n    setEditLabel(key.label);\r\n    setEditEmail(key.email || '');\r\n    setCurrentPassword('');\r\n    setEditPassword('');\r\n    setShowEditKey(true);\r\n  };\r\n\r\n  const handleUpdateKey = async () => {\r\n    if (!editingKeyId) return;\r\n    try {\r\n      await storageManager.updateApiKey(editingKeyId, {\r\n        label: editLabel,\r\n        email: editEmail || undefined,\r\n        currentPassword: currentPassword || undefined,\r\n        newPassword: editPassword || undefined,\r\n      });\r\n      setApiKeys(storageManager.getApiKeys());\r\n      setShowEditKey(false);\r\n      toast({\r\n        title: 'Success',\r\n        description: 'API key updated successfully',\r\n      });\r\n    } catch (error) {\r\n      toast({\r\n        title: 'Error',\r\n        description: 'Failed to update API key: ' + (error as Error).message,\r\n        variant: 'destructive',\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleDeleteKey = (keyId: string) => {\r\n    storageManager.removeApiKey(keyId);\r\n    setApiKeys(storageManager.getApiKeys());\r\n    if (selectedKeyId === keyId) {\r\n      setSelectedKeyId('');\r\n    }\r\n    toast({\r\n      title: \"Success\",\r\n      description: \"API key deleted\"\r\n    });\r\n  };\r\n\r\n  const handleBenchmark = async () => {\r\n    try {\r\n      const { benchmark } = await import('@/lib/crypto-benchmark');\r\n      const result = await benchmark(encryptionSettings.iterations);\r\n      setBenchmarkResult(result);\r\n      toast({\r\n        title: \"Benchmark Complete\",\r\n        description: `Encryption took ${result.toFixed(2)}ms`\r\n      });\r\n    } catch (error) {\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Benchmark failed: \" + (error as Error).message,\r\n        variant: \"destructive\"\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleUpdateSettings = () => {\r\n    cryptoManager.updateConfig(encryptionSettings);\r\n    toast({\r\n      title: \"Success\",\r\n      description: \"Encryption settings updated\"\r\n    });\r\n    setShowSettings(false);\r\n  };\r\n\r\n  const [vaultEnabled, setVaultEnabled] = useState(storageManager.getVaultEnabled());\r\n\r\n  return (\r\n    <div className=\"min-h-screen flex items-center justify-center bg-background p-4\">\r\n      <Card className=\"w-full max-w-md\">\r\n        <CardHeader className=\"text-center\">\r\n          <div className=\"flex justify-center mb-4\">\r\n            <div className=\"p-3 bg-primary/10 rounded-full\">\r\n              <Key className=\"h-8 w-8 text-primary\" />\r\n            </div>\r\n          </div>\r\n          <CardTitle className=\"text-2xl\">{t('Cloudflare DNS Manager')}</CardTitle>\r\n          <CardDescription>\r\n            {t('Select your API key and enter your password to continue')}\r\n          </CardDescription>\r\n        </CardHeader>\r\n        <CardContent className=\"space-y-4\">\r\n          <div className=\"space-y-2\">\r\n            <Label htmlFor=\"api-key\">{t('API Key')}</Label>\r\n            <Select value={selectedKeyId} onValueChange={setSelectedKeyId}>\r\n              <SelectTrigger>\r\n              <SelectValue placeholder={t('Select an API key')} />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                {apiKeys.map((key) => (\r\n                  <SelectItem key={key.id} value={key.id}>\r\n                    <div className=\"flex items-center justify-between w-full\">\r\n                      <span>{key.label}</span>\r\n                      <div className=\"flex\">\r\n                        <Button\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                          onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            handleEditKeyInit(key);\r\n                          }}\r\n                          className=\"h-6 w-6 p-0 ml-2\"\r\n                        >\r\n                          <Pencil className=\"h-3 w-3\" />\r\n                        </Button>\r\n                        <Button\r\n                          variant=\"ghost\"\r\n                          size=\"sm\"\r\n                          onClick={(e) => {\r\n                            e.stopPropagation();\r\n                            handleDeleteKey(key.id);\r\n                          }}\r\n                          className=\"h-6 w-6 p-0 ml-2\"\r\n                        >\r\n                          <Trash2 className=\"h-3 w-3\" />\r\n                        </Button>\r\n                      </div>\r\n                    </div>\r\n                  </SelectItem>\r\n                ))}\r\n              </SelectContent>\r\n            </Select>\r\n          </div>\r\n\r\n          <div className=\"space-y-2\">\r\n              <Label htmlFor=\"password\">{t('Password')}</Label>\r\n            <Input\r\n              id=\"password\"\r\n              type=\"password\"\r\n              value={password}\r\n              onChange={(e) => setPassword(e.target.value)}\r\n                  placeholder={t('Enter your password')}\r\n              onKeyDown={(e) => e.key === 'Enter' && handleLogin()}\r\n            />\r\n          </div>\r\n\r\n          <Button \r\n            onClick={handleLogin} \r\n            className=\"w-full\" \r\n            disabled={isLoading || !selectedKeyId || !password}\r\n          >\r\n            {isLoading ? t('Logging in...') : t('Login')}\r\n          </Button>\r\n\r\n          <div className=\"flex gap-2\">\r\n          <AddKeyDialog\r\n            open={showAddKey}\r\n            onOpenChange={setShowAddKey}\r\n            label={newKeyLabel}\r\n            onLabelChange={setNewKeyLabel}\r\n            apiKey={newApiKey}\r\n            onApiKeyChange={setNewApiKey}\r\n            email={newEmail}\r\n            onEmailChange={setNewEmail}\r\n            password={newPassword}\r\n            onPasswordChange={setNewPassword}\r\n            onAdd={handleAddKey}\r\n          />\r\n\r\n            <EncryptionSettingsDialog\r\n              open={showSettings}\r\n              onOpenChange={setShowSettings}\r\n              settings={encryptionSettings}\r\n              onSettingsChange={setEncryptionSettings}\r\n              onBenchmark={handleBenchmark}\r\n              onUpdate={handleUpdateSettings}\r\n              benchmarkResult={benchmarkResult}\r\n              vaultEnabled={vaultEnabled}\r\n              onVaultEnabledChange={(enabled: boolean) => {\r\n                setVaultEnabled(enabled);\r\n                storageManager.setVaultEnabled(enabled);\r\n              }}\r\n            />\r\n            <Button\r\n              variant=\"outline\"\r\n              size=\"sm\"\r\n              onClick={handleRegisterPasskey}\r\n              disabled={!selectedKeyId || !password || passkeyRegisterLoading}\r\n            >\r\n              {passkeyRegisterLoading ? 'Registering...' : 'Register Passkey'}\r\n            </Button>\r\n            <PasskeyManagerDialog\r\n              open={showManagePasskeys}\r\n              onOpenChange={(open: boolean) => {\r\n                if (!open) {\r\n                  setShowManagePasskeys(false);\r\n                  setPasskeyViewKey('');\r\n                  setPasskeyViewEmail(undefined);\r\n                } else {\r\n                  setShowManagePasskeys(true);\r\n                }\r\n              }}\r\n              id={selectedKeyId}\r\n              apiKey={passkeyViewKey}\r\n              email={passkeyViewEmail}\r\n            />\r\n            <Button\r\n              variant=\"outline\"\r\n              size=\"sm\"\r\n              onClick={async () => {\r\n                if (!selectedKeyId || !password) return;\r\n                try {\r\n                  const decrypted = await storageManager.getDecryptedApiKey(selectedKeyId, password);\r\n                  if (!decrypted?.key) {\r\n                    toast({ title: 'Error', description: 'Invalid password', variant: 'destructive' });\r\n                    return;\r\n                  }\r\n                  setPasskeyViewKey(decrypted.key);\r\n                  setPasskeyViewEmail(decrypted.email);\r\n                  setShowManagePasskeys(true);\r\n                } catch (err) {\r\n                  toast({ title: 'Error', description: 'Failed to decrypt key: ' + (err as Error).message, variant: 'destructive' });\r\n                }\r\n              }}\r\n              disabled={!selectedKeyId || !password}\r\n            >\r\n              Manage Passkeys\r\n            </Button>\r\n            <Button\r\n              variant=\"outline\"\r\n              size=\"sm\"\r\n              onClick={handleUsePasskey}\r\n              disabled={!selectedKeyId || passkeyAuthLoading}\r\n            >\r\n              {passkeyAuthLoading ? 'Authenticating...' : 'Use Passkey'}\r\n            </Button>\r\n            {vaultEnabled && (\r\n              <Button\r\n                variant=\"destructive\"\r\n                size=\"sm\"\r\n                onClick={async () => {\r\n                  if (!selectedKeyId || !password) {\r\n                    toast({ title: t('Error'), description: t('Select key and enter password to delete vault secret'), variant: 'destructive' });\r\n                    return;\r\n                  }\r\n                  try {\r\n                    const dec = await storageManager.getDecryptedApiKey(selectedKeyId, password);\r\n                    if (!dec?.key) {\r\n                      toast({ title: t('Error'), description: t('Invalid password'), variant: 'destructive' });\r\n                      return;\r\n                    }\r\n                    const sc = new ServerClient(dec.key, undefined, dec.email);\r\n                    await sc.deleteVaultSecret(selectedKeyId);\r\n                    toast({ title: t('Success'), description: t('Vault secret removed') });\r\n                  } catch (err) {\r\n                    toast({ title: t('Error'), description: t('Failed to remove vault secret: ') + (err as Error).message, variant: 'destructive' });\r\n                  }\r\n                }}\r\n              >\r\n                Remove Vault Secret\r\n              </Button>\r\n            )}\r\n          </div>\r\n          <EditKeyDialog\r\n            open={showEditKey}\r\n            onOpenChange={setShowEditKey}\r\n            label={editLabel}\r\n            onLabelChange={setEditLabel}\r\n            email={editEmail}\r\n            onEmailChange={setEditEmail}\r\n            currentPassword={currentPassword}\r\n            onCurrentPasswordChange={setCurrentPassword}\r\n            newPassword={editPassword}\r\n            onNewPasswordChange={setEditPassword}\r\n            onSave={handleUpdateKey}\r\n          />\r\n        </CardContent>\r\n      </Card>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\components\\dns\\AddRecordDialog.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'parseNAPTR', 'parseSSHFP', and 'parseTLSA'. Either include them or remove the dependency array.","line":163,"column":6,"nodeType":"ArrayExpression","endLine":163,"endColumn":35,"suggestions":[{"desc":"Update the dependencies array to be: [record.type, record.content, parseTLSA, parseSSHFP, parseNAPTR]","fix":{"range":[8815,8844],"text":"[record.type, record.content, parseTLSA, parseSSHFP, parseNAPTR]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Dialog used to collect DNS record properties required to create a new\r\n * record via the API.\r\n */\r\nimport type { ChangeEvent } from 'react';\r\nimport { useEffect, useState, useCallback } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Switch } from '@/components/ui/switch';\r\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\r\nimport type { DNSRecord, RecordType, TTLValue } from '@/types/dns';\r\nimport { parseSPF, composeSPF, validateSPF } from '@/lib/spf';\r\nimport type { SPFGraph, SPFMechanism } from '@/lib/spf';\r\nimport { useCloudflareAPI } from '@/hooks/use-cloudflare-api';\r\nimport { RECORD_TYPES, getTTLPresets, getRecordTypeLabel } from '@/types/dns';\r\nimport { Plus } from 'lucide-react';\r\n\r\n/**\r\n * Props for the AddRecordDialog component which collects fields to create a\r\n * new DNS record (type, name, content, ttl, etc.).\r\n */\r\nexport interface AddRecordDialogProps {\r\n  /** Whether the dialog is currently open */\r\n  open: boolean;\r\n  /** Callback invoked when open state changes (open/close) */\r\n  onOpenChange: (open: boolean) => void;\r\n  /** Working DNS record object for the form */\r\n  record: Partial<DNSRecord>;\r\n  /** Called when fields in the form change with the updated record */\r\n  onRecordChange: (record: Partial<DNSRecord>) => void;\r\n  /** Called to create the new record */\r\n  onAdd: () => void;\r\n  /** Optional name of the zone to display in the dialog */\r\n  zoneName?: string;\r\n  apiKey?: string;\r\n  email?: string;\r\n}\r\n\r\n/**\r\n * Dialog that collects fields to create a DNS record and forwards the\r\n * create action via `onAdd`.\r\n */\r\nexport function AddRecordDialog({ open, onOpenChange, record, onRecordChange, onAdd, zoneName, apiKey, email }: AddRecordDialogProps) {\r\n  const { simulateSPF, getSPFGraph } = useCloudflareAPI(apiKey, email);\r\n  const ttlValue = record.ttl === 1 ? 'auto' : record.ttl;\r\n  const isCustomTTL = ttlValue !== undefined && !getTTLPresets().includes(ttlValue as TTLValue);\r\n  // SRV fields (priority weight port target) parsed from record.content\r\n  const parseSRV = useCallback((content?: string) => {\r\n    if (!content) return { priority: undefined, weight: undefined, port: undefined, target: '' };\r\n    const parts = String(content).trim().split(/\\s+/);\r\n    if (parts.length < 4) return { priority: undefined, weight: undefined, port: undefined, target: content };\r\n    const [priority, weight, port, ...rest] = parts;\r\n    return { priority: Number(priority), weight: Number(weight), port: Number(port), target: rest.join(' ') };\r\n  }, [] as const);\r\n  const composeSRV = (p?: number, w?: number, prt?: number, t?: string) => `${p ?? 0} ${w ?? 0} ${prt ?? 0} ${t ?? ''}`;\r\n  const [srvPriority, setSrvPriority] = useState<number | undefined>(parseSRV(record.content).priority);\r\n  const [srvWeight, setSrvWeight] = useState<number | undefined>(parseSRV(record.content).weight);\r\n  const [srvPort, setSrvPort] = useState<number | undefined>(parseSRV(record.content).port);\r\n  const [srvTarget, setSrvTarget] = useState<string>(parseSRV(record.content).target ?? '');\r\n  // TLSA fields (usage selector matchingType data)\r\n  const parseTLSA = useCallback((content?: string) => {\r\n    if (!content) return { usage: undefined, selector: undefined, matchingType: undefined, data: '' };\r\n    const parts = String(content).trim().split(/\\s+/);\r\n    if (parts.length < 4) return { usage: undefined, selector: undefined, matchingType: undefined, data: content };\r\n    const [usage, selector, matchingType, ...rest] = parts;\r\n    return { usage: Number(usage), selector: Number(selector), matchingType: Number(matchingType), data: rest.join(' ') };\r\n  }, [] as const);\r\n  const composeTLSA = (u?: number, s?: number, m?: number, d?: string) => `${u ?? 0} ${s ?? 0} ${m ?? 0} ${d ?? ''}`;\r\n  const [tlsaUsage, setTlsaUsage] = useState<number | undefined>(parseTLSA(record.content).usage);\r\n  const [tlsaSelector, setTlsaSelector] = useState<number | undefined>(parseTLSA(record.content).selector);\r\n  const [tlsaMatchingType, setTlsaMatchingType] = useState<number | undefined>(parseTLSA(record.content).matchingType);\r\n  const [tlsaData, setTlsaData] = useState<string>(parseTLSA(record.content).data ?? '');\r\n  // SSHFP fields (algorithm, fptype, fingerprint)\r\n  const parseSSHFP = useCallback((content?: string) => {\r\n    if (!content) return { algorithm: undefined, fptype: undefined, fingerprint: '' };\r\n    const parts = String(content).trim().split(/\\s+/);\r\n    if (parts.length < 3) return { algorithm: undefined, fptype: undefined, fingerprint: content };\r\n    const [algorithm, fptype, ...rest] = parts;\r\n    return { algorithm: Number(algorithm), fptype: Number(fptype), fingerprint: rest.join(' ') };\r\n  }, [] as const);\r\n  const composeSSHFP = (a?: number, f?: number, fp?: string) => `${a ?? 0} ${f ?? 0} ${fp ?? ''}`;\r\n  const [sshfpAlgorithm, setSshfpAlgorithm] = useState<number | undefined>(parseSSHFP(record.content).algorithm);\r\n  const [sshfpFptype, setSshfpFptype] = useState<number | undefined>(parseSSHFP(record.content).fptype);\r\n  const [sshfpFingerprint, setSshfpFingerprint] = useState<string>(parseSSHFP(record.content).fingerprint ?? '');\r\n  const splitNaptrTokens = useCallback((s: string) => {\r\n    const tokens: string[] = [];\r\n    let current = '';\r\n    let inQuote = false;\r\n    for (let i = 0; i < s.length; i++) {\r\n      const ch = s[i];\r\n      if (ch === '\"') {\r\n        inQuote = !inQuote;\r\n        current += ch;\r\n        continue;\r\n      }\r\n      if (ch === ' ' && !inQuote) {\r\n        if (current.trim().length > 0) {\r\n          tokens.push(current.trim());\r\n          current = '';\r\n        }\r\n        continue;\r\n      }\r\n      current += ch;\r\n    }\r\n    if (current.trim().length > 0) tokens.push(current.trim());\r\n    return tokens;\r\n  }, [] as const);\r\n\r\n  const parseNAPTR = useCallback((content?: string) => {\r\n    if (!content) return { order: undefined, preference: undefined, flags: '', service: '', regexp: '', replacement: '' };\r\n    const tokens = splitNaptrTokens(String(content).trim());\r\n    const [order, preference, flags, service, regexp, replacement] = tokens;\r\n    return { order: Number(order), preference: Number(preference), flags: flags?.replace(/^\"|\"$/g, ''), service, regexp: regexp?.replace(/^\"|\"$/g, ''), replacement };\r\n  }, [splitNaptrTokens] as const);\r\n  const quoteIfNeeded = (s?: string) => {\r\n    if (!s) return '';\r\n    if (/\\s/.test(s) || /\"/.test(s)) return `\"${s.replace(/\"/g, '\\\\\"')}\"`;\r\n    return s;\r\n  };\r\n  const composeNAPTR = (o?: number, p?: number, f?: string, s?: string, r?: string, rep?: string) => `${o ?? 0} ${p ?? 0} ${f ?? ''} ${s ?? ''} ${quoteIfNeeded(r)} ${rep ?? ''}`;\r\n  const [naptrOrder, setNaptrOrder] = useState<number | undefined>(parseNAPTR(record.content).order);\r\n  const [naptrPref, setNaptrPref] = useState<number | undefined>(parseNAPTR(record.content).preference);\r\n  const [naptrFlags, setNaptrFlags] = useState<string>(parseNAPTR(record.content).flags ?? '');\r\n  const [naptrService, setNaptrService] = useState<string>(parseNAPTR(record.content).service ?? '');\r\n  const [naptrRegexp, setNaptrRegexp] = useState<string>(parseNAPTR(record.content).regexp ?? '');\r\n  const [naptrReplacement, setNaptrReplacement] = useState<string>(parseNAPTR(record.content).replacement ?? '');\r\n\r\n  useEffect(() => {\r\n    if (record.type === 'SRV') {\r\n      const parsed = parseSRV(record.content);\r\n      setSrvPriority(parsed.priority);\r\n      setSrvWeight(parsed.weight);\r\n      setSrvPort(parsed.port);\r\n      setSrvTarget(parsed.target ?? '');\r\n    }\r\n  }, [record.type, record.content, parseNAPTR, parseSSHFP, parseTLSA, parseSRV]);\r\n  useEffect(() => {\r\n    if (record.type === 'TLSA') {\r\n      const parsed = parseTLSA(record.content);\r\n      setTlsaUsage(parsed.usage);\r\n      setTlsaSelector(parsed.selector);\r\n      setTlsaMatchingType(parsed.matchingType);\r\n      setTlsaData(parsed.data ?? '');\r\n    }\r\n    if (record.type === 'SSHFP') {\r\n      const parsed = parseSSHFP(record.content);\r\n      setSshfpAlgorithm(parsed.algorithm);\r\n      setSshfpFptype(parsed.fptype);\r\n      setSshfpFingerprint(parsed.fingerprint ?? '');\r\n    }\r\n    if (record.type === 'NAPTR') {\r\n      const parsed = parseNAPTR(record.content);\r\n      setNaptrOrder(parsed.order);\r\n      setNaptrPref(parsed.preference);\r\n      setNaptrFlags(parsed.flags ?? '');\r\n      setNaptrService(parsed.service ?? '');\r\n      setNaptrRegexp(parsed.regexp ?? '');\r\n      setNaptrReplacement(parsed.replacement ?? '');\r\n    }\r\n    // SSHFP state managed similarly below\r\n  }, [record.type, record.content]);\r\n\r\n  // SPF state and builder\r\n  const parsedSPF = parseSPF(record.content);\r\n  const [newSPFQualifier, setNewSPFQualifier] = useState<string>('');\r\n  const [newSPFMechanism, setNewSPFMechanism] = useState<string>('ip4');\r\n  const [newSPFValue, setNewSPFValue] = useState<string>('');\r\n  const [editingSPFIndex, setEditingSPFIndex] = useState<number | null>(null);\r\n  const [spfSimIp, setSpfSimIp] = useState<string>('');\r\n  const [spfSimResult, setSpfSimResult] = useState<{ result: string; reasons: string[]; lookups: number } | null>(null);\r\n  const [spfGraph, setSpfGraph] = useState<SPFGraph | null>(null);\r\n  const [spfGraphError, setSpfGraphError] = useState<string | null>(null);\r\n\r\n  const addSPFMechanism = () => {\r\n    const mechVal = newSPFValue?.trim();\r\n    const newMech: SPFMechanism = { qualifier: newSPFQualifier || undefined, mechanism: newSPFMechanism as unknown as string, value: mechVal || undefined } as SPFMechanism;\r\n    const parsed = parseSPF(record.content) ?? { version: 'v=spf1', mechanisms: [] };\r\n    const mechs = [...parsed.mechanisms];\r\n    if (editingSPFIndex !== null && editingSPFIndex >= 0 && editingSPFIndex < mechs.length) {\r\n      mechs[editingSPFIndex] = newMech;\r\n      setEditingSPFIndex(null);\r\n    } else {\r\n      mechs.push(newMech);\r\n    }\r\n    const updated = composeSPF({ version: parsed.version, mechanisms: mechs as SPFMechanism[] });\r\n    onRecordChange({ ...record, content: updated });\r\n    // reset form\r\n    setNewSPFValue('');\r\n    setNewSPFQualifier('');\r\n    setNewSPFMechanism('ip4');\r\n  };\r\n\r\n  const removeSPFMechanism = (index: number) => {\r\n    const parsed = parseSPF(record.content) ?? { version: 'v=spf1', mechanisms: [] };\r\n    const mechs = [...parsed.mechanisms];\r\n    mechs.splice(index, 1);\r\n    const updated = composeSPF({ version: parsed.version, mechanisms: mechs as SPFMechanism[] });\r\n    onRecordChange({ ...record, content: updated });\r\n  };\r\n\r\n  const editSPFMechanism = (index: number) => {\r\n    const parsed = parseSPF(record.content) ?? { version: 'v=spf1', mechanisms: [] };\r\n    const m = parsed.mechanisms[index];\r\n    setNewSPFQualifier(m.qualifier || '');\r\n    setNewSPFMechanism(m.mechanism || 'ip4');\r\n    setNewSPFValue(m.value || '');\r\n    setEditingSPFIndex(index);\r\n  };\r\n\r\n  return (\r\n    <Dialog open={open} onOpenChange={onOpenChange}>\r\n      <DialogTrigger asChild>\r\n        <Button>\r\n          <Plus className=\"h-4 w-4 mr-2\" />\r\n          Add Record\r\n        </Button>\r\n      </DialogTrigger>\r\n      <DialogContent>\r\n        <DialogHeader>\r\n          <DialogTitle>Add DNS Record</DialogTitle>\r\n          <DialogDescription>\r\n            Create a new DNS record for {zoneName}\r\n          </DialogDescription>\r\n        </DialogHeader>\r\n        <div className=\"space-y-4\">\r\n          <div className=\"grid grid-cols-2 gap-4\">\r\n            <div className=\"space-y-2\">\r\n              <Label>Type</Label>\r\n              <Select\r\n                value={record.type}\r\n                onValueChange={(value: string) =>\r\n                  onRecordChange({\r\n                    ...record,\r\n                    type: value as RecordType,\r\n                    priority: value === 'MX' ? record.priority : undefined\r\n                  })\r\n                }\r\n              >\r\n                <SelectTrigger>\r\n                  <SelectValue />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  {RECORD_TYPES.map((type) => (\r\n                    <SelectItem key={type} value={type} title={getRecordTypeLabel(type)}>\r\n                      {getRecordTypeLabel(type)}\r\n                    </SelectItem>\r\n                  ))}\r\n                </SelectContent>\r\n              </Select>\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <Label>TTL</Label>\r\n              <Select\r\n                value={isCustomTTL ? 'custom' : String(ttlValue)}\r\n                onValueChange={(value: string) => {\r\n                  if (value === 'custom') {\r\n                    onRecordChange({ ...record, ttl: 300 });\r\n                  } else {\r\n                    onRecordChange({\r\n                      ...record,\r\n                      ttl: value === 'auto' ? 'auto' : Number(value)\r\n                    });\r\n                  }\r\n                }}\r\n              >\r\n                <SelectTrigger>\r\n                  <SelectValue />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  {getTTLPresets().map((ttl) => (\r\n                    <SelectItem key={ttl} value={String(ttl)}>\r\n                      {ttl === 'auto' ? 'Auto' : ttl}\r\n                    </SelectItem>\r\n                  ))}\r\n                  <SelectItem value=\"custom\">Custom</SelectItem>\r\n                </SelectContent>\r\n              </Select>\r\n              {isCustomTTL && (\r\n                <Input\r\n                  type=\"number\"\r\n                  value={typeof record.ttl === 'number' ? record.ttl : ''}\r\n                  onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                    const n = Number.parseInt(e.target.value, 10);\r\n                    onRecordChange({\r\n                      ...record,\r\n                      ttl: Number.isNaN(n) ? 300 : n\r\n                    });\r\n                  }}\r\n                />\r\n              )}\r\n            </div>\r\n          </div>\r\n          <div className=\"space-y-2\">\r\n            <Label>Name</Label>\r\n            <Input\r\n              value={record.name}\r\n              onChange={(e: ChangeEvent<HTMLInputElement>) => onRecordChange({\r\n                ...record,\r\n                name: e.target.value\r\n              })}\r\n              placeholder=\"e.g., www or @ for root\"\r\n            />\r\n          </div>\r\n          <div className=\"space-y-2\">\r\n            <Label>Content</Label>\r\n            {(() => {\r\n              switch (record.type) {\r\n                case 'SRV':\r\n                  return (\r\n                    <div className=\"grid grid-cols-4 gap-2\">\r\n                      <Input\r\n                        type=\"number\"\r\n                        placeholder=\"priority\"\r\n                        value={srvPriority ?? ''}\r\n                        onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                          const n = Number.parseInt(e.target.value, 10);\r\n                          setSrvPriority(Number.isNaN(n) ? undefined : n);\r\n                          onRecordChange({ ...record, content: composeSRV(Number.isNaN(n) ? undefined : n, srvWeight, srvPort, srvTarget) });\r\n                        }}\r\n                      />\r\n                      <Input\r\n                        type=\"number\"\r\n                        placeholder=\"weight\"\r\n                        value={srvWeight ?? ''}\r\n                        onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                          const n = Number.parseInt(e.target.value, 10);\r\n                          setSrvWeight(Number.isNaN(n) ? undefined : n);\r\n                          onRecordChange({ ...record, content: composeSRV(srvPriority, Number.isNaN(n) ? undefined : n, srvPort, srvTarget) });\r\n                        }}\r\n                      />\r\n                      <Input\r\n                        type=\"number\"\r\n                        placeholder=\"port\"\r\n                        value={srvPort ?? ''}\r\n                        onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                          const n = Number.parseInt(e.target.value, 10);\r\n                          setSrvPort(Number.isNaN(n) ? undefined : n);\r\n                          onRecordChange({ ...record, content: composeSRV(srvPriority, srvWeight, Number.isNaN(n) ? undefined : n, srvTarget) });\r\n                        }}\r\n                      />\r\n                      <Input\r\n                        placeholder=\"target\"\r\n                        value={srvTarget}\r\n                        onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                          setSrvTarget(e.target.value);\r\n                          onRecordChange({ ...record, content: composeSRV(srvPriority, srvWeight, srvPort, e.target.value) });\r\n                        }}\r\n                      />\r\n                    </div>\r\n                  );\r\n                case 'TLSA':\r\n                  return (\r\n                    <div className=\"grid grid-cols-4 gap-2\">\r\n                      <Input\r\n                        type=\"number\"\r\n                        placeholder=\"usage\"\r\n                        value={tlsaUsage ?? ''}\r\n                        onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                          const n = Number.parseInt(e.target.value, 10);\r\n                          const val = Number.isNaN(n) ? undefined : n;\r\n                          setTlsaUsage(val);\r\n                          onRecordChange({ ...record, content: composeTLSA(val, tlsaSelector, tlsaMatchingType, tlsaData) });\r\n                        }}\r\n                      />\r\n                      <Input\r\n                        type=\"number\"\r\n                        placeholder=\"selector\"\r\n                        value={tlsaSelector ?? ''}\r\n                        onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                          const n = Number.parseInt(e.target.value, 10);\r\n                          const val = Number.isNaN(n) ? undefined : n;\r\n                          setTlsaSelector(val);\r\n                          onRecordChange({ ...record, content: composeTLSA(tlsaUsage, val, tlsaMatchingType, tlsaData) });\r\n                        }}\r\n                      />\r\n                      <Input\r\n                        type=\"number\"\r\n                        placeholder=\"matching type\"\r\n                        value={tlsaMatchingType ?? ''}\r\n                        onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                          const n = Number.parseInt(e.target.value, 10);\r\n                          const val = Number.isNaN(n) ? undefined : n;\r\n                          setTlsaMatchingType(val);\r\n                          onRecordChange({ ...record, content: composeTLSA(tlsaUsage, tlsaSelector, val, tlsaData) });\r\n                        }}\r\n                      />\r\n                      <Input\r\n                        placeholder=\"data\"\r\n                        value={tlsaData}\r\n                        onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                          setTlsaData(e.target.value);\r\n                          onRecordChange({ ...record, content: composeTLSA(tlsaUsage, tlsaSelector, tlsaMatchingType, e.target.value) });\r\n                        }}\r\n                      />\r\n                    </div>\r\n                  );\r\n                case 'SSHFP':\r\n                  return (\r\n                    <div className=\"grid grid-cols-3 gap-2\">\r\n                      <Input\r\n                        type=\"number\"\r\n                        placeholder=\"algorithm\"\r\n                        value={sshfpAlgorithm ?? ''}\r\n                        onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                          const n = Number.parseInt(e.target.value, 10);\r\n                          const val = Number.isNaN(n) ? undefined : n;\r\n                          setSshfpAlgorithm(val);\r\n                          onRecordChange({ ...record, content: composeSSHFP(val, sshfpFptype, sshfpFingerprint) });\r\n                        }}\r\n                      />\r\n                      <Input\r\n                        type=\"number\"\r\n                        placeholder=\"fptype\"\r\n                        value={sshfpFptype ?? ''}\r\n                        onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                          const n = Number.parseInt(e.target.value, 10);\r\n                          const val = Number.isNaN(n) ? undefined : n;\r\n                          setSshfpFptype(val);\r\n                          onRecordChange({ ...record, content: composeSSHFP(sshfpAlgorithm, val, sshfpFingerprint) });\r\n                        }}\r\n                      />\r\n                      <Input\r\n                        placeholder=\"fingerprint\"\r\n                        value={sshfpFingerprint}\r\n                        onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                          setSshfpFingerprint(e.target.value);\r\n                          onRecordChange({ ...record, content: composeSSHFP(sshfpAlgorithm, sshfpFptype, e.target.value) });\r\n                        }}\r\n                      />\r\n                    </div>\r\n                  );\r\n                case 'NAPTR':\r\n                  return (\r\n                    <div className=\"grid grid-cols-6 gap-2\">\r\n                      <Input\r\n                        type=\"number\"\r\n                        placeholder=\"order\"\r\n                        value={naptrOrder ?? ''}\r\n                        onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                          const n = Number.parseInt(e.target.value, 10);\r\n                          const val = Number.isNaN(n) ? undefined : n;\r\n                          setNaptrOrder(val);\r\n                          onRecordChange({ ...record, content: composeNAPTR(val, naptrPref, naptrFlags, naptrService, naptrRegexp, naptrReplacement) });\r\n                        }}\r\n                      />\r\n                      <Input\r\n                        type=\"number\"\r\n                        placeholder=\"preference\"\r\n                        value={naptrPref ?? ''}\r\n                        onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                          const n = Number.parseInt(e.target.value, 10);\r\n                          const val = Number.isNaN(n) ? undefined : n;\r\n                          setNaptrPref(val);\r\n                          onRecordChange({ ...record, content: composeNAPTR(naptrOrder, val, naptrFlags, naptrService, naptrRegexp, naptrReplacement) });\r\n                        }}\r\n                      />\r\n                      <Input\r\n                        placeholder=\"flags\"\r\n                        value={naptrFlags}\r\n                        onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                          setNaptrFlags(e.target.value);\r\n                          onRecordChange({ ...record, content: composeNAPTR(naptrOrder, naptrPref, e.target.value, naptrService, naptrRegexp, naptrReplacement) });\r\n                        }}\r\n                      />\r\n                      <Input\r\n                        placeholder=\"service\"\r\n                        value={naptrService}\r\n                        onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                          setNaptrService(e.target.value);\r\n                          onRecordChange({ ...record, content: composeNAPTR(naptrOrder, naptrPref, naptrFlags, e.target.value, naptrRegexp, naptrReplacement) });\r\n                        }}\r\n                      />\r\n                      <Input\r\n                        placeholder=\"regexp\"\r\n                        value={naptrRegexp}\r\n                        onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                          setNaptrRegexp(e.target.value);\r\n                          onRecordChange({ ...record, content: composeNAPTR(naptrOrder, naptrPref, naptrFlags, naptrService, e.target.value, naptrReplacement) });\r\n                        }}\r\n                      />\r\n                      <Input\r\n                        placeholder=\"replacement\"\r\n                        value={naptrReplacement}\r\n                        onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                          setNaptrReplacement(e.target.value);\r\n                          onRecordChange({ ...record, content: composeNAPTR(naptrOrder, naptrPref, naptrFlags, naptrService, naptrRegexp, e.target.value) });\r\n                        }}\r\n                      />\r\n                    </div>\r\n                  );\r\n                case 'SPF':\r\n                  return (\r\n                    <div className=\"space-y-2\">\r\n                      <Input\r\n                        value={record.content}\r\n                        onChange={(e: ChangeEvent<HTMLInputElement>) => onRecordChange({\r\n                          ...record,\r\n                          content: e.target.value\r\n                        })}\r\n                        placeholder=\"v=spf1 ip4:... ~all\"\r\n                      />\r\n                      <div className=\"flex space-x-2\">\r\n                        <select className=\"h-8 p-2\" value={newSPFQualifier} onChange={(e) => setNewSPFQualifier(e.target.value)}>\r\n                          <option value=\"\">+</option>\r\n                          <option value=\"-\">-</option>\r\n                          <option value=\"~\">~</option>\r\n                          <option value=\"?\">?</option>\r\n                        </select>\r\n                        <select className=\"h-8 p-2\" value={newSPFMechanism} onChange={(e) => setNewSPFMechanism(e.target.value)}>\r\n                          <option value=\"ip4\">ip4</option>\r\n                          <option value=\"ip6\">ip6</option>\r\n                          <option value=\"a\">a</option>\r\n                          <option value=\"mx\">mx</option>\r\n                          <option value=\"include\">include</option>\r\n                          <option value=\"all\">all</option>\r\n                        </select>\r\n                        <Input placeholder=\"value (optional)\" value={newSPFValue} onChange={(e: ChangeEvent<HTMLInputElement>) => setNewSPFValue(e.target.value)} />\r\n                        <Button onClick={addSPFMechanism}>{editingSPFIndex !== null ? 'Update' : 'Add'}</Button>\r\n                      </div>\r\n                      <div className=\"text-sm text-muted\">\r\n                        {parsedSPF?.mechanisms && parsedSPF.mechanisms.length > 0 && (\r\n                          <div className=\"space-y-1 mb-2\">\r\n                            <div className=\"text-xs font-semibold\">Mechanisms:</div>\r\n                            {parsedSPF.mechanisms.map((m, i) => (\r\n                              <div key={`${m.mechanism}:${i}`} className=\"flex items-center space-x-2\">\r\n                                <div className=\"text-xs\">{`${m.qualifier ?? ''}${m.mechanism}${m.value ? `:${m.value}` : ''}`}{editingSPFIndex===i ? ' (editing)' : ''}</div>\r\n                                <Button size=\"sm\" onClick={() => editSPFMechanism(i)}>Edit</Button>\r\n                                <Button size=\"sm\" variant=\"destructive\" onClick={() => removeSPFMechanism(i)}>Remove</Button>\r\n                              </div>\r\n                            ))}\r\n                          </div>\r\n                        )}\r\n                        <div>Preview:</div>\r\n                        <pre className=\"whitespace-pre-wrap\">{composeSPF(parsedSPF ?? { version: 'v=spf1', mechanisms: [] })}</pre>\r\n                        {!validateSPF(record.content).ok && (\r\n                          <div className=\"text-red-600\">SPF validation issues: {validateSPF(record.content).problems.join(', ')}</div>\r\n                        )}\r\n                        <div className=\"flex space-x-2 mt-2\">\r\n                          <Input placeholder=\"simulate IP e.g., 1.2.3.4\" value={spfSimIp} onChange={(e) => setSpfSimIp(e.target.value)} />\r\n                          <Button onClick={async () => {\r\n                            if (!zoneName) return;\r\n                            const domain = (record.name === '@' || !record.name) ? zoneName : `${record.name}.${zoneName}`;\r\n                            try {\r\n                              const result = await simulateSPF(domain, spfSimIp);\r\n                              setSpfSimResult(result);\r\n                            } catch (err) {\r\n                              setSpfSimResult({ result: 'temperror', reasons: [(err as Error).message], lookups: 0 });\r\n                            }\r\n                          }}>Simulate</Button>\r\n                          <Button onClick={async () => {\r\n                            if (!zoneName) return;\r\n                            const domain = (record.name === '@' || !record.name) ? zoneName : `${record.name}.${zoneName}`;\r\n                            try {\r\n                              const graph = await getSPFGraph(domain);\r\n                              setSpfGraph(graph);\r\n                              setSpfGraphError(null);\r\n                            } catch (err) {\r\n                              setSpfGraph(null);\r\n                              setSpfGraphError((err as Error).message);\r\n                            }\r\n                          }}>Graph</Button>\r\n                        </div>\r\n                        {spfSimResult && (\r\n                          <div className=\"text-sm mt-2\">Result: <strong>{spfSimResult.result}</strong> (lookups: {spfSimResult.lookups})<div className=\"text-xs text-muted\">{spfSimResult.reasons.join(', ')}</div></div>\r\n                        )}\r\n                        {spfGraphError && (\r\n                          <div className=\"text-sm text-red-600 mt-2\">Error building graph: {spfGraphError}</div>\r\n                        )}\r\n                        {spfGraph && (\r\n                          <div className=\"text-sm mt-2\"><div>Graph:</div><pre className=\"whitespace-pre-wrap\">{JSON.stringify(spfGraph, null, 2)}</pre></div>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                  );\r\n                default:\r\n                  return (\r\n                    <Input\r\n                      value={record.content}\r\n                      onChange={(e: ChangeEvent<HTMLInputElement>) => onRecordChange({\r\n                        ...record,\r\n                        content: e.target.value\r\n                      })}\r\n                      placeholder=\"e.g., 192.168.1.1\"\r\n                    />\r\n                  );\r\n              }\r\n            })()}\r\n          </div>\r\n          {record.type === 'MX' && (\r\n            <div className=\"space-y-2\">\r\n              <Label>Priority</Label>\r\n              <Input\r\n                type=\"number\"\r\n                value={record.priority || ''}\r\n                onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                  const n = Number.parseInt(e.target.value, 10);\r\n                  onRecordChange({\r\n                    ...record,\r\n                    priority: Number.isNaN(n) ? undefined : n\r\n                  });\r\n                }}\r\n              />\r\n            </div>\r\n          )}\r\n          {(record.type === 'A' || record.type === 'AAAA' || record.type === 'CNAME') && (\r\n            <div className=\"flex items-center space-x-2\">\r\n              <Switch\r\n                checked={record.proxied || false}\r\n                onCheckedChange={(checked: boolean) =>\r\n                  onRecordChange({\r\n                    ...record,\r\n                    proxied: checked\r\n                  })\r\n                }\r\n              />\r\n              <Label>Proxied through Cloudflare</Label>\r\n            </div>\r\n          )}\r\n          <Button onClick={onAdd} className=\"w-full\">\r\n            Create Record\r\n          </Button>\r\n        </div>\r\n      </DialogContent>\r\n    </Dialog>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\components\\dns\\ImportPreviewDialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\components\\dns\\ImportRecordsDialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":91,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":94,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[521,524],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[521,524],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Simple import dialog to paste JSON payloads and import DNS records into the\r\n * current zone. This component is a light overlay that validates JSON\r\n * client-side and forwards the payload to the parent for processing.\r\n */\r\nimport { ImportExportDialog } from './import-export-dialog';\r\n\r\n/**\r\n * Deprecated wrapper that forwards to ImportExportDialog with JSON format.\r\n * Kept for compatibility with older imports.\r\n */\r\nexport function ImportRecordsDialog({ open, onOpenChange, data, onDataChange, onImport }: any) {\r\n  return (\r\n    <ImportExportDialog\r\n      open={open}\r\n      onOpenChange={onOpenChange}\r\n      importData={data}\r\n      importFormat={'json'}\r\n      onImportDataChange={onDataChange}\r\n      onImportFormatChange={() => {}}\r\n      onImport={onImport}\r\n      onExport={() => {}}\r\n    />\r\n  );\r\n}\r\n\r\n/**\r\n * Props for a dialog to import JSON-formatted DNS records into the\r\n * application. This is a simplified dialog used in the UI to paste JSON\r\n * text.\r\n */\r\nexport interface ImportRecordsDialogProps {\r\n  /** Whether the dialog is open */\r\n  open: boolean;\r\n  /** Callback invoked when the dialog open state changes */\r\n  onOpenChange: (open: boolean) => void;\r\n  /** The JSON data being imported */\r\n  data: string;\r\n  /** Callback when the import data field changes */\r\n  onDataChange: (val: string) => void;\r\n  /** Callback to trigger the import */\r\n  onImport: () => void;\r\n}\r\n\r\n/**\r\n * Component rendering an Import dialog that accepts JSON payload for DNS\r\n * records and invokes `onImport` when the user accepts.\r\n */\r\n// deprecated: handled by ImportExportDialog wrapper above\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\components\\dns\\RecordRow.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'parseNAPTR'. Either include it or remove the dependency array.","line":152,"column":6,"nodeType":"ArrayExpression","endLine":152,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [parseNAPTR, record]","fix":{"range":[7829,7837],"text":"[parseNAPTR, record]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * UI component rendering a single DNS record row and optional inline\r\n * editor allowing update and deletion of the record.\r\n */\r\nimport { useState, useEffect } from 'react';\r\nimport type { ChangeEvent } from 'react';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Switch } from '@/components/ui/switch';\r\nimport type { RecordType, DNSRecord, TTLValue } from '@/types/dns';\r\nimport { parseSPF, composeSPF, validateSPF } from '@/lib/spf';\r\nimport { RECORD_TYPES, getTTLPresets, getRecordTypeLabel } from '@/types/dns';\r\nimport { Edit2, Trash2, Save, X } from 'lucide-react';\r\n\r\n\r\n/**\r\n * Properties for the `RecordRow` UI component which renders and optionally\r\n * edits a DNS record.\r\n */\r\nexport interface RecordRowProps {\r\n  /** The DNS record to display or edit */\r\n  record: DNSRecord;\r\n  /** Whether the row is currently in edit mode */\r\n  isEditing: boolean;\r\n  /** Callback invoked to transition into edit mode */\r\n  onEdit: () => void;\r\n  /** Save callback after editing; receives the updated record */\r\n  onSave: (record: DNSRecord) => void;\r\n  /** Cancel editing and revert changes */\r\n  onCancel: () => void;\r\n  /** Remove the record */\r\n  onDelete: () => void;\r\n}\r\n\r\n/**\r\n * Render a single DNS record row. When `isEditing` is true the row\r\n * renders in edit mode with inputs for each editable field; otherwise it\r\n * displays the record details.\r\n */\r\nexport function RecordRow({ record, isEditing, onEdit, onSave, onCancel, onDelete }: RecordRowProps) {\r\n  const [editedRecord, setEditedRecord] = useState(record);\r\n  const parseSRV = (content?: string) => {\r\n    if (!content) return { priority: undefined, weight: undefined, port: undefined, target: '' };\r\n    const parts = String(content).trim().split(/\\s+/);\r\n    if (parts.length < 4) return { priority: undefined, weight: undefined, port: undefined, target: content };\r\n    const [priority, weight, port, ...rest] = parts;\r\n    return { priority: Number(priority), weight: Number(weight), port: Number(port), target: rest.join(' ') };\r\n  };\r\n  const composeSRV = (p?: number, w?: number, prt?: number, t?: string) => `${p ?? 0} ${w ?? 0} ${prt ?? 0} ${t ?? ''}`;\r\n  const [srvPriority, setSrvPriority] = useState<number | undefined>(parseSRV(record.content).priority);\r\n  const [srvWeight, setSrvWeight] = useState<number | undefined>(parseSRV(record.content).weight);\r\n  const [srvPort, setSrvPort] = useState<number | undefined>(parseSRV(record.content).port);\r\n  const [srvTarget, setSrvTarget] = useState<string>(parseSRV(record.content).target ?? '');\r\n  const parseTLSA = (content?: string) => {\r\n    if (!content) return { usage: undefined, selector: undefined, matchingType: undefined, data: '' };\r\n    const parts = String(content).trim().split(/\\s+/);\r\n    if (parts.length < 4) return { usage: undefined, selector: undefined, matchingType: undefined, data: content };\r\n    const [usage, selector, matchingType, ...rest] = parts;\r\n    return { usage: Number(usage), selector: Number(selector), matchingType: Number(matchingType), data: rest.join(' ') };\r\n  };\r\n  const composeTLSA = (u?: number, s?: number, m?: number, d?: string) => `${u ?? 0} ${s ?? 0} ${m ?? 0} ${d ?? ''}`;\r\n  const [tlsaUsage, setTlsaUsage] = useState<number | undefined>(parseTLSA(record.content).usage);\r\n  const [tlsaSelector, setTlsaSelector] = useState<number | undefined>(parseTLSA(record.content).selector);\r\n  const [tlsaMatchingType, setTlsaMatchingType] = useState<number | undefined>(parseTLSA(record.content).matchingType);\r\n  const [tlsaData, setTlsaData] = useState<string>(parseTLSA(record.content).data ?? '');\r\n  const parseSSHFP = (content?: string) => {\r\n    if (!content) return { algorithm: undefined, fptype: undefined, fingerprint: '' };\r\n    const parts = String(content).trim().split(/\\s+/);\r\n    if (parts.length < 3) return { algorithm: undefined, fptype: undefined, fingerprint: content };\r\n    const [algorithm, fptype, ...rest] = parts;\r\n    return { algorithm: Number(algorithm), fptype: Number(fptype), fingerprint: rest.join(' ') };\r\n  };\r\n  const composeSSHFP = (a?: number, f?: number, fp?: string) => `${a ?? 0} ${f ?? 0} ${fp ?? ''}`;\r\n  const [sshfpAlgorithm, setSshfpAlgorithm] = useState<number | undefined>(parseSSHFP(record.content).algorithm);\r\n  const [sshfpFptype, setSshfpFptype] = useState<number | undefined>(parseSSHFP(record.content).fptype);\r\n  const [sshfpFingerprint, setSshfpFingerprint] = useState<string>(parseSSHFP(record.content).fingerprint ?? '');\r\n  const splitNaptrTokens = (s: string) => {\r\n    const tokens: string[] = [];\r\n    let current = '';\r\n    let inQuote = false;\r\n    for (let i = 0; i < s.length; i++) {\r\n      const ch = s[i];\r\n      if (ch === '\"') {\r\n        inQuote = !inQuote;\r\n        current += ch;\r\n        continue;\r\n      }\r\n      if (ch === ' ' && !inQuote) {\r\n        if (current.trim().length > 0) {\r\n          tokens.push(current.trim());\r\n          current = '';\r\n        }\r\n        continue;\r\n      }\r\n      current += ch;\r\n    }\r\n    if (current.trim().length > 0) tokens.push(current.trim());\r\n    return tokens;\r\n  };\r\n\r\n  const parseNAPTR = (content?: string) => {\r\n    if (!content) return { order: undefined, preference: undefined, flags: '', service: '', regexp: '', replacement: '' };\r\n    const tokens = splitNaptrTokens(String(content).trim());\r\n    const [order, preference, flags, service, regexp, replacement] = tokens;\r\n    return { order: Number(order), preference: Number(preference), flags: flags?.replace(/^\"|\"$/g, ''), service, regexp: regexp?.replace(/^\"|\"$/g, ''), replacement };\r\n  };\r\n  const quoteIfNeeded = (s?: string) => {\r\n    if (!s) return '';\r\n    if (/\\s/.test(s) || /\"/.test(s)) return `\"${s.replace(/\"/g, '\\\\\"')}\"`;\r\n    return s;\r\n  };\r\n  const composeNAPTR = (o?: number, p?: number, f?: string, s?: string, r?: string, rep?: string) => `${o ?? 0} ${p ?? 0} ${f ?? ''} ${s ?? ''} ${quoteIfNeeded(r)} ${rep ?? ''}`;\r\n  const [naptrOrder, setNaptrOrder] = useState<number | undefined>(parseNAPTR(record.content).order);\r\n  const [naptrPref, setNaptrPref] = useState<number | undefined>(parseNAPTR(record.content).preference);\r\n  const [naptrFlags, setNaptrFlags] = useState<string>(parseNAPTR(record.content).flags ?? '');\r\n  const [naptrService, setNaptrService] = useState<string>(parseNAPTR(record.content).service ?? '');\r\n  const [naptrRegexp, setNaptrRegexp] = useState<string>(parseNAPTR(record.content).regexp ?? '');\r\n  const [naptrReplacement, setNaptrReplacement] = useState<string>(parseNAPTR(record.content).replacement ?? '');\r\n\r\n  useEffect(() => {\r\n    setEditedRecord(record);\r\n    if (record.type === 'SRV') {\r\n      const parsed = parseSRV(record.content);\r\n      setSrvPriority(parsed.priority);\r\n      setSrvWeight(parsed.weight);\r\n      setSrvPort(parsed.port);\r\n      setSrvTarget(parsed.target ?? '');\r\n    }\r\n    if (record.type === 'TLSA') {\r\n      const parsed = parseTLSA(record.content);\r\n      setTlsaUsage(parsed.usage);\r\n      setTlsaSelector(parsed.selector);\r\n      setTlsaMatchingType(parsed.matchingType);\r\n      setTlsaData(parsed.data ?? '');\r\n    }\r\n    if (record.type === 'SSHFP') {\r\n      const parsed = parseSSHFP(record.content);\r\n      setSshfpAlgorithm(parsed.algorithm);\r\n      setSshfpFptype(parsed.fptype);\r\n      setSshfpFingerprint(parsed.fingerprint ?? '');\r\n    }\r\n    if (record.type === 'NAPTR') {\r\n      const parsed = parseNAPTR(record.content);\r\n      setNaptrOrder(parsed.order);\r\n      setNaptrPref(parsed.preference);\r\n      setNaptrFlags(parsed.flags ?? '');\r\n      setNaptrService(parsed.service ?? '');\r\n      setNaptrRegexp(parsed.regexp ?? '');\r\n      setNaptrReplacement(parsed.replacement ?? '');\r\n    }\r\n  }, [record]);\r\n\r\n  const ttlValue = editedRecord.ttl === 1 ? 'auto' : editedRecord.ttl;\r\n  const isCustomTTL = !getTTLPresets().includes(ttlValue as TTLValue);\r\n\r\n  if (isEditing) {\r\n    return (\r\n      <div className=\"p-4 border rounded-lg bg-muted/50\">\r\n        <div className=\"grid grid-cols-12 gap-4 items-center\">\r\n          <div className=\"col-span-2\">\r\n            <Select\r\n              value={editedRecord.type}\r\n              onValueChange={(value: RecordType) => setEditedRecord({\r\n                ...editedRecord,\r\n                type: value\r\n              })}\r\n            >\r\n              <SelectTrigger className=\"h-8\">\r\n                <SelectValue />\r\n              </SelectTrigger>\r\n                <SelectContent>\r\n                  {RECORD_TYPES.map((type) => (\r\n                    <SelectItem key={type} value={type} title={getRecordTypeLabel(type)}>\r\n                      {getRecordTypeLabel(type)}\r\n                    </SelectItem>\r\n                  ))}\r\n                </SelectContent>\r\n            </Select>\r\n          </div>\r\n          <div className=\"col-span-3\">\r\n            <Input\r\n              value={editedRecord.name}\r\n              onChange={(e: ChangeEvent<HTMLInputElement>) => setEditedRecord({\r\n                ...editedRecord,\r\n                name: e.target.value\r\n              })}\r\n              className=\"h-8\"\r\n            />\r\n          </div>\r\n          <div className=\"col-span-4\">\r\n            {editedRecord.type === 'SRV' ? (\r\n              <div className=\"grid grid-cols-4 gap-2\">\r\n                <Input\r\n                  type=\"number\"\r\n                  placeholder=\"priority\"\r\n                  value={srvPriority ?? ''}\r\n                  onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                    const n = Number.parseInt(e.target.value, 10);\r\n                    const val = Number.isNaN(n) ? undefined : n;\r\n                    setSrvPriority(val);\r\n                    setEditedRecord({ ...editedRecord, content: composeSRV(val, srvWeight, srvPort, srvTarget) });\r\n                  }}\r\n                  className=\"h-8\"\r\n                />\r\n                <Input\r\n                  type=\"number\"\r\n                  placeholder=\"weight\"\r\n                  value={srvWeight ?? ''}\r\n                  onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                    const n = Number.parseInt(e.target.value, 10);\r\n                    const val = Number.isNaN(n) ? undefined : n;\r\n                    setSrvWeight(val);\r\n                    setEditedRecord({ ...editedRecord, content: composeSRV(srvPriority, val, srvPort, srvTarget) });\r\n                  }}\r\n                  className=\"h-8\"\r\n                />\r\n                <Input\r\n                  type=\"number\"\r\n                  placeholder=\"port\"\r\n                  value={srvPort ?? ''}\r\n                  onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                    const n = Number.parseInt(e.target.value, 10);\r\n                    const val = Number.isNaN(n) ? undefined : n;\r\n                    setSrvPort(val);\r\n                    setEditedRecord({ ...editedRecord, content: composeSRV(srvPriority, srvWeight, val, srvTarget) });\r\n                  }}\r\n                  className=\"h-8\"\r\n                />\r\n                <Input\r\n                  placeholder=\"target\"\r\n                  value={srvTarget}\r\n                  onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                    setSrvTarget(e.target.value);\r\n                    setEditedRecord({ ...editedRecord, content: composeSRV(srvPriority, srvWeight, srvPort, e.target.value) });\r\n                  }}\r\n                  className=\"h-8\"\r\n                />\r\n              </div>\r\n            ) : editedRecord.type === 'TLSA' ? (\r\n              <div className=\"grid grid-cols-4 gap-2\">\r\n                <Input\r\n                  type=\"number\"\r\n                  placeholder=\"usage\"\r\n                  value={tlsaUsage ?? ''}\r\n                  onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                    const n = Number.parseInt(e.target.value, 10);\r\n                    const val = Number.isNaN(n) ? undefined : n;\r\n                    setTlsaUsage(val);\r\n                    setEditedRecord({ ...editedRecord, content: composeTLSA(val, tlsaSelector, tlsaMatchingType, tlsaData) });\r\n                  }}\r\n                  className=\"h-8\"\r\n                />\r\n                <Input\r\n                  type=\"number\"\r\n                  placeholder=\"selector\"\r\n                  value={tlsaSelector ?? ''}\r\n                  onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                    const n = Number.parseInt(e.target.value, 10);\r\n                    const val = Number.isNaN(n) ? undefined : n;\r\n                    setTlsaSelector(val);\r\n                    setEditedRecord({ ...editedRecord, content: composeTLSA(tlsaUsage, val, tlsaMatchingType, tlsaData) });\r\n                  }}\r\n                  className=\"h-8\"\r\n                />\r\n                <Input\r\n                  type=\"number\"\r\n                  placeholder=\"matching type\"\r\n                  value={tlsaMatchingType ?? ''}\r\n                  onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                    const n = Number.parseInt(e.target.value, 10);\r\n                    const val = Number.isNaN(n) ? undefined : n;\r\n                    setTlsaMatchingType(val);\r\n                    setEditedRecord({ ...editedRecord, content: composeTLSA(tlsaUsage, tlsaSelector, val, tlsaData) });\r\n                  }}\r\n                  className=\"h-8\"\r\n                />\r\n                <Input\r\n                  placeholder=\"data\"\r\n                  value={tlsaData}\r\n                  onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                    setTlsaData(e.target.value);\r\n                    setEditedRecord({ ...editedRecord, content: composeTLSA(tlsaUsage, tlsaSelector, tlsaMatchingType, e.target.value) });\r\n                  }}\r\n                  className=\"h-8\"\r\n                />\r\n              </div>\r\n            ) : editedRecord.type === 'SSHFP' ? (\r\n              <div className=\"grid grid-cols-3 gap-2\">\r\n                <Input\r\n                  type=\"number\"\r\n                  placeholder=\"algorithm\"\r\n                  value={sshfpAlgorithm ?? ''}\r\n                  onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                    const n = Number.parseInt(e.target.value, 10);\r\n                    const val = Number.isNaN(n) ? undefined : n;\r\n                    setSshfpAlgorithm(val);\r\n                    setEditedRecord({ ...editedRecord, content: composeSSHFP(val, sshfpFptype, sshfpFingerprint) });\r\n                  }}\r\n                  className=\"h-8\"\r\n                />\r\n                <Input\r\n                  type=\"number\"\r\n                  placeholder=\"fptype\"\r\n                  value={sshfpFptype ?? ''}\r\n                  onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                    const n = Number.parseInt(e.target.value, 10);\r\n                    const val = Number.isNaN(n) ? undefined : n;\r\n                    setSshfpFptype(val);\r\n                    setEditedRecord({ ...editedRecord, content: composeSSHFP(sshfpAlgorithm, val, sshfpFingerprint) });\r\n                  }}\r\n                  className=\"h-8\"\r\n                />\r\n                <Input\r\n                  placeholder=\"fingerprint\"\r\n                  value={sshfpFingerprint}\r\n                  onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                    setSshfpFingerprint(e.target.value);\r\n                    setEditedRecord({ ...editedRecord, content: composeSSHFP(sshfpAlgorithm, sshfpFptype, e.target.value) });\r\n                  }}\r\n                  className=\"h-8\"\r\n                />\r\n              </div>\r\n            ) : editedRecord.type === 'NAPTR' ? (\r\n              <div className=\"grid grid-cols-6 gap-2\">\r\n                <Input\r\n                  type=\"number\"\r\n                  placeholder=\"order\"\r\n                  value={naptrOrder ?? ''}\r\n                  onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                    const n = Number.parseInt(e.target.value, 10);\r\n                    const val = Number.isNaN(n) ? undefined : n;\r\n                    setNaptrOrder(val);\r\n                    setEditedRecord({ ...editedRecord, content: composeNAPTR(val, naptrPref, naptrFlags, naptrService, naptrRegexp, naptrReplacement) });\r\n                  }}\r\n                  className=\"h-8\"\r\n                />\r\n                <Input\r\n                  type=\"number\"\r\n                  placeholder=\"preference\"\r\n                  value={naptrPref ?? ''}\r\n                  onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                    const n = Number.parseInt(e.target.value, 10);\r\n                    const val = Number.isNaN(n) ? undefined : n;\r\n                    setNaptrPref(val);\r\n                    setEditedRecord({ ...editedRecord, content: composeNAPTR(naptrOrder, val, naptrFlags, naptrService, naptrRegexp, naptrReplacement) });\r\n                  }}\r\n                  className=\"h-8\"\r\n                />\r\n                <Input\r\n                  placeholder=\"flags\"\r\n                  value={naptrFlags}\r\n                  onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                    setNaptrFlags(e.target.value);\r\n                    setEditedRecord({ ...editedRecord, content: composeNAPTR(naptrOrder, naptrPref, e.target.value, naptrService, naptrRegexp, naptrReplacement) });\r\n                  }}\r\n                  className=\"h-8\"\r\n                />\r\n                <Input\r\n                  placeholder=\"service\"\r\n                  value={naptrService}\r\n                  onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                    setNaptrService(e.target.value);\r\n                    setEditedRecord({ ...editedRecord, content: composeNAPTR(naptrOrder, naptrPref, naptrFlags, e.target.value, naptrRegexp, naptrReplacement) });\r\n                  }}\r\n                  className=\"h-8\"\r\n                />\r\n                <Input\r\n                  placeholder=\"regexp\"\r\n                  value={naptrRegexp}\r\n                  onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                    setNaptrRegexp(e.target.value);\r\n                    setEditedRecord({ ...editedRecord, content: composeNAPTR(naptrOrder, naptrPref, naptrFlags, naptrService, e.target.value, naptrReplacement) });\r\n                  }}\r\n                  className=\"h-8\"\r\n                />\r\n                <Input\r\n                  placeholder=\"replacement\"\r\n                  value={naptrReplacement}\r\n                  onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                    setNaptrReplacement(e.target.value);\r\n                    setEditedRecord({ ...editedRecord, content: composeNAPTR(naptrOrder, naptrPref, naptrFlags, naptrService, naptrRegexp, e.target.value) });\r\n                  }}\r\n                  className=\"h-8\"\r\n                />\r\n              </div>\r\n            ) : editedRecord.type === 'SPF' ? (\r\n              <div className=\"space-y-2\">\r\n                <Input\r\n                  value={editedRecord.content}\r\n                  onChange={(e: ChangeEvent<HTMLInputElement>) => setEditedRecord({ ...editedRecord, content: e.target.value })}\r\n                  className=\"h-8\"\r\n                />\r\n                <div className=\"flex space-x-2\">\r\n                  <select className=\"h-8 p-2\" value={''} onChange={() => { /* small builder not implemented yet */ }}>\r\n                    <option value=\"\">+</option>\r\n                  </select>\r\n                  <span className=\"text-sm\">Preview: {composeSPF(parseSPF(editedRecord.content) ?? { version: 'v=spf1', mechanisms: [] })}</span>\r\n                </div>\r\n                {!validateSPF(editedRecord.content).ok && (\r\n                  <div className=\"text-red-600\">SPF validation issues: {validateSPF(editedRecord.content).problems.join(', ')}</div>\r\n                )}\r\n              </div>\r\n            ) : (\r\n              <Input\r\n                value={editedRecord.content}\r\n                onChange={(e: ChangeEvent<HTMLInputElement>) => setEditedRecord({\r\n                  ...editedRecord,\r\n                  content: e.target.value\r\n                })}\r\n                className=\"h-8\"\r\n              />\r\n            )}\r\n          </div>\r\n          <div className=\"col-span-1 space-y-1\">\r\n            <Select\r\n              value={isCustomTTL ? 'custom' : String(ttlValue)}\r\n              onValueChange={(value: string) => {\r\n                if (value === 'custom') {\r\n                  setEditedRecord({ ...editedRecord, ttl: 300 });\r\n                } else {\r\n                  setEditedRecord({\r\n                    ...editedRecord,\r\n                    ttl: value === 'auto' ? 'auto' : Number(value),\r\n                  });\r\n                }\r\n              }}\r\n            >\r\n              <SelectTrigger className=\"h-8\">\r\n                <SelectValue />\r\n              </SelectTrigger>\r\n              <SelectContent>\r\n                {getTTLPresets().map((ttl) => (\r\n                  <SelectItem key={ttl} value={String(ttl)}>\r\n                    {ttl === 'auto' ? 'Auto' : ttl}\r\n                  </SelectItem>\r\n                ))}\r\n                <SelectItem value=\"custom\">Custom</SelectItem>\r\n              </SelectContent>\r\n            </Select>\r\n            {isCustomTTL && (\r\n              <Input\r\n                type=\"number\"\r\n                value={typeof editedRecord.ttl === 'number' ? editedRecord.ttl : ''}\r\n                onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                  const n = Number.parseInt(e.target.value, 10);\r\n                  setEditedRecord({\r\n                    ...editedRecord,\r\n                    ttl: Number.isNaN(n) ? 300 : n,\r\n                  });\r\n                }}\r\n                className=\"h-8\"\r\n              />\r\n            )}\r\n            {editedRecord.type === 'MX' && (\r\n              <Input\r\n                type=\"number\"\r\n                value={editedRecord.priority ?? ''}\r\n                onChange={(e: ChangeEvent<HTMLInputElement>) => {\r\n                  const n = Number.parseInt(e.target.value, 10);\r\n                  setEditedRecord({\r\n                    ...editedRecord,\r\n                    priority: Number.isNaN(n) ? undefined : n,\r\n                  });\r\n                }}\r\n                className=\"h-8\"\r\n              />\r\n            )}\r\n          </div>\r\n          <div className=\"col-span-1\">\r\n            {(editedRecord.type === 'A' || editedRecord.type === 'AAAA' || editedRecord.type === 'CNAME') && (\r\n              <Switch\r\n                checked={editedRecord.proxied || false}\r\n                onCheckedChange={(checked: boolean) => setEditedRecord({\r\n                  ...editedRecord,\r\n                  proxied: checked\r\n                })}\r\n              />\r\n            )}\r\n          </div>\r\n          <div className=\"col-span-1 flex gap-1\">\r\n            <Button\r\n              size=\"sm\"\r\n              onClick={() => onSave(editedRecord)}\r\n              className=\"h-8 w-8 p-0\"\r\n            >\r\n              <Save className=\"h-3 w-3\" />\r\n            </Button>\r\n            <Button\r\n              size=\"sm\"\r\n              variant=\"outline\"\r\n              onClick={onCancel}\r\n              className=\"h-8 w-8 p-0\"\r\n            >\r\n              <X className=\"h-3 w-3\" />\r\n            </Button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"p-4 border rounded-lg hover:bg-muted/50 transition-colors\">\r\n      <div className=\"grid grid-cols-12 gap-4 items-center\">\r\n        <div className=\"col-span-2\">\r\n          <span title={getRecordTypeLabel(record.type as RecordType)} className=\"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-primary/10 text-primary\">\r\n            {record.type}\r\n          </span>\r\n        </div>\r\n        <div className=\"col-span-3\">\r\n          <span className=\"font-mono text-sm\">{record.name}</span>\r\n        </div>\r\n        <div className=\"col-span-4\">\r\n          <span className=\"font-mono text-sm break-all\">{record.content}</span>\r\n        </div>\r\n        <div className=\"col-span-1\">\r\n          <span className=\"text-sm text-muted-foreground\">\r\n            {record.ttl === 1 ? 'Auto' : record.ttl}\r\n          </span>\r\n        </div>\r\n        <div className=\"col-span-1\">\r\n          {record.proxied && (\r\n            <span className=\"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200\">\r\n              Proxied\r\n            </span>\r\n          )}\r\n        </div>\r\n        <div className=\"col-span-1 flex gap-1\">\r\n          <Button\r\n            size=\"sm\"\r\n            variant=\"ghost\"\r\n            onClick={onEdit}\r\n            className=\"h-8 w-8 p-0\"\r\n          >\r\n            <Edit2 className=\"h-3 w-3\" />\r\n          </Button>\r\n          <Button\r\n            size=\"sm\"\r\n            variant=\"ghost\"\r\n            onClick={onDelete}\r\n            className=\"h-8 w-8 p-0 text-destructive hover:text-destructive\"\r\n          >\r\n            <Trash2 className=\"h-3 w-3\" />\r\n          </Button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\components\\dns\\dns-manager.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":341,"column":54,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":341,"endColumn":57,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11161,11164],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11161,11164],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":341,"column":81,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":341,"endColumn":84,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[11188,11191],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[11188,11191],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'err' is defined but never used.","line":358,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":358,"endColumn":25}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Top-level DNS Manager UI which composes the zone selector, the record\r\n * list and dialogs for creating/importing records.\r\n */\r\nimport { useState, useEffect, useCallback } from 'react';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { useCloudflareAPI } from '@/hooks/use-cloudflare-api';\r\nimport type { DNSRecord, Zone, RecordType } from '@/types/dns';\r\nimport { RECORD_TYPES } from '@/types/dns';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { storageManager } from '@/lib/storage';\r\nimport { LogOut } from 'lucide-react';\r\nimport { AddRecordDialog } from './AddRecordDialog';\r\nimport { ImportExportDialog } from './import-export-dialog';\r\nimport { RecordRow } from './RecordRow';\r\nimport { FixedSizeList as List } from 'react-window';\r\nimport { filterRecords } from './filter-records';\r\nimport { parseCSVRecords, parseBINDZone } from '@/lib/dns-parsers';\r\n\r\n/**\r\n * Props for the `DNSManager` top-level component.\r\n */\r\ninterface DNSManagerProps {\r\n  /** API key to be used for server requests (token or key) */\r\n  apiKey: string;\r\n  /** Optional email used when authenticating with a key+email pair */\r\n  email?: string;\r\n  /** Callback invoked when the user logs out */\r\n  onLogout: () => void;\r\n}\r\n\r\n\r\n/**\r\n * DNS Manager component responsible for listing zones and DNS records and\r\n * providing UI for add/import/export/update/delete operations.\r\n *\r\n * @param apiKey - API key used to authenticate server requests\r\n * @param email - optional email when using key+email authentication\r\n * @param onLogout - callback invoked when the user logs out\r\n */\r\nexport function DNSManager({ apiKey, email, onLogout }: DNSManagerProps) {\r\n  const { t } = useTranslation();\r\n  const [zones, setZones] = useState<Zone[]>([]);\r\n  const [selectedZone, setSelectedZone] = useState<string>('');\r\n  const [records, setRecords] = useState<DNSRecord[]>([]);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const [editingRecord, setEditingRecord] = useState<string | null>(null);\r\n  const [showAddRecord, setShowAddRecord] = useState(false);\r\n  const [showImport, setShowImport] = useState(false);\r\n  const [newRecord, setNewRecord] = useState<Partial<DNSRecord>>({\r\n    type: 'A',\r\n    name: '',\r\n    content: '',\r\n    ttl: 300,\r\n    proxied: false\r\n  });\r\n  const [importData, setImportData] = useState('');\r\n  const [importFormat, setImportFormat] = useState<'json' | 'csv' | 'bind'>('json');\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [typeFilter, setTypeFilter] = useState<RecordType | ''>('');\r\n  const [page, setPage] = useState(1);\r\n  const [perPage, setPerPage] = useState(50);\r\n  const [autoRefreshInterval, setAutoRefreshInterval] = useState<number | null>(storageManager.getAutoRefreshInterval());\r\n  \r\n  const { toast } = useToast();\r\n  const {\r\n    getZones,\r\n    getDNSRecords,\r\n    createDNSRecord,\r\n    updateDNSRecord,\r\n    bulkCreateDNSRecords,\r\n    deleteDNSRecord,\r\n    exportDNSRecords,\r\n  } = useCloudflareAPI(apiKey, email);\r\n\r\n  const loadZones = useCallback(async (signal?: AbortSignal) => {\r\n    try {\r\n      setIsLoading(true);\r\n      const zonesData = await getZones(signal);\r\n      setZones(zonesData);\r\n    } catch (error) {\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to load zones: \" + (error as Error).message,\r\n        variant: \"destructive\"\r\n      });\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [getZones, toast]);\r\n\r\n  const loadRecords = useCallback(async (signal?: AbortSignal) => {\r\n    if (!selectedZone) return;\r\n\r\n    try {\r\n      setIsLoading(true);\r\n      const recordsData = await getDNSRecords(selectedZone, page, perPage, signal);\r\n      setRecords(recordsData);\r\n    } catch (error) {\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to load DNS records: \" + (error as Error).message,\r\n        variant: \"destructive\"\r\n      });\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  }, [getDNSRecords, selectedZone, page, perPage, toast]);\r\n\r\n  useEffect(() => {\r\n    const controller = new AbortController();\r\n    loadZones(controller.signal);\r\n    return () => controller.abort();\r\n  }, [loadZones]);\r\n\r\n  useEffect(() => {\r\n    const last = storageManager.getLastZone();\r\n    if (last) {\r\n      setSelectedZone(last);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (selectedZone) {\r\n      const controller = new AbortController();\r\n      loadRecords(controller.signal);\r\n      return () => controller.abort();\r\n    }\r\n  }, [selectedZone, loadRecords]);\r\n\r\n  useEffect(() => {\r\n    if (selectedZone) {\r\n      storageManager.setLastZone(selectedZone);\r\n    }\r\n  }, [selectedZone]);\r\n\r\n  // Auto refresh: refresh records at the selected interval unless the user is\r\n  // currently editing or has modal dialogs open to avoid disrupting work.\r\n  useEffect(() => {\r\n    storageManager.setAutoRefreshInterval(autoRefreshInterval ?? null);\r\n    if (!autoRefreshInterval || autoRefreshInterval <= 0) return;\r\n    const id = setInterval(async () => {\r\n      if (editingRecord || showAddRecord || showImport) return;\r\n      const controller = new AbortController();\r\n      await loadRecords(controller.signal);\r\n    }, autoRefreshInterval);\r\n    return () => clearInterval(id);\r\n  }, [autoRefreshInterval, editingRecord, showAddRecord, showImport, loadRecords]);\r\n\r\n  const handleAddRecord = async () => {\r\n    if (!selectedZone || !newRecord.type || !newRecord.name || !newRecord.content) {\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Please fill in all required fields\",\r\n        variant: \"destructive\"\r\n      });\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const createdRecord = await createDNSRecord(selectedZone, newRecord);\r\n      setRecords([createdRecord, ...records]);\r\n      setNewRecord({\r\n        type: 'A',\r\n        name: '',\r\n        content: '',\r\n        ttl: 300,\r\n        proxied: false\r\n      });\r\n      setShowAddRecord(false);\r\n      \r\n      toast({\r\n        title: \"Success\",\r\n        description: \"DNS record created successfully\"\r\n      });\r\n    } catch (error) {\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to create DNS record: \" + (error as Error).message,\r\n        variant: \"destructive\"\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleUpdateRecord = async (record: DNSRecord) => {\r\n    try {\r\n      const updatedRecord = await updateDNSRecord(selectedZone, record.id, record);\r\n      setRecords(records.map((r: DNSRecord) => r.id === record.id ? updatedRecord : r));\r\n      setEditingRecord(null);\r\n      \r\n      toast({\r\n        title: \"Success\",\r\n        description: \"DNS record updated successfully\"\r\n      });\r\n    } catch (error) {\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to update DNS record: \" + (error as Error).message,\r\n        variant: \"destructive\"\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleDeleteRecord = async (recordId: string) => {\r\n    try {\r\n      await deleteDNSRecord(selectedZone, recordId);\r\n      setRecords(records.filter((r: DNSRecord) => r.id !== recordId));\r\n      \r\n      toast({\r\n        title: \"Success\",\r\n        description: \"DNS record deleted successfully\"\r\n      });\r\n    } catch (error) {\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to delete DNS record: \" + (error as Error).message,\r\n        variant: \"destructive\"\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleExport = (format: 'json' | 'csv' | 'bind') => {\r\n    let content = '';\r\n    let filename = '';\r\n    let mimeType = '';\r\n\r\n    switch (format) {\r\n      case 'json': {\r\n        content = JSON.stringify(records, null, 2);\r\n        filename = `${selectedZone}-records.json`;\r\n        mimeType = 'application/json';\r\n        break;\r\n      }\r\n      case 'csv': {\r\n        const headers = ['Type', 'Name', 'Content', 'TTL', 'Priority', 'Proxied'];\r\n        const escapeCSV = (value: unknown) =>\r\n          `\"${String(value ?? '').replace(/\"/g, '\"\"')}\"`;\r\n        const rows = records\r\n          .map((r: DNSRecord) =>\r\n            [\r\n              r.type,\r\n              r.name,\r\n              r.content,\r\n              r.ttl,\r\n              r.priority ?? '',\r\n              r.proxied ?? false,\r\n            ]\r\n              .map(escapeCSV)\r\n              .join(',')\r\n          )\r\n          .join('\\n');\r\n        content = headers.map(escapeCSV).join(',') + '\\n' + rows;\r\n        filename = `${selectedZone}-records.csv`;\r\n        mimeType = 'text/csv';\r\n        break;\r\n      }\r\n      case 'bind': {\r\n        content = records\r\n          .map((r: DNSRecord) => {\r\n            const ttl = r.ttl || 300;\r\n            const priority = r.priority ? `${r.priority} ` : '';\r\n            return `${r.name}\\t${ttl}\\tIN\\t${r.type}\\t${priority}${r.content}`;\r\n          })\r\n          .join('\\n');\r\n        filename = `${selectedZone}.zone`;\r\n        mimeType = 'text/plain';\r\n        break;\r\n      }\r\n    }\r\n\r\n    const blob = new Blob([content], { type: mimeType });\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = filename;\r\n    a.click();\r\n    URL.revokeObjectURL(url);\r\n\r\n    toast({\r\n      title: \"Success\",\r\n      description: `Records exported as ${format.toUpperCase()}`\r\n    });\r\n  };\r\n\r\n  const handleImport = async (providedItems?: Partial<DNSRecord>[], dryRun?: boolean) => {\r\n    try {\r\n      let items: Partial<DNSRecord>[] | null = null;\r\n      if (providedItems) items = providedItems as Partial<DNSRecord>[];\r\n      else {\r\n      switch (importFormat) {\r\n        case 'json': {\r\n          const imported = JSON.parse(importData);\r\n          items = Array.isArray(imported)\r\n            ? imported\r\n            : Array.isArray(imported.records)\r\n              ? imported.records\r\n              : null;\r\n          break;\r\n        }\r\n        case 'csv':\r\n          items = parseCSVRecords(importData);\r\n          break;\r\n        case 'bind':\r\n          items = parseBINDZone(importData);\r\n          break;\r\n      }\r\n      }\r\n\r\n      if (!items) {\r\n        throw new Error('Invalid format');\r\n      }\r\n\r\n      const valid: DNSRecord[] = [];\r\n      let skipped = 0;\r\n\r\n      for (const item of items) {\r\n        if (item && item.type && item.name && item.content) {\r\n          const exists = records.some(\r\n            r => r.type === item.type && r.name === item.name && r.content === item.content\r\n          );\r\n          if (!exists) {\r\n            valid.push(item as DNSRecord);\r\n          } else {\r\n            skipped++;\r\n          }\r\n        } else {\r\n          skipped++;\r\n        }\r\n      }\r\n\r\n      if (valid.length) {\r\n        if (bulkCreateDNSRecords) {\r\n          try {\r\n            const result = await bulkCreateDNSRecords(selectedZone, valid, dryRun);\r\n            // Handle created and skipped results returned by server\r\n            const created = Array.isArray((result as any).created) ? (result as any).created : valid;\r\n            setRecords([...created, ...records]);\r\n          } catch (err) {\r\n            toast({\r\n              title: 'Error',\r\n              description: 'Failed to import records: ' + (err as Error).message,\r\n              variant: 'destructive',\r\n            });\r\n            return;\r\n          }\r\n        } else {\r\n          // Fall back to local creation using per-record API or local state\r\n          const createdRecords: DNSRecord[] = [];\r\n          for (const v of valid) {\r\n            try {\r\n              const r = await createDNSRecord(selectedZone, v);\r\n              createdRecords.push(r);\r\n            } catch (err) {\r\n              skipped++;\r\n            }\r\n          }\r\n          setRecords([...createdRecords, ...records]);\r\n        }\r\n        setImportData('');\r\n        setShowImport(false);\r\n\r\n        toast({\r\n          title: \"Success\",\r\n          description: `Imported ${valid.length} record(s)` + (skipped ? `, skipped ${skipped}` : '')\r\n        });\r\n      } else {\r\n        toast({\r\n          title: \"Error\",\r\n          description: skipped\r\n            ? `No new records imported. Skipped ${skipped} invalid or duplicate item(s).`\r\n            : 'No valid records found.',\r\n          variant: 'destructive'\r\n        });\r\n      }\r\n    } catch (error) {\r\n      toast({\r\n        title: \"Error\",\r\n        description: \"Failed to import records: \" + (error as Error).message,\r\n        variant: \"destructive\"\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleLogout = () => {\r\n    storageManager.clearSession();\r\n    onLogout();\r\n  };\r\n\r\n  const selectedZoneData = zones.find((z: Zone) => z.id === selectedZone);\r\n  const filteredRecords = filterRecords(records, searchTerm).filter(\r\n    (record: DNSRecord) => (typeFilter ? record.type === typeFilter : true)\r\n  );\r\n\r\n  return (\r\n    <div className=\"min-h-screen bg-background p-4\">\r\n      <div className=\"max-w-6xl mx-auto space-y-6\">\r\n        {/* Header */}\r\n        <Card>\r\n          <CardHeader>\r\n            <div className=\"flex items-center justify-between\">\r\n              <div>\r\n                <CardTitle className=\"text-2xl\">{t('DNS Manager', 'DNS Manager')}</CardTitle>\r\n                <p className=\"text-muted-foreground\">{t('Manage your Cloudflare DNS records', 'Manage your Cloudflare DNS records')}</p>\r\n              </div>\r\n              <Button onClick={handleLogout} variant=\"outline\">\r\n                <LogOut className=\"h-4 w-4 mr-2\" />\r\n                Logout\r\n              </Button>\r\n            </div>\r\n          </CardHeader>\r\n          <CardContent>\r\n            <div className=\"flex gap-4 items-end\">\r\n              <div className=\"flex-1\">\r\n                <Label htmlFor=\"zone-select\">Domain/Zone</Label>\r\n                <Select value={selectedZone} onValueChange={setSelectedZone}>\r\n                  <SelectTrigger>\r\n                    <SelectValue placeholder=\"Select a domain\" />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    {zones.map((zone: Zone) => (\r\n                      <SelectItem key={zone.id} value={zone.id}>\r\n                        {zone.name} ({zone.status})\r\n                      </SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n              </div>\r\n              {selectedZone && (\r\n                <div className=\"flex gap-2\">\r\n                  <AddRecordDialog\r\n                    open={showAddRecord}\r\n                    onOpenChange={setShowAddRecord}\r\n                    record={newRecord}\r\n                    onRecordChange={setNewRecord}\r\n                    onAdd={handleAddRecord}\r\n                    zoneName={selectedZoneData?.name}\r\n                    apiKey={apiKey}\r\n                    email={email}\r\n                  />\r\n                </div>\r\n                )}\r\n            </div>\r\n          </CardContent>\r\n        </Card>\r\n\r\n        {/* DNS Records */}\r\n        {selectedZone && (\r\n          <Card>\r\n            <CardHeader>\r\n              <div className=\"flex items-center justify-between\">\r\n                <CardTitle>DNS Records</CardTitle>\r\n                <div className=\"flex gap-2 items-center\">\r\n                  <Input\r\n                    placeholder={t('Search records', 'Search records')}\r\n                    value={searchTerm}\r\n                    onChange={(e) => setSearchTerm(e.target.value)}\r\n                    className=\"w-[200px]\"\r\n                  />\r\n                  <ImportExportDialog\r\n                    open={showImport}\r\n                    onOpenChange={setShowImport}\r\n                    importData={importData}\r\n                    importFormat={importFormat}\r\n                    onImportDataChange={setImportData}\r\n                    onImportFormatChange={setImportFormat}\r\n                    onImport={handleImport}\r\n                    serverExport={async (format) => {\r\n                      if (!selectedZone) return;\r\n                      try {\r\n                        const res = await exportDNSRecords(selectedZone, format, page, perPage);\r\n                        // create a blob and download\r\n                        const blob = new Blob([res], { type: format === 'json' ? 'application/json' : format === 'csv' ? 'text/csv' : 'text/plain' });\r\n                        const url = URL.createObjectURL(blob);\r\n                        const a = document.createElement('a');\r\n                        a.href = url;\r\n                        a.download = `${selectedZone}-records.${format === 'json' ? 'json' : format === 'csv' ? 'csv' : 'zone'}`;\r\n                        a.click();\r\n                        URL.revokeObjectURL(url);\r\n                        toast({ title: 'Success', description: `Server export ${format.toUpperCase()} completed` });\r\n                      } catch (err) {\r\n                        toast({ title: 'Error', description: 'Server export failed: ' + (err as Error).message, variant: 'destructive' });\r\n                      }\r\n                    }}\r\n                    onExport={handleExport}\r\n                  />\r\n                  <Select value={String(autoRefreshInterval ?? 0)} onValueChange={(v) => setAutoRefreshInterval(v ? Number(v) : null)}>\r\n                    <SelectTrigger className=\"w-32\">\r\n                      <SelectValue placeholder=\"Auto-refresh\" />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      <SelectItem value=\"0\">Off</SelectItem>\r\n                      <SelectItem value=\"60000\">1 min</SelectItem>\r\n                      <SelectItem value=\"300000\">5 min</SelectItem>\r\n                      <SelectItem value=\"600000\">10 min</SelectItem>\r\n                      <SelectItem value=\"1800000\">30 min</SelectItem>\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n              </div>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"flex justify-end mb-4\">\r\n                    <Select value={typeFilter} onValueChange={(v) => setTypeFilter(v as RecordType | '')}>\r\n                  <SelectTrigger className=\"w-[180px]\">\r\n                    <SelectValue placeholder=\"All types\" />\r\n                  </SelectTrigger>\r\n                  <SelectContent>\r\n                    <SelectItem value=\"\">{t('All types', 'All types')}</SelectItem>\r\n                    {RECORD_TYPES.map((type) => (\r\n                      <SelectItem key={type} value={type}>\r\n                        {type}\r\n                      </SelectItem>\r\n                    ))}\r\n                  </SelectContent>\r\n                </Select>\r\n                <div className=\"ml-4 flex items-center gap-2\">\r\n                  <Button size=\"sm\" variant=\"outline\" onClick={() => setPage((p) => Math.max(1, p - 1))} disabled={page <= 1}>Prev</Button>\r\n                  <div className=\"text-sm\">Page {page}</div>\r\n                  <Button size=\"sm\" variant=\"outline\" onClick={() => setPage((p) => p + 1)}>Next</Button>\r\n                  <Select value={String(perPage)} onValueChange={(v) => setPerPage(Number(v) )}>\r\n                    <SelectTrigger className=\"w-28 ml-2\">\r\n                      <SelectValue placeholder=\"Per page\" />\r\n                    </SelectTrigger>\r\n                    <SelectContent>\r\n                      <SelectItem value=\"25\">25</SelectItem>\r\n                      <SelectItem value=\"50\">50</SelectItem>\r\n                      <SelectItem value=\"100\">100</SelectItem>\r\n                    </SelectContent>\r\n                  </Select>\r\n                </div>\r\n              </div>\r\n                {isLoading ? (\r\n                <div className=\"text-center py-8\">Loading...</div>\r\n              ) : filteredRecords.length === 0 ? (\r\n                <div className=\"text-center py-8 text-muted-foreground\">\r\n                  {t('No DNS records found', 'No DNS records found')}\r\n                </div>\r\n              ) : (\r\n                <div className=\"space-y-2\">\r\n                  <List\r\n                    height={Math.min(600, filteredRecords.length * 72)}\r\n                    itemCount={filteredRecords.length}\r\n                    itemSize={72}\r\n                    width={'100%'}\r\n                    >{({ index, style }: { index: number; style: React.CSSProperties }) => {\r\n                    const record = filteredRecords[index];\r\n                    return (\r\n                      <div style={style} key={record.id}>\r\n                        <RecordRow\r\n                          record={record}\r\n                          isEditing={editingRecord === record.id}\r\n                          onEdit={() => setEditingRecord(record.id)}\r\n                          onSave={(updatedRecord: DNSRecord) => handleUpdateRecord(updatedRecord)}\r\n                          onCancel={() => setEditingRecord(null)}\r\n                          onDelete={() => handleDeleteRecord(record.id)}\r\n                        />\r\n                      </div>\r\n                    );\r\n                  }}</List>\r\n                </div>\r\n              )}\r\n            </CardContent>\r\n          </Card>\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\components\\dns\\filter-records.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\components\\dns\\import-export-dialog.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":118,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":118,"endColumn":25}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * UI controls to import and export DNS records for the selected zone.\r\n * This component exposes actions and a modal allowing the user to import\r\n * JSON/CSV/BIND data.\r\n */\r\nimport type { ChangeEvent } from 'react';\r\nimport { useState } from 'react';\r\nimport { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Label } from '@/components/ui/label';\r\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\r\nimport { Upload, Download } from 'lucide-react';\r\nimport { parseCSVRecords, parseBINDZone } from '@/lib/dns-parsers';\r\nimport { ImportPreviewDialog } from './ImportPreviewDialog';\r\nimport type { DNSRecord } from '@/types/dns';\r\n\r\n/**\r\n * Props for the import/export dialog used to import DNS records into\r\n * the current zone or export the records in a selected format.\r\n */\r\ninterface ImportExportDialogProps {\r\n  /** Whether the dialog is open */\r\n  open: boolean;\r\n  /** Callback invoked when the dialog open state changes */\r\n  onOpenChange: (open: boolean) => void;\r\n  /** The raw data being imported */\r\n  importData: string;\r\n  /** Expected import format */\r\n  importFormat: 'json' | 'csv' | 'bind';\r\n  /** Callback invoked when user edits the import data */\r\n  onImportDataChange: (data: string) => void;\r\n  /** Callback invoked when user selects a different import format */\r\n  onImportFormatChange: (format: 'json' | 'csv' | 'bind') => void;\r\n  /** Callback invoked to perform the import */\r\n  onImport: (items?: Partial<DNSRecord>[], dryRun?: boolean) => void;\r\n  /** Callback to export current records using the selected format */\r\n  onExport: (format: 'json' | 'csv' | 'bind') => void;\r\n  serverExport?: (format: 'json' | 'csv' | 'bind') => Promise<void>;\r\n}\r\n\r\n/**\r\n * Render an Import/Export control used by the DNS Manager for importing\r\n * JSON/CSV/BIND formats or exporting the current records.\r\n */\r\nexport function ImportExportDialog({\r\n  open,\r\n  onOpenChange,\r\n  importData,\r\n  importFormat,\r\n  onImportDataChange,\r\n  onImportFormatChange,\r\n  onImport,\r\n  onExport,\r\n  serverExport\r\n}: ImportExportDialogProps) {\r\n  const [previewItems, setPreviewItems] = useState<Partial<DNSRecord>[]>([]);\r\n  const [showPreview, setShowPreview] = useState(false);\r\n  return (\r\n    <div className=\"flex gap-2\">\r\n      <Dialog open={open} onOpenChange={onOpenChange}>\r\n        <DialogTrigger asChild>\r\n          <Button variant=\"outline\" size=\"sm\">\r\n            <Upload className=\"h-4 w-4 mr-2\" />\r\n            Import\r\n          </Button>\r\n        </DialogTrigger>\r\n        <DialogContent>\r\n          <DialogHeader>\r\n            <DialogTitle>Import DNS Records</DialogTitle>\r\n            <DialogDescription>\r\n              Import DNS records from JSON, CSV, or BIND zone formats\r\n            </DialogDescription>\r\n          </DialogHeader>\r\n          <div className=\"space-y-4\">\r\n            <div className=\"space-y-2\">\r\n              <Label>Format</Label>\r\n              <Select value={importFormat} onValueChange={onImportFormatChange}>\r\n                <SelectTrigger>\r\n                  <SelectValue placeholder=\"Select format\" />\r\n                </SelectTrigger>\r\n                <SelectContent>\r\n                  <SelectItem value=\"json\">JSON</SelectItem>\r\n                  <SelectItem value=\"csv\">CSV</SelectItem>\r\n                  <SelectItem value=\"bind\">BIND</SelectItem>\r\n                </SelectContent>\r\n              </Select>\r\n            </div>\r\n            <div className=\"space-y-2\">\r\n              <Label>{importFormat.toUpperCase()} Data</Label>\r\n              <textarea\r\n                className=\"w-full h-32 p-2 border rounded-md bg-background\"\r\n                value={importData}\r\n                onChange={(e: ChangeEvent<HTMLTextAreaElement>) => onImportDataChange(e.target.value)}\r\n                placeholder={`Paste your ${importFormat.toUpperCase()} data here...`}\r\n              />\r\n            </div>\r\n            <Button onClick={() => {\r\n              // Parse and show preview based on selected import format\r\n              let items: Partial<Record<string, unknown>>[] | null = null;\r\n              try {\r\n                switch (importFormat) {\r\n                  case 'json': {\r\n                    const parsed = JSON.parse(importData);\r\n                    items = Array.isArray(parsed)\r\n                      ? parsed\r\n                      : Array.isArray(parsed.records)\r\n                        ? parsed.records\r\n                        : null;\r\n                    break;\r\n                  }\r\n                  case 'csv':\r\n                    items = parseCSVRecords ? parseCSVRecords(importData) : null;\r\n                    break;\r\n                  case 'bind':\r\n                    items = parseBINDZone ? parseBINDZone(importData) : null;\r\n                    break;\r\n                }\r\n              } catch (e) {\r\n                items = null;\r\n              }\r\n\r\n              if (!items) {\r\n                onImport();\r\n                return;\r\n              }\r\n              setPreviewItems(items as Partial<DNSRecord>[]);\r\n              setShowPreview(true);\r\n            }} className=\"w-full\">\r\n              Import Records\r\n            </Button>\r\n          </div>\r\n        </DialogContent>\r\n      </Dialog>\r\n\r\n      <Select onValueChange={(format: 'json' | 'csv' | 'bind') => onExport(format)}>\r\n        <SelectTrigger className=\"w-32\">\r\n          <Download className=\"h-4 w-4 mr-2\" />\r\n          <SelectValue placeholder=\"Export\" />\r\n        </SelectTrigger>\r\n        <SelectContent>\r\n          <SelectItem value=\"json\">JSON</SelectItem>\r\n          <SelectItem value=\"csv\">CSV</SelectItem>\r\n          <SelectItem value=\"bind\">BIND</SelectItem>\r\n        </SelectContent>\r\n      </Select>\r\n      \r\n      <Select onValueChange={async (format: 'json' | 'csv' | 'bind') => {\r\n        if (serverExport) {\r\n          try {\r\n            await serverExport(format);\r\n          } catch (err) {\r\n            console.error('Server export failed', err);\r\n          }\r\n        }\r\n      }}>\r\n        <SelectTrigger className=\"w-28 ml-2\">\r\n          <SelectValue placeholder=\"Server Export\" />\r\n        </SelectTrigger>\r\n        <SelectContent>\r\n          <SelectItem value=\"json\">JSON (server)</SelectItem>\r\n          <SelectItem value=\"csv\">CSV (server)</SelectItem>\r\n          <SelectItem value=\"bind\">BIND (server)</SelectItem>\r\n        </SelectContent>\r\n      </Select>\r\n        {showPreview && (\r\n          <ImportPreviewDialog\r\n            open={showPreview}\r\n            onOpenChange={setShowPreview}\r\n            items={previewItems}\r\n            onConfirm={(items: Partial<DNSRecord>[], dryRun?: boolean) => {\r\n              // Forward parsed items and optionally run as dry-run to the caller\r\n              onImport(items as Partial<DNSRecord>[], dryRun);\r\n              setShowPreview(false);\r\n            }}\r\n            onCancel={() => setShowPreview(false)}\r\n          />\r\n        )}\r\n      </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\components\\ui\\LanguageSelector.tsx","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":16,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":16,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[474,477],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[474,477],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":16,"column":78,"nodeType":null,"messageId":"unusedVar","endLine":16,"endColumn":79}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import * as React from 'react';\r\nimport i18n, { availableLanguages } from '@/i18n';\r\nimport { useTranslation } from 'react-i18next';\r\n\r\nconst languageNames: Record<string, string> = {\r\n  'en-US': 'English',\r\n  'pt-PT': 'Portugus',\r\n};\r\n\r\nexport function LanguageSelector() {\r\n  const { t } = useTranslation();\r\n\r\n  const handleChange = (e: React.ChangeEvent<HTMLSelectElement>) => {\r\n    const lng = e.target.value;\r\n    i18n.changeLanguage(lng);\r\n    try { (globalThis as any).localStorage?.setItem('locale', lng); } catch (_) { /* ignore */ }\r\n  };\r\n\r\n  return (\r\n    <div className=\"p-2\">\r\n      <label htmlFor=\"language\" className=\"sr-only\">\r\n        {t('Language')}\r\n      </label>\r\n      <select\r\n        id=\"language\"\r\n        className=\"border rounded p-1 text-sm\"\r\n        defaultValue={i18n.language}\r\n        onChange={handleChange}\r\n        aria-label=\"Select language\"\r\n      >\r\n        {availableLanguages.map((lng) => (\r\n          <option key={lng} value={lng}>\r\n            {languageNames[lng] ?? lng}\r\n          </option>\r\n        ))}\r\n      </select>\r\n    </div>\r\n  );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\components\\ui\\button.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-refresh/only-export-components","severity":2,"message":"Fast refresh only works when a file only exports components. Use a new file to share constants or functions between components.","line":70,"column":18,"nodeType":"Identifier","messageId":"namedExport","endLine":70,"endColumn":32,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\components\\ui\\card.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\components\\ui\\dialog.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\components\\ui\\input.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\components\\ui\\label.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\components\\ui\\select.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\components\\ui\\switch.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\components\\ui\\toast.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\components\\ui\\toaster.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\hooks\\use-cloudflare-api.ts","messages":[{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":54,"column":7,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":54,"endColumn":20,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[1976,1989],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2012,2015],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2012,2015],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":87,"column":7,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":87,"endColumn":79,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[3228,3300],"text":"// @ts-expect-error - method available on ServerClient when server supports it"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":88,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":88,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3323,3326],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3323,3326],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":95,"column":5,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":95,"endColumn":18,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[3563,3576],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":96,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":96,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3597,3600],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3597,3600],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":101,"column":5,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":101,"endColumn":18,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[3782,3795],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":102,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3816,3819],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3816,3819],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":107,"column":5,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":107,"endColumn":18,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[3994,4007],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":108,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":108,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4028,4031],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4028,4031],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":113,"column":5,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":113,"endColumn":18,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[4221,4234],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":114,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":114,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4255,4258],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4255,4258],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":119,"column":5,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":119,"endColumn":18,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[4468,4481],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":120,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":120,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4502,4505],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4502,4505],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":125,"column":5,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":125,"endColumn":18,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[4698,4711],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":126,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":126,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4732,4735],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4732,4735],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":131,"column":5,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":131,"endColumn":18,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[4939,4952],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":132,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":132,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4973,4976],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4973,4976],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":137,"column":5,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":137,"endColumn":18,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[5241,5254],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":138,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5275,5278],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5275,5278],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":143,"column":5,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":143,"endColumn":77,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[5557,5629],"text":"// @ts-expect-error - method available on ServerClient when server supports it"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":144,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5650,5653],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5650,5653],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/ban-ts-comment","severity":2,"message":"Use \"@ts-expect-error\" instead of \"@ts-ignore\", as \"@ts-ignore\" will do nothing if the following line is error-free.","line":149,"column":5,"nodeType":"Line","messageId":"tsIgnoreInsteadOfExpectError","endLine":149,"endColumn":18,"suggestions":[{"messageId":"replaceTsIgnoreWithTsExpectError","fix":{"range":[5850,5863],"text":"// @ts-expect-error"},"desc":"Replace \"@ts-ignore\" with \"@ts-expect-error\"."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":150,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":150,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5884,5887],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5884,5887],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":24,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useCallback, useMemo } from 'react';\r\nimport { ServerClient } from '../lib/server-client';\r\nimport type { SPFGraph } from '@/lib/spf';\r\nimport type { DNSRecord, Zone } from '../types/dns';\r\n\r\n/**\r\n * React hook exposing a higher-level API for interacting with the\r\n * server-proxied Cloudflare endpoints.\r\n *\r\n * When `apiKey` is provided the hook returns functions bound to a\r\n * `ServerClient` instance. If not provided the functions will reject when\r\n * called, which the UI may use to surface an error.\r\n *\r\n * @param apiKey - API key or token used for server-authenticated requests\r\n * @param email - optional email associated with the API key\r\n * @returns an object containing asynchronous helper functions for zones and\r\n * DNS record operations.\r\n */\r\nexport function useCloudflareAPI(apiKey?: string, email?: string) {\r\n  const api = useMemo(\r\n    () => (apiKey ? new ServerClient(apiKey, undefined, email) : undefined),\r\n    [apiKey, email],\r\n  );\r\n\r\n  // No-op placeholder to trigger build of use-cloudflare-api changes if needed.\r\n  const verifyToken = useCallback(\r\n    async (\r\n      key: string = apiKey ?? '',\r\n      keyEmail: string | undefined = email,\r\n      signal?: AbortSignal,\r\n    ) => {\r\n      if (api) {\r\n        await api.verifyToken(signal);\r\n        return;\r\n      }\r\n      if (!key) return Promise.reject(new Error('API key not provided'));\r\n      const client = new ServerClient(key, undefined, keyEmail);\r\n      await client.verifyToken(signal);\r\n    },\r\n    [api, apiKey, email],\r\n  );\r\n\r\n  const getZones = useCallback(\r\n    (signal?: AbortSignal): Promise<Zone[]> => {\r\n      if (!api) return Promise.reject(new Error('API key not provided'));\r\n      return api.getZones(signal);\r\n    },\r\n    [api],\r\n  );\r\n\r\n  const getDNSRecords = useCallback(\r\n    (zoneId: string, page?: number, perPage?: number, signal?: AbortSignal): Promise<DNSRecord[]> => {\r\n      if (!api) return Promise.reject(new Error('API key not provided'));\r\n      // @ts-ignore\r\n      return (api as any).getDNSRecords(zoneId, page, perPage, signal);\r\n    },\r\n    [api],\r\n  );\r\n\r\n  const createDNSRecord = useCallback(\r\n    (zoneId: string, record: Partial<DNSRecord>, signal?: AbortSignal): Promise<DNSRecord> => {\r\n      if (!api) return Promise.reject(new Error('API key not provided'));\r\n      return api.createDNSRecord(zoneId, record, signal);\r\n    },\r\n    [api],\r\n  );\r\n\r\n  const updateDNSRecord = useCallback(\r\n    (zoneId: string, recordId: string, record: Partial<DNSRecord>, signal?: AbortSignal): Promise<DNSRecord> => {\r\n      if (!api) return Promise.reject(new Error('API key not provided'));\r\n      return api.updateDNSRecord(zoneId, recordId, record, signal);\r\n    },\r\n    [api],\r\n  );\r\n\r\n  const deleteDNSRecord = useCallback(\r\n    (zoneId: string, recordId: string, signal?: AbortSignal): Promise<void> => {\r\n      if (!api) return Promise.reject(new Error('API key not provided'));\r\n      return api.deleteDNSRecord(zoneId, recordId, signal);\r\n    },\r\n    [api],\r\n  );\r\n\r\n  const bulkCreateDNSRecords = useCallback(\r\n    (zoneId: string, records: Partial<DNSRecord>[], dryrun?: boolean, signal?: AbortSignal) => {\r\n      if (!api) return Promise.reject(new Error('API key not provided'));\r\n      // @ts-ignore - method available on ServerClient when server supports it\r\n      return (api as any).bulkCreateDNSRecords(zoneId, records, dryrun, signal);\r\n    },\r\n    [api],\r\n  );\r\n\r\n  const storeVaultSecret = useCallback((id: string, secret: string) => {\r\n    if (!api) return Promise.reject(new Error('API key not provided'));\r\n    // @ts-ignore\r\n    return (api as any).storeVaultSecret(id, secret);\r\n  }, [api]);\r\n\r\n  const getVaultSecret = useCallback((id: string) => {\r\n    if (!api) return Promise.reject(new Error('API key not provided'));\r\n    // @ts-ignore\r\n    return (api as any).getVaultSecret(id);\r\n  }, [api]);\r\n\r\n  const deleteVaultSecret = useCallback((id: string) => {\r\n    if (!api) return Promise.reject(new Error('API key not provided'));\r\n    // @ts-ignore\r\n    return (api as any).deleteVaultSecret(id);\r\n  }, [api]);\r\n\r\n  const getPasskeyRegistrationOptions = useCallback((id: string) => {\r\n    if (!api) return Promise.reject(new Error('API key not provided'));\r\n    // @ts-ignore\r\n    return (api as any).getPasskeyRegistrationOptions(id);\r\n  }, [api]);\r\n\r\n  const registerPasskey = useCallback((id: string, attestation: unknown) => {\r\n    if (!api) return Promise.reject(new Error('API key not provided'));\r\n    // @ts-ignore\r\n    return (api as any).registerPasskey(id, attestation);\r\n  }, [api]);\r\n\r\n  const getPasskeyAuthOptions = useCallback((id: string) => {\r\n    if (!api) return Promise.reject(new Error('API key not provided'));\r\n    // @ts-ignore\r\n    return (api as any).getPasskeyAuthOptions(id);\r\n  }, [api]);\r\n\r\n  const authenticatePasskey = useCallback((id: string, assertion: unknown) => {\r\n    if (!api) return Promise.reject(new Error('API key not provided'));\r\n    // @ts-ignore\r\n    return (api as any).authenticatePasskey(id, assertion);\r\n  }, [api]);\r\n\r\n  const exportDNSRecords = useCallback((zoneId: string, format: 'json'|'csv'|'bind' = 'json', page?: number, perPage?: number) => {\r\n    if (!api) return Promise.reject(new Error('API key not provided'));\r\n    // @ts-ignore\r\n    return (api as any).exportDNSRecords(zoneId, format, page, perPage);\r\n  }, [api]);\r\n\r\n  const simulateSPF = useCallback((domain: string, ip: string): Promise<{ result: string; reasons: string[]; lookups: number }> => {\r\n    if (!api) return Promise.reject(new Error('API key not provided'));\r\n    // @ts-ignore - method available on ServerClient when server supports it\r\n    return (api as any).simulateSPF(domain, ip);\r\n  }, [api]);\r\n\r\n  const getSPFGraph = useCallback((domain: string): Promise<SPFGraph> => {\r\n    if (!api) return Promise.reject(new Error('API key not provided'));\r\n    // @ts-ignore\r\n    return (api as any).getSPFGraph(domain);\r\n  }, [api]);\r\n\r\n  return {\r\n      simulateSPF,\r\n      getSPFGraph,\r\n    verifyToken,\r\n    getZones,\r\n    getDNSRecords,\r\n    createDNSRecord,\r\n    updateDNSRecord,\r\n    deleteDNSRecord,\r\n    bulkCreateDNSRecords,\r\n    storeVaultSecret,\r\n    getVaultSecret,\r\n    deleteVaultSecret,\r\n    getPasskeyRegistrationOptions,\r\n    registerPasskey,\r\n    getPasskeyAuthOptions,\r\n    authenticatePasskey,\r\n    exportDNSRecords,\r\n  };\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\hooks\\use-toast.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\i18n.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[564,567],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[564,567],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[622,625],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[622,625],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[909,912],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[909,912],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":30,"column":12,"nodeType":null,"messageId":"unusedVar","endLine":30,"endColumn":13}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import i18n from 'i18next';\r\nimport { initReactI18next } from 'react-i18next';\r\n\r\n// Dynamically load translation resources from `src/locales` files. This\r\n// allows us to keep translations in dedicated JSON files, decoupled from the\r\n// JavaScript initialization code. We use the language keys `en-US` and\r\n// `pt-PT` for now but the structure is flexible for more locales.\r\nconst loadResources = async () => {\r\n  const en = await import('./locales/en-US.json');\r\n  const pt = await import('./locales/pt-PT.json');\r\n  return {\r\n    'en-US': { translation: (en as any).default || en },\r\n    'pt-PT': { translation: (pt as any).default || pt },\r\n  };\r\n};\r\n\r\n(async () => {\r\n  const resources = await loadResources();\r\n  i18n.use(initReactI18next).init({\r\n    resources,\r\n    lng: 'en-US',\r\n    fallbackLng: 'en-US',\r\n    interpolation: { escapeValue: false },\r\n  });\r\n  try {\r\n    const saved = (globalThis as any).localStorage?.getItem('locale');\r\n    if (typeof saved === 'string' && Object.prototype.hasOwnProperty.call(resources, saved)) {\r\n      void i18n.changeLanguage(saved);\r\n    }\r\n  } catch (_) {\r\n    // Ignore storage access errors in test or SSR environments\r\n  }\r\n})();\r\n\r\nexport default i18n;\r\n\r\nexport const availableLanguages = ['en-US', 'pt-PT'] as const;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\lib\\async-handler.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\lib\\audit.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_e' is defined but never used.","line":29,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":29,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":32,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":32,"endColumn":15},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1469,1472],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1469,1472],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":44,"column":27,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":44,"endColumn":30,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1520,1523],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1520,1523],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_e' is defined but never used.","line":45,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":45,"endColumn":16}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[969,972],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[969,972],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":40,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1354,1357],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1354,1357],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Simple audit logger used to record actions performed on sensitive objects.\r\n * For now this logs to console. Later it can be extended to write to a DB or\r\n * a rotating file.\r\n */\r\nexport type AuditEntry = {\r\n  actor?: string;\r\n  operation: string;\r\n  resource?: string;\r\n  details?: unknown;\r\n  timestamp?: string;\r\n};\r\n\r\nconst entries: AuditEntry[] = [];\r\nimport createCredentialStore from './credential-store';\r\nconst store = createCredentialStore();\r\n\r\nexport function logAudit(entry: AuditEntry) {\r\n  const final: AuditEntry = { ...entry, timestamp: new Date().toISOString() };\r\n  entries.push(final);\r\n  // Simple console log for now; in production route to structured log\r\n  // or write to a secure audit store.\r\n    try {\r\n      console.info('AUDIT', JSON.stringify(final));\r\n      // If sqlite store exists, write audit there too (fire-and-forget)\r\n      try {\r\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n        (store as any).writeAudit?.(final)?.catch?.(() => undefined);\r\n      } catch (_e) {\r\n        // ignore\r\n      }\r\n    } catch (e) {\r\n    // ignore errors during logging.\r\n  }\r\n}\r\n\r\nexport async function getAuditEntries(): Promise<AuditEntry[]> {\r\n  // If DB store available return DB entries, otherwise in-memory\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  if ((store as any).getAuditEntries) {\r\n    try {\r\n      // convert DB rows into AuditEntry[]\r\n      const rows = await (store as any).getAuditEntries();\r\n      return rows.map((r: any) => ({ actor: r.actor, operation: r.operation, resource: r.resource, details: JSON.parse(r.details || '{}'), timestamp: r.timestamp }));\r\n    } catch (_e) {\r\n      return [...entries];\r\n    }\r\n  }\r\n  return [...entries];\r\n}\r\n\r\nexport function clearAuditEntries(): void {\r\n  entries.length = 0;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\lib\\cloudflare.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":140,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4549,4552],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4549,4552],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":143,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":143,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4739,4742],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4739,4742],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":144,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4789,4792],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4789,4792],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":165,"column":68,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":165,"endColumn":71,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5587,5590],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5587,5590],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":165,"column":89,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":165,"endColumn":92,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5608,5611],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5608,5611],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":186,"column":78,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":186,"endColumn":81,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6440,6443],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6440,6443],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":186,"column":99,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":186,"endColumn":102,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6461,6464],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6461,6464],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":7,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/**\r\n * Cloudflare API wrapper\r\n *\r\n * This module provides a minimal wrapper around the Cloudflare SDK that\r\n * exposes the operations required by the application: listing zones and DNS\r\n * records, and creating/updating/deleting DNS records.\r\n *\r\n * It consolidates debug logging and request/response inspection behind a\r\n * DEBUG flag and re-exports a typed `CloudflareAPI` class with convenience\r\n * helper methods.\r\n */\r\nimport 'cloudflare/shims/web';\r\nimport Cloudflare from 'cloudflare';\r\nimport type { DNSRecord, Zone } from '@/types/dns';\r\nimport { getEnv, getEnvBool } from './env';\r\n\r\nconst DEFAULT_CLOUDFLARE_API_BASE = 'https://api.cloudflare.com/client/v4';\r\nconst DEBUG = getEnvBool('DEBUG_CF_API', 'VITE_DEBUG_CF_API');\r\n\r\n/**\r\n * Client to interact with the Cloudflare REST API.\r\n *\r\n * The class wraps the official `cloudflare` library instance and exposes a\r\n * small, typed surface used by the app. Each method returns typed records or\r\n * throws on error.\r\n */\r\nexport class CloudflareAPI {\r\n  private client: Cloudflare;\r\n\r\n  /**\r\n   * Create a Cloudflare API client for the given credentials.\r\n   *\r\n   * @param apiKey - API token or global API key\r\n   * @param baseUrl - Optional Cloudflare API base (defaults to CLOUDFLARE_API_BASE)\r\n   * @param email - Optional email for API key authentication (used with apiKey)\r\n   */\r\n  constructor(\r\n    apiKey: string,\r\n    baseUrl: string = getEnv(\r\n      'CLOUDFLARE_API_BASE',\r\n      'VITE_CLOUDFLARE_API_BASE',\r\n      DEFAULT_CLOUDFLARE_API_BASE,\r\n    )!,\r\n    email?: string,\r\n  ) {\r\n    this.client = new Cloudflare({\r\n      apiToken: email ? null : apiKey,\r\n      apiKey: email ? apiKey : null,\r\n      apiEmail: email ?? null,\r\n      baseURL: String(baseUrl),\r\n      fetch: fetch,\r\n    });\r\n    if (DEBUG) {\r\n      console.debug('Initialized CloudflareAPI', {\r\n        baseUrl: this.client.baseURL,\r\n        email: email ? 'provided' : 'none',\r\n      });\r\n    }\r\n  }\r\n\r\n\r\n\r\n  /**\r\n   * Log the outgoing request when DEBUG is enabled.\r\n   *\r\n   * @param path - relative path of the request\r\n   * @param options - optional request metadata such as method and body\r\n   */\r\n  private debugRequest(path: string, options?: { method?: string; body?: unknown }) {\r\n    if (!DEBUG) return;\r\n    console.debug('CF API request:', {\r\n      url: `${this.client.baseURL}${path}`,\r\n      method: options?.method ?? 'GET',\r\n      body: options?.body,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Log the response payload when DEBUG is enabled.\r\n   *\r\n   * @param data - the response data to log\r\n   */\r\n  private debugResponse(data: unknown) {\r\n    if (!DEBUG) return;\r\n    console.debug('CF API response:', data);\r\n  }\r\n\r\n  /**\r\n   * Build a Cloudflare-compatible parameter object for record creation and\r\n   * update endpoints. Fields with `undefined` values are omitted.\r\n   *\r\n   * @param zoneId - Cloudflare zone identifier\r\n   * @param record - partial DNSRecord with fields to send\r\n   * @returns the params object suitable for the Cloudflare SDK\r\n   */\r\n  private buildRecordParams(zoneId: string, record: Partial<DNSRecord>) {\r\n    const params: Record<string, unknown> = {\r\n      zone_id: zoneId,\r\n      type: record.type,\r\n      name: record.name,\r\n      content: record.content,\r\n      ttl: record.ttl === 'auto' ? 1 : record.ttl,\r\n      priority: record.priority,\r\n      proxied: record.proxied,\r\n    };\r\n    for (const key of Object.keys(params)) {\r\n      if (params[key] === undefined) delete params[key];\r\n    }\r\n    return params;\r\n  }\r\n\r\n  /**\r\n   * List all zones available to the configured account/token.\r\n   *\r\n   * @param signal - optional AbortSignal to cancel the request\r\n   * @returns an array of Zone objects\r\n   */\r\n  async getZones(signal?: AbortSignal): Promise<Zone[]> {\r\n    if (DEBUG) console.debug('getZones');\r\n    this.debugRequest('/zones');\r\n    const zones: Zone[] = [];\r\n    for await (const zone of this.client.zones.list({}, { signal })) {\r\n      zones.push(zone as Zone);\r\n    }\r\n    this.debugResponse(zones);\r\n    return zones;\r\n  }\r\n\r\n  /**\r\n   * List DNS records for a specific zone.\r\n   *\r\n   * @param zoneId - the id of the zone to list records for\r\n   * @param signal - optional AbortSignal to cancel the request\r\n   * @returns a list of DNSRecord objects\r\n   */\r\n  async getDNSRecords(zoneId: string, page?: number, perPage?: number, signal?: AbortSignal): Promise<DNSRecord[]> {\r\n    if (DEBUG) console.debug('getDNSRecords', { zoneId });\r\n    this.debugRequest(`/zones/${zoneId}/dns_records`);\r\n    const records: DNSRecord[] = [];\r\n    const listParams: any = { zone_id: zoneId };\r\n    if (page) listParams.page = page;\r\n    if (perPage) listParams.per_page = perPage;\r\n    for await (const record of this.client.dns.records.list(listParams as any, { signal })) {\r\n      records.push(record as any as DNSRecord);\r\n    }\r\n    this.debugResponse(records);\r\n    return records;\r\n  }\r\n\r\n  /**\r\n   * Create a new DNS record in the specified zone.\r\n   *\r\n   * @param zoneId - the Cloudflare zone id\r\n   * @param record - partial DNS record object with required fields\r\n   * @param signal - optional AbortSignal to cancel the request\r\n   * @returns the created DNSRecord\r\n   */\r\n  async createDNSRecord(zoneId: string, record: Partial<DNSRecord>, signal?: AbortSignal): Promise<DNSRecord> {\r\n    if (DEBUG) console.debug('createDNSRecord', { zoneId, record });\r\n    this.debugRequest(`/zones/${zoneId}/dns_records`, {\r\n      method: 'POST',\r\n      body: record,\r\n    });\r\n    const params = this.buildRecordParams(zoneId, record);\r\n    const result = (await this.client.dns.records.create(params as any, { signal })) as any as DNSRecord;\r\n    this.debugResponse(result);\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Update an existing DNS record.\r\n   *\r\n   * @param zoneId - zone containing the record\r\n   * @param recordId - the id of the DNS record to update\r\n   * @param record - fields to update\r\n   * @param signal - optional AbortSignal\r\n   * @returns the updated DNSRecord\r\n   */\r\n  async updateDNSRecord(zoneId: string, recordId: string, record: Partial<DNSRecord>, signal?: AbortSignal): Promise<DNSRecord> {\r\n    if (DEBUG) console.debug('updateDNSRecord', { zoneId, recordId, record });\r\n    this.debugRequest(`/zones/${zoneId}/dns_records/${recordId}`, {\r\n      method: 'PUT',\r\n      body: record,\r\n    });\r\n    const params = this.buildRecordParams(zoneId, record);\r\n    const result = (await this.client.dns.records.update(recordId, params as any, { signal })) as any as DNSRecord;\r\n    this.debugResponse(result);\r\n    return result;\r\n  }\r\n\r\n  /**\r\n   * Delete a DNS record.\r\n   *\r\n   * @param zoneId - zone containing the record\r\n   * @param recordId - the id of the DNS record to delete\r\n   * @param signal - optional AbortSignal\r\n   */\r\n  async deleteDNSRecord(zoneId: string, recordId: string, signal?: AbortSignal): Promise<void> {\r\n    if (DEBUG) console.debug('deleteDNSRecord', { zoneId, recordId });\r\n    this.debugRequest(`/zones/${zoneId}/dns_records/${recordId}`, { method: 'DELETE' });\r\n    await this.client.dns.records.delete(recordId, { zone_id: zoneId }, { signal });\r\n    this.debugResponse({ deleted: recordId });\r\n  }\r\n\r\n  /**\r\n   * Verify a provided token or key by calling the token verification endpoint.\r\n   *\r\n   * This method can be used to check whether the provided credentials are\r\n   * valid for subsequent requests.\r\n   *\r\n   * @param signal - optional AbortSignal\r\n   */\r\n  async verifyToken(signal?: AbortSignal): Promise<void> {\r\n    if (DEBUG) console.debug('verifyToken');\r\n    this.debugRequest('/user/tokens/verify');\r\n    try {\r\n      // Try token verification endpoint; if it fails (e.g. using a global\r\n      // key with email) fall back to a lightweight call that validates\r\n      // credentials such as listing zones.\r\n      await this.client.user.tokens.verify({ signal });\r\n    } catch (err) {\r\n      this.debugResponse({ verified: false, error: (err as Error).message });\r\n      // fallback: try to list zones with a single page to validate creds\r\n      await this.client.zones.list({ page: 1, per_page: 1 }, { signal });\r\n    }\r\n    this.debugResponse({ verified: true });\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\lib\\credential-store.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":77,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2921,2924],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2921,2924],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":99,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3846,3849],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3846,3849],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":105,"column":16,"nodeType":null,"messageId":"unusedVar","endLine":105,"endColumn":17},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":133,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":133,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5207,5210],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5207,5210],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":144,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6046,6049],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6046,6049],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_e' is defined but never used.","line":170,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":170,"endColumn":20}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { promises as fs, mkdirSync } from 'fs';\r\nimport path from 'path';\r\nimport { vaultManager } from '../server/vault';\r\nimport { getEnv } from './env';\r\nimport openSqlite from './sqlite-driver';\r\nimport type { SqliteWrapper } from './sqlite-driver';\r\n\r\nexport type PasskeyCredential = {\r\n  credentialID: string;\r\n  credentialPublicKey: string;\r\n  counter?: number;\r\n  createdAt?: string;\r\n  label?: string;\r\n};\r\n\r\nexport interface CredentialStore {\r\n  getCredentials(id: string): Promise<PasskeyCredential[]>;\r\n  addCredential(id: string, cred: PasskeyCredential): Promise<void>;\r\n  deleteCredential(id: string, cid: string): Promise<void>;\r\n}\r\n\r\n/** File-based small credential store for demo/dev. Not recommended for prod. */\r\nclass FileCredentialStore implements CredentialStore {\r\n  private filePath: string;\r\n  constructor(file?: string) {\r\n    const base = file ?? path.resolve(process.cwd(), 'data', 'credentials.json');\r\n    this.filePath = base;\r\n  }\r\n  private async load(): Promise<Record<string, PasskeyCredential[]>> {\r\n    try {\r\n      const content = await fs.readFile(this.filePath, 'utf-8');\r\n      return JSON.parse(content);\r\n    } catch {\r\n      return {};\r\n    }\r\n  }\r\n  private async save(obj: Record<string, PasskeyCredential[]>) {\r\n    await fs.mkdir(path.dirname(this.filePath), { recursive: true });\r\n    await fs.writeFile(this.filePath, JSON.stringify(obj, null, 2), { mode: 0o600 });\r\n  }\r\n  async getCredentials(id: string) {\r\n    const obj = await this.load();\r\n    return obj[id] ?? [];\r\n  }\r\n  async addCredential(id: string, cred: PasskeyCredential) {\r\n    const obj = await this.load();\r\n    obj[id] = obj[id] ?? [];\r\n    obj[id].push({ ...cred, createdAt: new Date().toISOString() });\r\n    await this.save(obj);\r\n  }\r\n  async deleteCredential(id: string, cid: string) {\r\n    const obj = await this.load();\r\n    const arr = obj[id] ?? [];\r\n    obj[id] = arr.filter((c) => c.credentialID !== cid);\r\n    await this.save(obj);\r\n  }\r\n}\r\n\r\nclass VaultCredentialStore implements CredentialStore {\r\n  async getCredentials(id: string) {\r\n    const stored = await vaultManager.getSecret(`passkey:${id}`);\r\n    if (!stored) return [];\r\n    const parsed = JSON.parse(stored);\r\n    return Array.isArray(parsed) ? parsed : [parsed];\r\n  }\r\n  async addCredential(id: string, cred: PasskeyCredential) {\r\n    const stored = await vaultManager.getSecret(`passkey:${id}`);\r\n    const parsed = stored ? JSON.parse(stored) : [];\r\n    const arr = Array.isArray(parsed) ? parsed : [parsed];\r\n    arr.push({ ...cred, createdAt: new Date().toISOString() });\r\n    await vaultManager.setSecret(`passkey:${id}`, JSON.stringify(arr));\r\n  }\r\n  async deleteCredential(id: string, cid: string) {\r\n    const stored = await vaultManager.getSecret(`passkey:${id}`);\r\n    const parsed = stored ? JSON.parse(stored) : [];\r\n    const arr = Array.isArray(parsed) ? parsed : [parsed];\r\n    const filtered = arr.filter((c: any) => (c.credentialID ?? c.id) !== cid);\r\n    await vaultManager.setSecret(`passkey:${id}`, JSON.stringify(filtered));\r\n  }\r\n}\r\n/** Very small in-memory credential store used for testing and lightweight runs */\r\nclass MemoryCredentialStore implements CredentialStore {\r\n  private map: Map<string, PasskeyCredential[]> = new Map();\r\n  async getCredentials(id: string) {\r\n    return (this.map.get(id) ?? []).slice();\r\n  }\r\n  async addCredential(id: string, cred: PasskeyCredential) {\r\n    const arr = this.map.get(id) ?? [];\r\n    arr.push({ ...cred, createdAt: new Date().toISOString() });\r\n    this.map.set(id, arr);\r\n  }\r\n  async deleteCredential(id: string, cid: string) {\r\n    const arr = this.map.get(id) ?? [];\r\n    this.map.set(id, arr.filter((c) => c.credentialID !== cid));\r\n  }\r\n}\r\n  export class SqliteCredentialStore implements CredentialStore {\r\n    private db!: SqliteWrapper;\r\n    private initPromise: Promise<any> | null = null;\r\n    constructor(dbFile?: string, dbWrapper?: SqliteWrapper) {\r\n      const f = dbFile ?? path.resolve(process.cwd(), 'data', 'credentials.db');\r\n      // Ensure directory exists before opening the database\r\n      try {\r\n        mkdirSync(path.dirname(f), { recursive: true });\r\n      } catch (e) {\r\n        // ignore\r\n      }\r\n      this.db = dbWrapper ?? openSqlite(f);\r\n      // Initialize schema (use promise API of wrapper)\r\n      this.initPromise = (async () => {\r\n        await this.db.run(`CREATE TABLE IF NOT EXISTS credentials (\r\n        id TEXT NOT NULL,\r\n        credential_id TEXT NOT NULL,\r\n        public_key TEXT,\r\n        counter INTEGER DEFAULT 0,\r\n        created_at TEXT,\r\n        label TEXT,\r\n        PRIMARY KEY(id, credential_id)\r\n        )`);\r\n        await this.db.run(`CREATE TABLE IF NOT EXISTS audit_log (\r\n        id INTEGER PRIMARY KEY AUTOINCREMENT,\r\n        actor TEXT,\r\n        operation TEXT,\r\n        resource TEXT,\r\n        details TEXT,\r\n        timestamp TEXT\r\n        )`);\r\n      })();\r\n    }\r\n    async getCredentials(id: string): Promise<PasskeyCredential[]> {\r\n        await this.initPromise;\r\n        const rows = await this.db.all('SELECT credential_id, public_key as credentialPublicKey, counter, created_at as createdAt, label FROM credentials WHERE id = ?', [id]);\r\n        return rows.map((r: any) => ({ credentialID: r.credential_id, credentialPublicKey: r.credentialPublicKey, counter: r.counter, createdAt: r.createdAt, label: r.label }));\r\n    }\r\n    async addCredential(id: string, cred: PasskeyCredential) {\r\n      await this.initPromise;\r\n      await this.db.run('INSERT OR REPLACE INTO credentials(id, credential_id, public_key, counter, created_at, label) VALUES(?, ?, ?, ?, ?, ?)', [id, cred.credentialID, cred.credentialPublicKey, cred.counter ?? 0, cred.createdAt ?? new Date().toISOString(), cred.label ?? null]);\r\n    }\r\n    async deleteCredential(id: string, cid: string) {\r\n      await this.initPromise;\r\n      await this.db.run('DELETE FROM credentials WHERE id = ? AND credential_id = ?', [id, cid]);\r\n    }\r\n    // Simple audit log insertion (we'll use for audit write from audit module)\r\n    async writeAudit(a: any) {\r\n      await this.initPromise;\r\n      await this.db.run('INSERT INTO audit_log(actor, operation, resource, details, timestamp) VALUES(?, ?, ?, ?, ?)', [a.actor ?? null, a.operation, a.resource ?? null, JSON.stringify(a.details ?? {}), a.timestamp ?? new Date().toISOString()]);\r\n    }\r\n    async getAuditEntries() {\r\n      await this.initPromise;\r\n      return await this.db.all('SELECT id, actor, operation, resource, details, timestamp FROM audit_log ORDER BY id DESC');\r\n    }\r\n  }\r\n\r\nexport const createCredentialStore = () => {\r\n  const storeType = getEnv('CREDENTIAL_STORE', 'VITE_CREDENTIAL_STORE', 'vault');\r\n  if (storeType === 'file') return new FileCredentialStore();\r\n  if (storeType === 'memory') return new MemoryCredentialStore();\r\n    if (storeType === 'sqlite') {\r\n      try {\r\n        return new SqliteCredentialStore();\r\n      } catch (err) {\r\n        // If opening the sqlite driver fails (native dependency missing),\r\n        // try creating a sqlite-backed store that uses the in-memory wrapper\r\n        // implemented in openSqlite (so it behaves like a sqlite DB to the\r\n        // higher-level code). This keeps APIs (db.run/get/all) available.\r\n        console.warn('Sqlite not available; attempting in-memory sqlite fallback:', err?.message ?? err);\r\n        try {\r\n          const inMem = openSqlite(undefined);\r\n          return new SqliteCredentialStore(undefined, inMem);\r\n        } catch (_e) {\r\n          console.warn('In-memory sqlite fallback failed, using memory-only store');\r\n          return new MemoryCredentialStore();\r\n        }\r\n      }\r\n    }\r\n  // defaults to vault\r\n  return new VaultCredentialStore();\r\n};\r\n\r\nexport default createCredentialStore;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\lib\\crypto-benchmark.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\lib\\crypto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\lib\\dns-parsers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\lib\\env.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\lib\\export-api.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\lib\\rbac.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1003,1006],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1003,1006],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1122,1125],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1122,1125],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1161,1164],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1161,1164],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1177,1180],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1177,1180],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":37,"column":14,"nodeType":null,"messageId":"unusedVar","endLine":37,"endColumn":15}],"suppressedMessages":[],"errorCount":5,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { Request, Response, NextFunction } from 'express';\r\nimport { getEnv } from './env';\r\nimport createCredentialStore from './credential-store';\r\n\r\n/**\r\n * Simple RBAC middleware: allow when x-admin-token matches env ADMIN_TOKEN or\r\n * when the request contains a header `x-auth-email` that corresponds to a\r\n * user row with role \"admin\" in the sqlite user table. This is intentionally\r\n * lightweight - for production consider using a robust identity system.\r\n */\r\nexport async function isAdmin(req: Request, res: Response, next: NextFunction) {\r\n  const adminToken = getEnv('ADMIN_TOKEN', 'VITE_ADMIN_TOKEN', undefined);\r\n  const reqAdmin = req.header('x-admin-token');\r\n  if (reqAdmin && adminToken && reqAdmin === adminToken) return next();\r\n\r\n  // fallback to check email mapping in sqlite (if credential store supports DB)\r\n  const email = req.header('x-auth-email');\r\n  if (!email) {\r\n    res.status(403).json({ error: 'Admin credentials required' });\r\n    return;\r\n  }\r\n  const store: any = createCredentialStore();\r\n  // if store exposes a db (sqlite store), check users table\r\n  if (store && (store as any).db) {\r\n    try {\r\n      const db: any = (store as any).db;\r\n      await db.run('CREATE TABLE IF NOT EXISTS users (id TEXT PRIMARY KEY, email TEXT, roles TEXT)');\r\n      const row = await db.get('SELECT roles FROM users WHERE email = ?', [email]);\r\n      if (!row) {\r\n        res.status(403).json({ error: 'Admin credentials required' });\r\n        return;\r\n      }\r\n      const roles = JSON.parse(row.roles || '[]');\r\n      if (Array.isArray(roles) && roles.includes('admin')) {\r\n        return next();\r\n      }\r\n    } catch (e) {\r\n      // fallback to deny\r\n      res.status(403).json({ error: 'Admin credentials required' });\r\n      return;\r\n    }\r\n  }\r\n  res.status(403).json({ error: 'Admin credentials required' });\r\n}\r\n\r\nexport default { isAdmin };\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\lib\\server-api.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":121,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":121,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4550,4553],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4550,4553],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":370,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":370,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[14363,14366],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[14363,14366],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":407,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":407,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[15824,15827],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[15824,15827],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":469,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":469,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18272,18275],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18272,18275],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":475,"column":71,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":475,"endColumn":74,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[18499,18502],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[18499,18502],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":485,"column":226,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":485,"endColumn":229,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[19327,19330],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[19327,19330],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":513,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":513,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[20522,20525],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[20522,20525],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":533,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":533,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[21449,21452],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[21449,21452],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":554,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":554,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[22238,22241],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[22238,22241],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_e' is defined but never used.","line":564,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":564,"endColumn":20},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":616,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":616,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25324,25327],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25324,25327],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":617,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":617,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25366,25369],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25366,25369],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":618,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":618,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25423,25426],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25423,25426],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":618,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":618,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[25434,25437],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[25434,25437],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":637,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":637,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26412,26415],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26412,26415],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":638,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":638,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26454,26457],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26454,26457],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":639,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":639,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26511,26514],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26511,26514],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":639,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":639,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[26522,26525],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[26522,26525],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":668,"column":50,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":668,"endColumn":53,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27775,27778],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27775,27778],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":669,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":669,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27817,27820],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27817,27820],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":670,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":670,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27874,27877],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27874,27877],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":670,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":670,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[27885,27888],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[27885,27888],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":710,"column":39,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":710,"endColumn":42,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29760,29763],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29760,29763],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":712,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":712,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[29878,29881],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[29878,29881],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":719,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":719,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[30261,30264],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[30261,30264],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":732,"column":18,"nodeType":null,"messageId":"unusedVar","endLine":732,"endColumn":19},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":747,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":747,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[31495,31498],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[31495,31498],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":27,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import type { Request, Response } from 'express';\r\nimport { CloudflareAPI } from './cloudflare';\r\nimport { vaultManager } from '../server/vault';\r\nimport createCredentialStore from './credential-store';\r\nimport { logAudit } from './audit';\r\nimport { getAuditEntries } from './audit';\r\nimport swauth from './simplewebauthn-wrapper';\r\nimport { dnsRecordSchema } from './validation';\r\nimport type { Zone } from '@/types/dns';\r\nimport { validateSPFContentAsync } from './spf';\r\nimport { getEnv, getEnvBool } from './env';\r\nimport { simulateSPF, buildSPFGraph } from './spf';\r\n\r\nconst DEBUG = getEnvBool('DEBUG_SERVER_API', 'VITE_DEBUG_SERVER_API');\r\n\r\n/**\r\n * Build a CloudflareAPI client from the request's authentication headers.\r\n *\r\n * Supports either a `Bearer <token>` authorization header or a pair of\r\n * `x-auth-key` and `x-auth-email` headers. Throws a 400 error if neither\r\n * method is supplied.\r\n *\r\n * @param req - express request object\r\n * @returns an instance of CloudflareAPI configured with the appropriate creds\r\n */\r\nfunction createClient(req: Request): CloudflareAPI {\r\n  const auth = req.header('authorization');\r\n  if (auth?.startsWith('Bearer ')) {\r\n    if (DEBUG) console.debug('Using bearer token for Cloudflare API');\r\n    return new CloudflareAPI(auth.slice(7));\r\n  }\r\n  const key = req.header('x-auth-key');\r\n  const email = req.header('x-auth-email');\r\n  if (key && email) {\r\n    if (DEBUG) console.debug('Using key/email for Cloudflare API');\r\n    return new CloudflareAPI(key, undefined, email);\r\n  }\r\n  const err = new Error('Missing Cloudflare credentials') as Error & {\r\n    status?: number;\r\n  };\r\n  err.status = 400;\r\n  throw err;\r\n}\r\n\r\nfunction actorFromReq(req: Request) {\r\n  return req.header('x-auth-email') || req.header('authorization') || req.header('x-admin-token') || 'unknown';\r\n}\r\n\r\n/**\r\n * HTTP handlers used by the server API.\r\n *\r\n * All functions are declared as static factory methods returning an\r\n * express-compatible request handler (req, res) => Promise. The returned\r\n * handler is used by `src/server/router` and wrapped with `asyncHandler` in\r\n * order to forward exceptions to the global error middleware.\r\n */\r\nexport class ServerAPI {\r\n  /**\r\n   * Handler to verify that the provided credentials are valid with Cloudflare.\r\n   *\r\n   * Returns 200 if verification succeeded.\r\n   */\r\n  static verifyToken() {\r\n    /**\r\n     * @returns express RequestHandler that verifies the provided credentials\r\n     */\r\n    return async (req: Request, res: Response) => {\r\n      const client = createClient(req);\r\n      await client.verifyToken();\r\n      logAudit({ operation: 'auth:verify', actor: actorFromReq(req), resource: 'auth:token' });\r\n      res.json({ success: true });\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Handler to list the zones reachable by the provided credentials.\r\n   */\r\n  static getZones() {\r\n    /**\r\n     * @returns express RequestHandler that lists zones for the credentials\r\n     */\r\n    return async (req: Request, res: Response) => {\r\n      const client = createClient(req);\r\n      const zones = await client.getZones();\r\n      logAudit({ operation: 'zones:list', actor: actorFromReq(req), resource: 'zones' });\r\n      res.json(zones);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Handler to return DNS records for the requested zone.\r\n   */\r\n  static getDNSRecords() {\r\n    /**\r\n     * @returns express RequestHandler that returns DNS records for a zone\r\n     * @param req.params.zone - zone id used to select the records\r\n     */\r\n    return async (req: Request, res: Response) => {\r\n      const client = createClient(req);\r\n      const page = req.query.page ? Number.parseInt(String(req.query.page), 10) : undefined;\r\n      const perPage = req.query.per_page ? Number.parseInt(String(req.query.per_page), 10) : undefined;\r\n      const records = await client.getDNSRecords(req.params.zone, page, perPage);\r\n      logAudit({ operation: 'dns:list', actor: actorFromReq(req), resource: `zone:${req.params.zone}`, details: { page, perPage } });\r\n      res.json(records);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Handler to create a DNS record. It validates the request body with\r\n   * `dnsRecordSchema` and returns the newly created DNS record.\r\n   */\r\n  static createDNSRecord() {\r\n    /**\r\n     * @returns express RequestHandler that validates and creates a DNS record\r\n     */\r\n    return async (req: Request, res: Response) => {\r\n      const parsed = dnsRecordSchema.safeParse(req.body);\r\n      if (!parsed.success) {\r\n        res.status(400).json({\r\n          error: parsed.error.issues\r\n            .map((issue: any) => `${issue.path.join('.')}: ${issue.message}`)\r\n            .join(', '),\r\n        });\r\n        return;\r\n      }\r\n      const client = createClient(req);\r\n      if (parsed.data.type === 'SPF') {\r\n        // compute the fqdn from the zone name + record name\r\n        let fqdn = parsed.data.name;\r\n        try {\r\n          const zones: Zone[] = await client.getZones();\r\n          const zone = zones.find((z) => z.id === req.params.zone);\r\n          const zoneName = zone ? zone.name : req.params.zone;\r\n          fqdn = (parsed.data.name === '@' || parsed.data.name === '') ? zoneName : `${parsed.data.name}.${zoneName}`;\r\n        } catch {\r\n          // fallback to using raw name\r\n          if (!fqdn || fqdn === '@') fqdn = parsed.data.name || req.params.zone;\r\n        }\r\n        const v = await validateSPFContentAsync(parsed.data.content ?? '', fqdn);\r\n        if (!v.ok) {\r\n          res.status(400).json({ error: `SPF validation failed: ${v.problems.join(', ')}` });\r\n          return;\r\n        }\r\n      }\r\n      const record = await client.createDNSRecord(\r\n        req.params.zone,\r\n        parsed.data,\r\n      );\r\n      logAudit({ operation: 'dns:create', actor: actorFromReq(req), resource: `zone:${req.params.zone}`, details: { record } });\r\n      res.json(record);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Handler to bulk-create DNS records. Accepts an array of records in the\r\n   * request body and creates them in sequence. Returns an array of created\r\n   * records and an optional `skipped` count for invalid or duplicate items.\r\n   */\r\n  static createBulkDNSRecords() {\r\n    /**\r\n     * Express handler for bulk DNS record creation.\r\n     *\r\n     * The handler accepts an array of DNS records in the request body and\r\n     * validates each with `dnsRecordSchema`. If `?dryrun=1` is present, it\r\n     * returns what would have been created without actually calling\r\n     * Cloudflare's API. The response contains `created` and `skipped` arrays\r\n     * with details about the processing.\r\n     */\r\n    return async (req: Request, res: Response) => {\r\n      const items = req.body;\r\n      if (!Array.isArray(items)) {\r\n        res.status(400).json({ error: 'Request body must be an array of records' });\r\n        return;\r\n      }\r\n      const client = createClient(req);\r\n      const created: unknown[] = [];\r\n      const skipped: { index: number; error: string }[] = [];\r\n\r\n      // check for duplicates inside the payload and invalid TTL/priority\r\n      const seen = new Set<string>();\r\n      for (let i = 0; i < items.length; i++) {\r\n        const it = items[i];\r\n        if (!it || !it.type || !it.name || !it.content) {\r\n          skipped.push({ index: i, error: 'Missing required fields' });\r\n          continue;\r\n        }\r\n        const key = `${it.type}|${it.name}|${it.content}`;\r\n        if (seen.has(key)) {\r\n          skipped.push({ index: i, error: 'Duplicate in payload' });\r\n          continue;\r\n        }\r\n        seen.add(key);\r\n        const parsed = dnsRecordSchema.safeParse(it);\r\n        if (!parsed.success) {\r\n          skipped.push({ index: i, error: parsed.error.message });\r\n          continue;\r\n        }\r\n        if (parsed.data.type === 'SPF') {\r\n          // determine fqdn using zone name from Cloudflare\r\n          let fqdn = parsed.data.name;\r\n          try {\r\n            const zones: Zone[] = await client.getZones();\r\n            const zone = zones.find((z) => z.id === req.params.zone);\r\n            const zoneName = zone ? zone.name : req.params.zone;\r\n            fqdn = (parsed.data.name === '@' || parsed.data.name === '') ? zoneName : `${parsed.data.name}.${zoneName}`;\r\n          } catch {\r\n            if (!fqdn || fqdn === '@') fqdn = parsed.data.name || req.params.zone;\r\n          }\r\n          const v = await validateSPFContentAsync(parsed.data.content ?? '', fqdn);\r\n          if (!v.ok) {\r\n            skipped.push({ index: i, error: `SPF validation failed: ${v.problems.join(', ')}` });\r\n            continue;\r\n          }\r\n        }\r\n        if (req.query.dryrun) {\r\n          // dry run: record as created but do not push to Cloudflare\r\n          created.push(parsed.data);\r\n          continue;\r\n        }\r\n        try {\r\n          // create record using client\r\n          const rec = await client.createDNSRecord(req.params.zone, parsed.data);\r\n          created.push(rec);\r\n        } catch (err) {\r\n          skipped.push({ index: i, error: (err as Error).message });\r\n        }\r\n      }\r\n\r\n      res.json({ created, skipped });\r\n      logAudit({ operation: 'dns:create_bulk', actor: actorFromReq(req), resource: `zone:${req.params.zone}`, details: { createdCount: created.length, skipped } });\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Export DNS records for a zone in a given format (json/csv/bind)\r\n   */\r\n  static exportDNSRecords() {\r\n    /**\r\n     * Express handler to export DNS records for a zone.\r\n     *\r\n     * Supports formats: json, csv, bind. Optional pagination parameters\r\n     * `page` and `per_page` are forwarded to the Cloudflare API.\r\n     */\r\n    return async (req: Request, res: Response) => {\r\n      const client = createClient(req);\r\n      const format = String(req.query.format || 'json').toLowerCase();\r\n      const page = req.query.page ? Number.parseInt(String(req.query.page), 10) : undefined;\r\n      const perPage = req.query.per_page ? Number.parseInt(String(req.query.per_page), 10) : undefined;\r\n      const records = await client.getDNSRecords(req.params.zone, page, perPage);\r\n      switch (format) {\r\n        case 'json':\r\n          res.setHeader('Content-Type', 'application/json');\r\n          res.send(JSON.stringify(records, null, 2));\r\n          logAudit({ operation: 'dns:export', actor: actorFromReq(req), resource: `zone:${req.params.zone}`, details: { format } });\r\n          return;\r\n        case 'csv':\r\n          res.setHeader('Content-Type', 'text/csv');\r\n          res.send((await import('./export-api')).recordsToCSV(records));\r\n          logAudit({ operation: 'dns:export', actor: actorFromReq(req), resource: `zone:${req.params.zone}`, details: { format } });\r\n          return;\r\n        case 'bind':\r\n          res.setHeader('Content-Type', 'text/plain');\r\n          res.send((await import('./export-api')).recordsToBIND(records));\r\n          logAudit({ operation: 'dns:export', actor: actorFromReq(req), resource: `zone:${req.params.zone}`, details: { format } });\r\n          return;\r\n        default:\r\n          res.status(400).json({ error: 'Unknown format' });\r\n      }\r\n    };\r\n  }\r\n\r\n  static simulateSPF() {\r\n    return async (req: Request, res: Response) => {\r\n      const domain = String(req.query.domain || req.body?.domain || '');\r\n      const ip = String(req.query.ip || req.body?.ip || '');\r\n      if (!domain || !ip) {\r\n        res.status(400).json({ error: 'Missing domain or ip' });\r\n        return;\r\n      }\r\n      const result = await simulateSPF({ domain, ip });\r\n      res.json(result);\r\n    };\r\n  }\r\n\r\n  static getSPFGraph() {\r\n    return async (req: Request, res: Response) => {\r\n      const domain = String(req.query.domain || req.body?.domain || '');\r\n      if (!domain) {\r\n        res.status(400).json({ error: 'Missing domain' });\r\n        return;\r\n      }\r\n      const graph = await buildSPFGraph(domain);\r\n      res.json(graph);\r\n    };\r\n  }\r\n\r\n  static storeVaultSecret() {\r\n    /**\r\n     * Store a secret into the server's configured vault.\r\n     * Requires valid Cloudflare credentials to be present in the request.\r\n     */\r\n    return async (req: Request, res: Response) => {\r\n      // Require server auth to manipulate vault secrets\r\n      createClient(req);\r\n      const id = req.params.id;\r\n      const secret = req.body && req.body.secret;\r\n      if (!id || !secret) {\r\n        res.status(400).json({ error: 'Missing id or secret' });\r\n        return;\r\n      }\r\n      await vaultManager.setSecret(String(id), String(secret));\r\n      logAudit({ operation: 'vault:store', actor: actorFromReq(req), resource: `vault:${id}` });\r\n      res.json({ success: true });\r\n    };\r\n  }\r\n\r\n  static getVaultSecret() {\r\n    /**\r\n     * Retrieve a secret from the server vault.\r\n     * Requires credentials in the request and will return 404 when not found.\r\n     */\r\n    return async (req: Request, res: Response) => {\r\n      createClient(req);\r\n      const id = req.params.id;\r\n      if (!id) {\r\n        res.status(400).json({ error: 'Missing id' });\r\n        return;\r\n      }\r\n      const secret = await vaultManager.getSecret(String(id));\r\n      if (!secret) {\r\n        res.status(404).json({ error: 'Secret not found' });\r\n        return;\r\n      }\r\n      logAudit({ operation: 'vault:retrieve', actor: actorFromReq(req), resource: `vault:${id}` });\r\n      res.json({ secret });\r\n    };\r\n  }\r\n\r\n  static deleteVaultSecret() {\r\n    /**\r\n     * Delete a secret from the server vault. Request must contain\r\n     * valid credentials and a vault id parameter.\r\n     */\r\n    return async (req: Request, res: Response) => {\r\n      createClient(req);\r\n      const id = req.params.id;\r\n      if (!id) {\r\n        res.status(400).json({ error: 'Missing id' });\r\n        return;\r\n      }\r\n      await vaultManager.deleteSecret(String(id));\r\n      logAudit({ operation: 'vault:delete', actor: actorFromReq(req), resource: `vault:${id}` });\r\n      res.json({ success: true });\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Handler to update an existing DNS record. Validates the body with\r\n   * `dnsRecordSchema` and returns the updated record.\r\n   */\r\n  static updateDNSRecord() {\r\n    /**\r\n     * @returns express RequestHandler that validates and updates a DNS record\r\n     */\r\n    return async (req: Request, res: Response) => {\r\n      const parsed = dnsRecordSchema.safeParse(req.body);\r\n      if (!parsed.success) {\r\n        res.status(400).json({\r\n          error: parsed.error.issues\r\n            .map((issue: any) => `${issue.path.join('.')}: ${issue.message}`)\r\n            .join(', '),\r\n        });\r\n        return;\r\n      }\r\n      const client = createClient(req);\r\n      const record = await client.updateDNSRecord(\r\n        req.params.zone,\r\n        req.params.id,\r\n        parsed.data,\r\n      );\r\n      logAudit({ operation: 'dns:update', actor: actorFromReq(req), resource: `zone:${req.params.zone}/record:${req.params.id}`, details: { record } });\r\n      res.json(record);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Handler to delete a DNS record and respond with { success: true }\r\n   */\r\n  static deleteDNSRecord() {\r\n    /**\r\n     * @returns express RequestHandler that deletes a DNS record\r\n     */\r\n    return async (req: Request, res: Response) => {\r\n      const client = createClient(req);\r\n      await client.deleteDNSRecord(req.params.zone, req.params.id);\r\n      logAudit({ operation: 'dns:delete', actor: actorFromReq(req), resource: `zone:${req.params.zone}/record:${req.params.id}` });\r\n      res.json({ success: true });\r\n    };\r\n  }\r\n\r\n  // Temporary in-memory store for passkey registration challenges and stored\r\n  // credentials; should be replaced by a proper verification & storage\r\n  // mechanism for production use.\r\n  private static passkeyChallenges: Map<string, string> = new Map();\r\n  private static passkeyCredentials: Map<string, unknown> = new Map();\r\n  private static credentialStore = createCredentialStore();\r\n  static setCredentialStore(store: any) {\r\n    ServerAPI.credentialStore = store;\r\n  }\r\n\r\n  static createPasskeyRegistrationOptions() {\r\n    /**\r\n     * Generate a simple challenge for WebAuthn passkey registration.\r\n     *\r\n     * Note: This implementation only provides a challenge and stores it\r\n     * in-memory. A production implementation should use a library like\r\n     * `@simplewebauthn/server` to craft proper registration options.\r\n     */\r\n    return async (req: Request, res: Response) => {\r\n      const id = req.params.id;\r\n      if (!id) {\r\n        res.status(400).json({ error: 'Missing id' });\r\n        return;\r\n      }\r\n      // Derive RP info from env or incoming host\r\n      const origin = getEnv('SERVER_ORIGIN', 'VITE_SERVER_ORIGIN', 'http://localhost:8787')!;\r\n      const rpID = new URL(origin).hostname;\r\n      const opts = swauth.generateRegistrationOptions({\r\n        rpName: 'Better Cloudflare',\r\n        rpID,\r\n        userID: id,\r\n        userName: id,\r\n      });\r\n      // Store the base64 challenge to validate later\r\n      ServerAPI.passkeyChallenges.set(id, opts.challenge);\r\n      res.json({ challenge: opts.challenge, options: opts });\r\n      logAudit({ operation: 'passkey:request_registration', actor: actorFromReq(req), resource: `passkey:${id}` });\r\n    };\r\n  }\r\n\r\n  static registerPasskey() {\r\n    /**\r\n     * Register a passkey by persisting the attestation blob in the vault and\r\n     * in-memory store. This function does not perform attestation\r\n     * verification - the stored blob should be verified before trusting it\r\n     * in a production environment.\r\n     */\r\n    return async (req: Request, res: Response) => {\r\n      const id = req.params.id;\r\n      const body = req.body;\r\n      if (!id || !body) {\r\n        res.status(400).json({ error: 'Missing id or body' });\r\n        return;\r\n      }\r\n      // Verify attestation using simplewebauthn server utilities\r\n      try {\r\n        const origin = getEnv('SERVER_ORIGIN', 'VITE_SERVER_ORIGIN', 'http://localhost:8787')!;\r\n        const rpID = new URL(origin).hostname;\r\n        const expectedChallenge = ServerAPI.passkeyChallenges.get(id);\r\n        if (!expectedChallenge) {\r\n          res.status(400).json({ error: 'No challenge found' });\r\n          return;\r\n        }\r\n        const verification = await swauth.verifyRegistrationResponse({\r\n          response: body,\r\n          expectedChallenge,\r\n          expectedOrigin: origin,\r\n          expectedRPID: rpID,\r\n        } as any);\r\n\r\n        if (!verification.verified) {\r\n          res.status(400).json({ error: 'Attestation verification failed' });\r\n          return;\r\n        }\r\n        const { registrationInfo, attestationType } = verification as any;\r\n        // Enforce attestation policy if configured\r\n        const policy = getEnv('ATTESTATION_POLICY', 'VITE_ATTESTATION_POLICY', 'none');\r\n        if (policy && policy !== 'none' && attestationType !== policy) {\r\n          res.status(400).json({ error: `Attestation type ${attestationType} does not satisfy policy ${policy}` });\r\n          return;\r\n        }\r\n        // Persist the credential(s) for future authentication checks. Store as\r\n        // an array to support multiple credentials registered per id.\r\n        // store returned from credential store; we will add the new credential\r\n        const toAdd = { credentialID: registrationInfo.credentialID ?? registrationInfo.id, credentialPublicKey: registrationInfo.credentialPublicKey ?? registrationInfo.publicKey, counter: registrationInfo.counter ?? 0 } as any;\r\n        await ServerAPI.credentialStore.addCredential(id, toAdd);\r\n        const updated = await ServerAPI.credentialStore.getCredentials(id);\r\n        ServerAPI.passkeyCredentials.set(id, updated);\r\n        ServerAPI.passkeyChallenges.delete(id);\r\n        // Audit registration success\r\n        logAudit({ operation: 'passkey:register', actor: actorFromReq(req), resource: `passkey:${id}`, details: { attestationType } });\r\n        res.json({ success: true });\r\n      } catch (err) {\r\n        res.status(400).json({ error: (err as Error).message });\r\n      }\r\n    };\r\n  }\r\n\r\n  static createPasskeyAuthOptions() {\r\n    /**\r\n     * Generate a challenge for WebAuthn authentication (assertion).\r\n     */\r\n    return async (req: Request, res: Response) => {\r\n      const id = req.params.id;\r\n      if (!id) {\r\n        res.status(400).json({ error: 'Missing id' });\r\n        return;\r\n      }\r\n      const origin = getEnv('SERVER_ORIGIN', 'VITE_SERVER_ORIGIN', 'http://localhost:8787')!;\r\n      const rpID = new URL(origin).hostname;\r\n      const creds = await ServerAPI.credentialStore.getCredentials(id);\r\n      const allowList = Array.isArray(creds) && creds.length\r\n        ? creds.map((c: any) => ({ id: c.credentialID, type: 'public-key' }))\r\n        : [];\r\n      const opts = swauth.generateAuthenticationOptions({ allowCredentials: allowList, rpID });\r\n      ServerAPI.passkeyChallenges.set(id, opts.challenge);\r\n      res.json({ challenge: opts.challenge, options: opts });\r\n      logAudit({ operation: 'passkey:request_auth', actor: actorFromReq(req), resource: `passkey:${id}` });\r\n    };\r\n  }\r\n  static listPasskeys() {\r\n    return async (req: Request, res: Response) => {\r\n      const id = req.params.id;\r\n      if (!id) {\r\n        res.status(400).json({ error: 'Missing id' });\r\n        return;\r\n      }\r\n      // require valid credentials on request\r\n      createClient(req);\r\n      const stored = await vaultManager.getSecret(`passkey:${id}`);\r\n      const creds = stored ? JSON.parse(stored) : [];\r\n      // Return credential metadata only (no private key material)\r\n      const metadata = creds.map((c: any) => ({ id: c.credentialID || c.id, counter: c.counter ?? 0 }));\r\n      res.json(metadata);\r\n      logAudit({ operation: 'passkey:list', actor: actorFromReq(req), resource: `passkey:${id}` });\r\n    };\r\n  }\r\n\r\n  static deletePasskey() {\r\n    return async (req: Request, res: Response) => {\r\n      const id = req.params.id;\r\n      const cid = req.params.cid;\r\n      if (!id || !cid) {\r\n        res.status(400).json({ error: 'Missing id or credential id' });\r\n        return;\r\n      }\r\n      // require valid credentials on request\r\n      createClient(req);\r\n      const stored = await ServerAPI.credentialStore.getCredentials(id);\r\n      if (!stored || stored.length === 0) {\r\n        res.status(404).json({ error: 'Not found' });\r\n        return;\r\n      }\r\n      const creds = stored as any[];\r\n      const filtered = creds.filter((c) => {\r\n        const key = c.credentialID || c.id;\r\n        const keyStr = typeof key === 'string' ? key : Buffer.from(key).toString('base64');\r\n        // direct match on id string\r\n        if (keyStr === cid || key === cid) return false;\r\n        // if cid is base64 encoded representation, try to decode and compare\r\n        try {\r\n          const cidDecoded = Buffer.from(cid, 'base64').toString('utf-8');\r\n          if (keyStr === cidDecoded || key === cidDecoded) return false;\r\n        } catch (_e) {\r\n          // ignore decode errors\r\n        }\r\n        return true;\r\n      });\r\n        // Save back the filtered list\r\n        // For stores that support direct set: prefer that if available, otherwise delete and re-add via store API\r\n        // We will rely on the store's deleteCredential function for simplicity and then re-add remaining.\r\n        // Clear by deleting all and re-adding for now\r\n        for (const c of creds) {\r\n          await ServerAPI.credentialStore.deleteCredential(id, c.credentialID || c.id);\r\n        }\r\n        for (const c of filtered) {\r\n          await ServerAPI.credentialStore.addCredential(id, { credentialID: c.credentialID ?? c.id, credentialPublicKey: c.credentialPublicKey ?? c.publicKey, counter: c.counter ?? 0 });\r\n        }\r\n      logAudit({ operation: 'passkey:delete', actor: actorFromReq(req), resource: `passkey:${id}`, details: { deletedCredential: cid } });\r\n      res.json({ success: true });\r\n    };\r\n  }\r\n\r\n  static getAuditEntries() {\r\n    return async (req: Request, res: Response) => {\r\n      // Allow either valid Cloudflare credentials OR the ADMIN_TOKEN header for admin access\r\n      const adminToken = getEnv('ADMIN_TOKEN', 'VITE_ADMIN_TOKEN', undefined);\r\n      const reqAdminToken = req.header('x-admin-token');\r\n      // DEBUG: log values during tests\r\n      if (getEnv('DEBUG_SERVER_API', 'VITE_DEBUG_SERVER_API', undefined)) console.debug('DEBUG getAuditEntries adminToken=', adminToken, 'reqAdminToken=', reqAdminToken);\r\n      if (!reqAdminToken || reqAdminToken !== adminToken) {\r\n        // fallback to Cloudflare credentials check\r\n        createClient(req);\r\n      }\r\n      const entries = await getAuditEntries();\r\n      logAudit({ operation: 'audit:view', actor: actorFromReq(req), resource: 'audit:index' });\r\n      res.json(entries);\r\n    };\r\n  }\r\n\r\n  static createUser() {\r\n    return async (req: Request, res: Response) => {\r\n      // require admin via ADMIN_TOKEN or Cloudflare (admin only path)\r\n      const adminToken = getEnv('ADMIN_TOKEN', 'VITE_ADMIN_TOKEN', undefined);\r\n      const reqAdmin = req.header('x-admin-token');\r\n      if (!reqAdmin || reqAdmin !== adminToken) {\r\n        res.status(403).json({ error: 'Admin token required' });\r\n        return;\r\n      }\r\n      const body = req.body;\r\n      if (!body || !body.id) {\r\n        res.status(400).json({ error: 'Missing body or id' });\r\n        return;\r\n      }\r\n      // store user record in sqlite via credential store's db if available\r\n      const store = ServerAPI.credentialStore as any;\r\n      if (store && typeof (store as any).db !== 'undefined') {\r\n        const db = (store as any).db as any;\r\n        // db is a SqliteWrapper that provides async `run`/`all`/`get` for both better-sqlite3 and sqlite3 drivers\r\n        await db.run('CREATE TABLE IF NOT EXISTS users (id TEXT PRIMARY KEY, email TEXT, roles TEXT)');\r\n        await db.run('INSERT OR REPLACE INTO users (id, email, roles) VALUES (?, ?, ?)', [body.id, body.email ?? null, JSON.stringify(body.roles ?? [])]);\r\n        res.json({ success: true });\r\n        logAudit({ operation: 'user:create', actor: actorFromReq(req), resource: `user:${body.id}`, details: { email: body.email, roles: body.roles } });\r\n        return;\r\n      }\r\n      res.status(501).json({ error: 'User management not implemented for current credential store' });\r\n    };\r\n  }\r\n\r\n  static getUser() {\r\n    return async (req: Request, res: Response) => {\r\n      const id = req.params.id;\r\n      if (!id) {\r\n        res.status(400).json({ error: 'Missing id' });\r\n        return;\r\n      }\r\n      const store = ServerAPI.credentialStore as any;\r\n      if (store && typeof (store as any).db !== 'undefined') {\r\n        const db = (store as any).db as any;\r\n        await db.run('CREATE TABLE IF NOT EXISTS users (id TEXT PRIMARY KEY, email TEXT, roles TEXT)');\r\n        const row = await db.get('SELECT id, email, roles FROM users WHERE id = ?', [id]);\r\n        if (!row) {\r\n          res.status(404).json({ error: 'Not found' });\r\n          return;\r\n        }\r\n        res.json({ id: row.id, email: row.email, roles: JSON.parse(row.roles || '[]') });\r\n        logAudit({ operation: 'user:get', actor: actorFromReq(req), resource: `user:${id}` });\r\n        return;\r\n      }\r\n      res.status(501).json({ error: 'User management not implemented for current credential store' });\r\n    };\r\n  }\r\n\r\n  static updateUserRoles() {\r\n    return async (req: Request, res: Response) => {\r\n      const adminToken = getEnv('ADMIN_TOKEN', 'VITE_ADMIN_TOKEN', undefined);\r\n      const reqAdmin = req.header('x-admin-token');\r\n      if (!reqAdmin || reqAdmin !== adminToken) {\r\n        res.status(403).json({ error: 'Admin token required' });\r\n        return;\r\n      }\r\n      const id = req.params.id;\r\n      const { roles } = req.body;\r\n      if (!id || !Array.isArray(roles)) {\r\n        res.status(400).json({ error: 'Missing id or roles' });\r\n        return;\r\n      }\r\n      const store = ServerAPI.credentialStore as any;\r\n      if (store && typeof (store as any).db !== 'undefined') {\r\n        const db = (store as any).db as any;\r\n        await db.run('CREATE TABLE IF NOT EXISTS users (id TEXT PRIMARY KEY, email TEXT, roles TEXT)');\r\n        await db.run('INSERT OR REPLACE INTO users (id, email, roles) VALUES (?, ?, ?)', [id, null, JSON.stringify(roles)]);\r\n        res.json({ success: true });\r\n        logAudit({ operation: 'user:update_roles', actor: actorFromReq(req), resource: `user:${id}`, details: { roles } });\r\n        return;\r\n      }\r\n      res.status(501).json({ error: 'User management not implemented for current credential store' });\r\n    };\r\n  }\r\n\r\n  static authenticatePasskey() {\r\n    /**\r\n     * Authenticate a passkey assertion. This stub verifies that a challenge\r\n     * exists and then accepts the assertion; proper verification against\r\n     * stored public key material should be implemented with a FIDO2\r\n     * library (e.g. `@simplewebauthn/server`).\r\n     */\r\n    return async (req: Request, res: Response) => {\r\n      const id = req.params.id;\r\n      const body = req.body;\r\n      if (!id || !body) {\r\n        res.status(400).json({ error: 'Missing id or body' });\r\n        return;\r\n      }\r\n      // In a proper implementation we'd verify the assertion using stored\r\n      // public key; here we accept the assertion if challenge matches.\r\n      try {\r\n        const origin = getEnv('SERVER_ORIGIN', 'VITE_SERVER_ORIGIN', 'http://localhost:8787')!;\r\n        const rpID = new URL(origin).hostname;\r\n        const expectedChallenge = ServerAPI.passkeyChallenges.get(id);\r\n        if (!expectedChallenge) {\r\n          res.status(400).json({ error: 'No challenge found' });\r\n          return;\r\n        }\r\n        const stored = await ServerAPI.credentialStore.getCredentials(id);\r\n        if (!stored || stored.length === 0) {\r\n          res.status(400).json({ error: 'No credential registered' });\r\n          return;\r\n        }\r\n        const credentials = stored as any[];\r\n        // Try to find matching credential from assertion rawId or fallback to first\r\n        let credential: any = credentials[0];\r\n        try {\r\n          const rawId = body.rawId || body.id || (body.response && body.response.rawId);\r\n          if (rawId) {\r\n            const rawToBase64 = (r: unknown) => {\r\n              if (typeof r === 'string') return r;\r\n              if (r instanceof Uint8Array) return Buffer.from(r).toString('base64');\r\n              if (ArrayBuffer.isView(r as any)) return Buffer.from(new Uint8Array((r as ArrayBufferLike))).toString('base64');\r\n              if (r instanceof ArrayBuffer) return Buffer.from(new Uint8Array(r)).toString('base64');\r\n              return Buffer.from(String(r)).toString('base64');\r\n            };\r\n            const rawBase64 = rawToBase64(rawId);\r\n            const found = credentials.find((c) => {\r\n              const cid = c.credentialID || c.id;\r\n              if (!cid) return false;\r\n              const cidStr = rawToBase64(cid);\r\n              return cidStr === rawBase64;\r\n            });\r\n            if (found) credential = found;\r\n          }\r\n        } catch (e) {\r\n          // ignore and fallback to first\r\n        }\r\n        // create expected credential representation\r\n        const expected = {\r\n          id: credential.credentialID || credential.id,\r\n          publicKey: credential.credentialPublicKey || credential.publicKey,\r\n          currentCounter: credential.counter ?? 0,\r\n        };\r\n        const verification = await swauth.verifyAuthenticationResponse({\r\n          response: body,\r\n          expectedChallenge,\r\n          expectedOrigin: origin,\r\n          expectedRPID: rpID,\r\n          authenticator: expected,\r\n        } as any);\r\n        if (!verification.verified) {\r\n          res.status(400).json({ error: 'Assertion verification failed' });\r\n          return;\r\n        }\r\n        // Update stored counter\r\n        const newCounter = verification.authenticationInfo?.newCounter ?? (expected.currentCounter || 0);\r\n        const credentialId = expected.id as string;\r\n        // Update the credential in store by deleting the old and adding the updated\r\n        await ServerAPI.credentialStore.deleteCredential(id, credentialId);\r\n        await ServerAPI.credentialStore.addCredential(id, { credentialID: credentialId, credentialPublicKey: expected.publicKey, counter: newCounter });\r\n        // Audit successful assertion\r\n        logAudit({ operation: 'passkey:authenticate', actor: req.header('x-auth-email') || req.header('authorization') || 'unknown', resource: `passkey:${id}` });\r\n        ServerAPI.passkeyChallenges.delete(id);\r\n        res.json({ success: true });\r\n      } catch (err) {\r\n        res.status(400).json({ error: (err as Error).message });\r\n      }\r\n    };\r\n  }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\lib\\server-client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\lib\\simplewebauthn-wrapper.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\lib\\spf.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\lib\\sqlite-driver.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[352,355],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[352,355],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[368,371],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[368,371],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[385,388],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[385,388],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[412,415],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[412,415],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":11,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":14,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[445,448],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[445,448],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[472,475],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[472,475],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":23,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":23,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[882,885],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[882,885],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[975,978],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[975,978],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1196,1199],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1196,1199],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":42,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":42,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1419,1422],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1419,1422],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":61,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1808,1811],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1808,1811],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1899,1902],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1899,1902],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1925,1928],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1925,1928],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":65,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2041,2044],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2041,2044],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":65,"column":53,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":65,"endColumn":56,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2051,2054],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2051,2054],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2320,2323],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2320,2323],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":72,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":72,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2346,2349],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2346,2349],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":74,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2454,2457],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2454,2457],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":74,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":74,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2465,2468],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2465,2468],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":80,"column":29,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":32,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2594,2597],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2594,2597],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":80,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2620,2623],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2620,2623],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":82,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2738,2741],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2738,2741],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":82,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":82,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2748,2751],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2748,2751],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":90,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":90,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2951,2954],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2951,2954],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":102,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":102,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3169,3172],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3169,3172],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":104,"column":63,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":66,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3335,3338],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3335,3338],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":104,"column":109,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":104,"endColumn":112,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3381,3384],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3381,3384],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":128,"column":97,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":128,"endColumn":100,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4569,4572],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4569,4572],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":140,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":140,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5226,5229],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5226,5229],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":142,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5344,5347],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5344,5347],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":145,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":145,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5493,5496],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5493,5496],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":147,"column":57,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":147,"endColumn":60,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5611,5614],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5611,5614],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":152,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5774,5777],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5774,5777],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":169,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":169,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6691,6694],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6691,6694],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":182,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":182,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7598,7601],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7598,7601],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":185,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":185,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7776,7779],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7776,7779],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":193,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":193,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8159,8162],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8159,8162],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":204,"column":42,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":204,"endColumn":45,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8633,8636],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8633,8636],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":222,"column":32,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":222,"endColumn":35,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9528,9531],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9528,9531],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":231,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":231,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9929,9932],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9929,9932],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":241,"column":60,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":241,"endColumn":63,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[10511,10514],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[10511,10514],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\lib\\storage-util.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\lib\\storage.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\lib\\utils.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\lib\\validation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\main.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\server\\cors.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\server\\errorHandler.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_next' is defined but never used.","line":26,"column":3,"nodeType":null,"messageId":"unusedVar","endLine":26,"endColumn":8,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\server\\router.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\server\\vault.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\types\\dns.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\types\\express.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\types\\react-window.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\src\\vite-env.d.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\tailwind.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\test\\addrecorddialog.spf.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\test\\apiErrorHandler.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\test\\benchmark.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\test\\cloudflareApi.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\test\\corsMiddleware.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\test\\cryptoManager.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\test\\dnsManagerFilter.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\test\\errorHandler.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_req' is defined but never used.","line":22,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_res' is defined but never used.","line":22,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":22,"endColumn":35},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_req' is defined but never used.","line":53,"column":25,"nodeType":null,"messageId":"unusedVar","endLine":53,"endColumn":29},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_res' is defined but never used.","line":53,"column":31,"nodeType":null,"messageId":"unusedVar","endLine":53,"endColumn":35}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import assert from 'node:assert/strict';\r\nimport { test, mock } from 'node:test';\r\nimport express from 'express';\r\n\r\nimport { asyncHandler } from '../src/lib/async-handler.ts';\r\n\r\nimport type { AddressInfo } from 'node:net';\r\n\r\nimport 'cloudflare/shims/web';\r\n\r\n// Test without custom status and debug disabled\r\n\r\ntest('default 500 status and no stack trace when debug disabled', async () => {\r\n  delete process.env.DEBUG_SERVER_API;\r\n  const { errorHandler } = await import('../src/server/errorHandler.ts?nodebug');\r\n\r\n  const log = mock.method(console, 'error', () => {});\r\n\r\n  const app = express();\r\n  app.get(\r\n    '/api/error',\r\n    asyncHandler(async (_req, _res) => {\r\n      throw new Error('boom');\r\n    }),\r\n  );\r\n  app.use(errorHandler);\r\n\r\n  const server = app.listen(0);\r\n  const { port } = server.address() as AddressInfo;\r\n  try {\r\n    const res = await fetch(`http://localhost:${port}/api/error`);\r\n    assert.equal(res.status, 500);\r\n    const data = await res.json();\r\n    assert.deepEqual(data, { error: 'boom' });\r\n    assert.equal(log.mock.calls.length, 0);\r\n  } finally {\r\n    log.mock.restore();\r\n    server.close();\r\n  }\r\n});\r\n\r\n// Test with custom status and debug enabled\r\n\r\ntest('uses custom status and logs stack trace when debug enabled', async () => {\r\n  process.env.DEBUG_SERVER_API = '1';\r\n  const { errorHandler } = await import('../src/server/errorHandler.ts?debug');\r\n\r\n  const log = mock.method(console, 'error', () => {});\r\n\r\n  const app = express();\r\n  app.get(\r\n    '/api/error',\r\n    asyncHandler(async (_req, _res) => {\r\n      const err = new Error('teapot') as Error & { status: number };\r\n      err.status = 418;\r\n      throw err;\r\n    }),\r\n  );\r\n  app.use(errorHandler);\r\n\r\n  const server = app.listen(0);\r\n  const { port } = server.address() as AddressInfo;\r\n  try {\r\n    const res = await fetch(`http://localhost:${port}/api/error`);\r\n    assert.equal(res.status, 418);\r\n    const data = await res.json();\r\n    assert.deepEqual(data, { error: 'teapot' });\r\n    assert.equal(log.mock.calls.length, 1);\r\n  } finally {\r\n    log.mock.restore();\r\n    server.close();\r\n    delete process.env.DEBUG_SERVER_API;\r\n  }\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\test\\naptr.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\test\\rbac.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":24,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":27,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[270,273],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[270,273],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":37,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":40,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[283,286],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[283,286],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":8,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":11,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[459,462],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[459,462],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[547,550],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[547,550],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[566,569],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[566,569],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[653,656],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[653,656],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":91,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":94,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[777,780],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[777,780],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1003,1006],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1003,1006],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":36,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":36,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1290,1293],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1290,1293],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1542,1545],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1542,1545],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1719,1722],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1719,1722],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":55,"column":47,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":55,"endColumn":50,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2102,2105],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2102,2105],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2443,2446],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2443,2446],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":63,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":63,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2466,2469],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2466,2469],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":14,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import assert from 'node:assert/strict';\r\nimport { test } from 'node:test';\r\nimport { ServerAPI } from '../src/lib/server-api.ts';\r\nimport { isAdmin } from '../src/lib/rbac';\r\nimport createCredentialStore from '../src/lib/credential-store.ts';\r\n\r\nfunction makeReq(body: any, params: any, headers?: Record<string, string>) {\r\n  return {\r\n    body,\r\n    params,\r\n    header(name: string) {\r\n      return (headers && headers[name]) ?? undefined;\r\n    },\r\n  } as any;\r\n}\r\n\r\nfunction makeRes() {\r\n  let statusCode: number | undefined;\r\n  let jsonData: any;\r\n  const res: any = {\r\n    status(code: number) { statusCode = code; return this; },\r\n    json(data: any) { jsonData = data; },\r\n  };\r\n  return { res, get status() { return statusCode; }, get data() { return jsonData; } } as any;\r\n}\r\n\r\ntest('RBAC: admin token or user role is required for admin endpoints', async () => {\r\n  process.env.CREDENTIAL_STORE = 'sqlite';\r\n  process.env.ADMIN_TOKEN = 'adm-token';\r\n  const store = createCredentialStore() as any;\r\n  ServerAPI.setCredentialStore(store);\r\n\r\n  // Create user via admin token\r\n  const reqCreate = makeReq({ id: 'u1', email: 'admin@example.com', roles: ['admin'] }, {}, { 'x-admin-token': 'adm-token' });\r\n  const createdRes = makeRes();\r\n  await ServerAPI.createUser()(reqCreate as any, createdRes.res);\r\n  assert.equal(createdRes.data.success, true);\r\n\r\n  // Now try to access audit without credentials -> 403\r\n  const arReq = makeReq({}, {}, {});\r\n  const arRes = makeRes();\r\n  try {\r\n    await ServerAPI.getAuditEntries()(arReq as any, arRes.res);\r\n    // Without admin token or Cloudflare creds, either 400 or 403 is acceptable\r\n    assert.ok(arRes.status === 400 || arRes.status === 403);\r\n  } catch (err: any) {\r\n    assert.equal(err.status, 400);\r\n  }\r\n\r\n  // With the admin token it works\r\n  const arReq2 = makeReq({}, {}, { 'x-admin-token': 'adm-token' });\r\n  const arRes2 = makeRes();\r\n  console.log('DEBUG adminToken env=', process.env.ADMIN_TOKEN, 'req header=', arReq2.header('x-admin-token'));\r\n  process.env.DEBUG_SERVER_API = '1';\r\n  await ServerAPI.getAuditEntries()(arReq2 as any, arRes2.res);\r\n  assert.ok(Array.isArray(arRes2.data));\r\n\r\n  // Check role-based admin via middleware: isAdmin should allow our admin user\r\n  const mwReq = makeReq({}, {}, { 'x-auth-email': 'admin@example.com' });\r\n  const mwRes = makeRes();\r\n  let called = false;\r\n  await new Promise<void>((resolve, reject) => {\r\n    isAdmin(mwReq as any, mwRes.res, (err?: any) => {\r\n      if (err) {\r\n        reject(err);\r\n      } else {\r\n        called = true;\r\n        resolve();\r\n      }\r\n    });\r\n  });\r\n  assert.equal(called, true);\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\test\\record-type-labels.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\test\\serverApiValidation.test.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[326,329],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[326,329],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[628,631],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[628,631],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[779,782],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[779,782],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":37,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":37,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1188,1191],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1188,1191],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":39,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":39,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1256,1259],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1256,1259],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":77,"column":13,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":16,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2333,2336],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2333,2336],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":80,"column":38,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":80,"endColumn":41,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2406,2409],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2406,2409],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\test\\serverBulkImport.test.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[326,329],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[326,329],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":21,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":21,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[672,675],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[672,675],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":27,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":27,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[823,826],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[823,826],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":38,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":38,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1235,1238],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1235,1238],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":40,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":40,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1306,1309],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1306,1309],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":62,"column":75,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":62,"endColumn":78,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2080,2083],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2080,2083],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":64,"column":46,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":64,"endColumn":49,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2151,2154],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2151,2154],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\test\\serverClient.spf.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":7,"column":36,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":7,"endColumn":39,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[318,321],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[318,321],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":20,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":23,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[350,353],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[350,353],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[894,897],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[894,897],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1112,1115],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1112,1115],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":22,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":22,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1136,1139],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1136,1139],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":24,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":24,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1193,1196],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1193,1196],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":6,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { test } from 'node:test';\r\nimport assert from 'node:assert/strict';\r\nimport { ServerClient } from '../src/lib/server-client';\r\n\r\ntest('ServerClient simulateSPF and getSPFGraph', async () => {\r\n  const sc = new ServerClient('', 'http://localhost:8787/api', undefined, 5000);\r\n  const originalFetch = (global as any).fetch;\r\n  const fakeFetch: any = async (url: string) => {\r\n    if (url.includes('/api/spf/simulate')) {\r\n      return new Response(JSON.stringify({ result: 'pass', reasons: ['matched ip4'], lookups: 1 }), { status: 200, headers: { 'Content-Type': 'application/json' } });\r\n    }\r\n    if (url.includes('/api/spf/graph')) {\r\n      return new Response(JSON.stringify({ nodes: [{ domain: 'example.com' }], edges: [], lookups: 1 }), { status: 200, headers: { 'Content-Type': 'application/json' } });\r\n    }\r\n    return new Response(null, { status: 404 });\r\n  };\r\n  (global as any).fetch = fakeFetch;\r\n  try {\r\n    const sim = await sc.simulateSPF('example.com', '1.2.3.4');\r\n    assert.equal(sim.result, 'pass');\r\n    const graph = await sc.getSPFGraph('example.com');\r\n    assert.ok((graph as any).nodes && (graph as any).nodes.length === 1);\r\n  } finally {\r\n    (global as any).fetch = originalFetch;\r\n  }\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\test\\serverClient.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\test\\serverPasskey.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'opts' is defined but never used.","line":81,"column":55,"nodeType":null,"messageId":"unusedVar","endLine":81,"endColumn":59},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'opts' is defined but never used.","line":117,"column":55,"nodeType":null,"messageId":"unusedVar","endLine":117,"endColumn":59}],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[642,645],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[642,645],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":15,"column":35,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":15,"endColumn":38,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[710,713],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[710,713],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[773,776],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[773,776],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":29,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":29,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1066,1069],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1066,1069],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":35,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":35,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1217,1220],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1217,1220],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":54,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":54,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1884,1887],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1884,1887],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":77,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2769,2772],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2769,2772],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":81,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2908,2911],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2908,2911],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":81,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":81,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2956,2959],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2956,2959],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":112,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":112,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4210,4213],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4210,4213],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":117,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4397,4400],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4397,4400],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":117,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":117,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4445,4448],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4445,4448],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":152,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":152,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5969,5972],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5969,5972],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":156,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":156,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6106,6109],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6106,6109],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":166,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":166,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6594,6597],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6594,6597],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":170,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":170,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6731,6734],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6731,6734],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":179,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":179,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7300,7303],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7300,7303],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":184,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":184,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7499,7502],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7499,7502],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":207,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":207,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8414,8417],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8414,8417],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":211,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":211,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8555,8558],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8555,8558],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":220,"column":14,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":220,"endColumn":17,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[9154,9157],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[9154,9157],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"/* eslint-disable @typescript-eslint/no-explicit-any */\r\nimport assert from 'node:assert/strict';\r\nimport { test } from 'node:test';\r\nimport type { Request, Response } from 'express';\r\nimport { ServerAPI } from '../src/lib/server-api.ts';\r\nimport { getAuditEntries, clearAuditEntries } from '../src/lib/audit.ts';\r\nimport { vaultManager } from '../src/server/vault.ts';\r\n\r\n// Monkey-patch simplewebauthn server verification functions to avoid\r\n// needing a real WebAuthn attestation/assertion for unit tests.\r\nimport swauth from '../src/lib/simplewebauthn-wrapper';\r\n\r\n// Store original functions to restore\r\nconst origVerifyReg = (swauth as any).verifyRegistrationResponse;\r\nconst origVerifyAuth = (swauth as any).verifyAuthenticationResponse;\r\n\r\nfunction createReq(body: any, params: Record<string, string>) {\r\n  return {\r\n    body,\r\n    params,\r\n    header(name: string) {\r\n      return name === 'authorization' ? 'Bearer token' : undefined;\r\n    },\r\n  } as unknown as Request;\r\n}\r\n\r\nfunction createRes() {\r\n  let statusCode: number | undefined;\r\n  let jsonData: any;\r\n  const res: Partial<Response> = {\r\n    status(code: number) {\r\n      statusCode = code;\r\n      return this as Response;\r\n    },\r\n    json(data: any) {\r\n      jsonData = data;\r\n    },\r\n  };\r\n  return { res: res as Response, get status() { return statusCode; }, get data() { return jsonData; } };\r\n}\r\n\r\ntest('createPasskeyRegistrationOptions returns options', async () => {\r\n  const handler = ServerAPI.createPasskeyRegistrationOptions();\r\n  const req = createReq({}, { id: 'key1' });\r\n  const res = createRes();\r\n  await handler(req, res.res);\r\n  // Should return a challenge and options\r\n  assert.ok(res.data.challenge);\r\n  assert.ok(res.data.options);\r\n});\r\n\r\ntest('registerPasskey verifies and stores credential', async () => {\r\n  // Stub verification to return a successful registration result\r\n  (swauth as any).verifyRegistrationResponse = async () => ({\r\n    verified: true,\r\n    registrationInfo: { credentialID: 'cid', credentialPublicKey: 'pk', counter: 0 },\r\n  });\r\n\r\n  const handler = ServerAPI.registerPasskey();\r\n  // First generate options to create a challenge\r\n  const start = ServerAPI.createPasskeyRegistrationOptions();\r\n  const reqStart = createReq({}, { id: 'key2' });\r\n  const resStart = createRes();\r\n  await start(reqStart, resStart.res);\r\n\r\n  const req = createReq({ id: 'key2', response: { /* dummy attestation */ } }, { id: 'key2' });\r\n  const res = createRes();\r\n  await handler(req, res.res);\r\n  assert.equal(res.data.success, true);\r\n\r\n  const secret = await vaultManager.getSecret('passkey:key2');\r\n  assert.ok(secret);\r\n  const entries = await getAuditEntries();\r\n  assert.ok(entries.some((e) => e.operation === 'passkey:register'));\r\n\r\n  // restore\r\n  (swauth as any).verifyRegistrationResponse = origVerifyReg;\r\n});\r\n\r\ntest('registerPasskey supports multiple credentials', async () => {\r\n  (swauth as any).verifyRegistrationResponse = async (opts?: any) => ({\r\n    verified: true,\r\n    registrationInfo: { credentialID: `cid-${Date.now()}`, credentialPublicKey: 'pk', counter: 0 },\r\n  });\r\n\r\n  const handler = ServerAPI.registerPasskey();\r\n  const id = 'multiKey';\r\n  const start = ServerAPI.createPasskeyRegistrationOptions();\r\n  const reqStart = createReq({}, { id });\r\n  const resStart = createRes();\r\n  await start(reqStart, resStart.res);\r\n\r\n  // Register two credentials\r\n  await handler(createReq({ id, response: {} }, { id }), createRes().res);\r\n  // Need a new challenge for the second credential\r\n  await start(reqStart, resStart.res);\r\n  await handler(createReq({ id, response: {} }, { id }), createRes().res);\r\n\r\n  const stored = await vaultManager.getSecret(`passkey:${id}`);\r\n  assert.ok(stored);\r\n  const arr = JSON.parse(stored as string);\r\n  assert.ok(Array.isArray(arr) && arr.length >= 2);\r\n\r\n  // Now fetch auth options and validate allowCredentials contains >= 2\r\n  const authOptsHandler = ServerAPI.createPasskeyAuthOptions();\r\n  const resAuth = createRes();\r\n  await authOptsHandler(createReq({}, { id }), resAuth.res);\r\n  const options = resAuth.data.options;\r\n  assert.ok(options);\r\n  assert.ok(options.allowCredentials && options.allowCredentials.length >= 2);\r\n\r\n  (swauth as any).verifyRegistrationResponse = origVerifyReg;\r\n  clearAuditEntries();\r\n});\r\n\r\ntest('listPasskeys returns stored credentials and deletePasskey removes one', async () => {\r\n  (swauth as any).verifyRegistrationResponse = async (opts?: any) => ({\r\n    verified: true,\r\n    registrationInfo: { credentialID: `cid-${Date.now()}`, credentialPublicKey: 'pk', counter: 0 },\r\n  });\r\n\r\n  const id = 'listKey';\r\n  const reg = ServerAPI.registerPasskey();\r\n  await ServerAPI.createPasskeyRegistrationOptions()(createReq({}, { id }), createRes().res);\r\n  await reg(createReq({ id, response: {} }, { id }), createRes().res);\r\n  await ServerAPI.createPasskeyRegistrationOptions()(createReq({}, { id }), createRes().res);\r\n  await reg(createReq({ id, response: {} }, { id }), createRes().res);\r\n\r\n  const listH = ServerAPI.listPasskeys();\r\n  const listRes = createRes();\r\n  await listH(createReq({}, { id }), listRes.res);\r\n  assert.ok(Array.isArray(listRes.data) && listRes.data.length >= 2);\r\n\r\n  const toDelete: string = listRes.data[0].id;\r\n  const delH = ServerAPI.deletePasskey();\r\n  const delRes = createRes();\r\n  await delH(createReq({}, { id, cid: toDelete }), delRes.res);\r\n  assert.equal(delRes.data.success, true);\r\n\r\n  const listRes2 = createRes();\r\n  await listH(createReq({}, { id }), listRes2.res);\r\n  assert.ok(listRes2.data.length === listRes.data.length - 1);\r\n  const entries2 = await getAuditEntries();\r\n  // ensure passkey:delete logged at least once\r\n  assert.ok(entries2.some((e) => (e.operation === 'passkey:delete')));\r\n  // ensure audit endpoint exposes entries when asked\r\n  const auditH = ServerAPI.getAuditEntries();\r\n  const ar = createRes();\r\n  await auditH(createReq({}, { }), ar.res);\r\n  assert.ok(Array.isArray(ar.data));\r\n\r\n  (swauth as any).verifyRegistrationResponse = origVerifyReg;\r\n});\r\n\r\ntest('registerPasskey rejects invalid attestation', async () => {\r\n  (swauth as any).verifyRegistrationResponse = async () => ({ verified: false, registrationInfo: null });\r\n  const handler = ServerAPI.registerPasskey();\r\n  const id = 'badKey';\r\n  const start = ServerAPI.createPasskeyRegistrationOptions();\r\n  const reqStart = createReq({}, { id });\r\n  const resStart = createRes();\r\n  await start(reqStart, resStart.res);\r\n  const res = createRes();\r\n  await handler(createReq({ id, response: {} }, { id }), res.res);\r\n  assert.equal(res.status, 400);\r\n  (swauth as any).verifyRegistrationResponse = origVerifyReg;\r\n});\r\n\r\ntest('registerPasskey enforces attestation policy', async () => {\r\n  (swauth as any).verifyRegistrationResponse = async () => ({ verified: true, registrationInfo: { credentialID: 'cid', credentialPublicKey: 'pk' }, attestationType: 'direct' });\r\n  process.env.ATTESTATION_POLICY = 'indirect';\r\n  const handler = ServerAPI.registerPasskey();\r\n  const id = 'policyKey';\r\n  await ServerAPI.createPasskeyRegistrationOptions()(createReq({}, { id }), createRes().res);\r\n  const res = createRes();\r\n  await handler(createReq({ id, response: {} }, { id }), res.res);\r\n  assert.equal(res.status, 400);\r\n  delete process.env.ATTESTATION_POLICY;\r\n  (swauth as any).verifyRegistrationResponse = origVerifyReg;\r\n});\r\n\r\ntest('authenticatePasskey verifies assertion', async () => {\r\n  // Stub verification to return successful authentication result\r\n  (swauth as any).verifyAuthenticationResponse = async () => ({\r\n    verified: true,\r\n    authenticationInfo: { newCounter: 1 },\r\n  });\r\n\r\n  const handler = ServerAPI.authenticatePasskey();\r\n  // store a credential in vault to simulate registered credential\r\n  await vaultManager.setSecret('passkey:key3', JSON.stringify({ credentialID: 'cid', credentialPublicKey: 'pk', counter: 0 }));\r\n  // create options to set a challenge\r\n  const start = ServerAPI.createPasskeyAuthOptions();\r\n  const reqStart = createReq({}, { id: 'key3' });\r\n  const resStart = createRes();\r\n  await start(reqStart, resStart.res);\r\n\r\n  const req = createReq({ id: 'key3', response: { /* dummy assertion */ } }, { id: 'key3' });\r\n  const res = createRes();\r\n  await handler(req, res.res);\r\n  assert.equal(res.data.success, true);\r\n\r\n  const secretNew = await vaultManager.getSecret('passkey:key3');\r\n  assert.ok(secretNew);\r\n\r\n  // restore\r\n  (swauth as any).verifyAuthenticationResponse = origVerifyAuth;\r\n});\r\n\r\ntest('authenticatePasskey rejects failed assertion', async () => {\r\n  (swauth as any).verifyAuthenticationResponse = async () => ({ verified: false, authenticationInfo: null });\r\n  const handler = ServerAPI.authenticatePasskey();\r\n  await vaultManager.setSecret('passkey:badAuth', JSON.stringify({ credentialID: 'cid', credentialPublicKey: 'pk', counter: 0 }));\r\n  const start = ServerAPI.createPasskeyAuthOptions();\r\n  const reqStart = createReq({}, { id: 'badAuth' });\r\n  await start(reqStart, createRes().res);\r\n  const res = createRes();\r\n  await handler(createReq({ id: 'badAuth', response: {} }, { id: 'badAuth' }), res.res);\r\n  assert.equal(res.status, 400);\r\n  (swauth as any).verifyAuthenticationResponse = origVerifyAuth;\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\test\\serverVault.test.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":8,"column":26,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":8,"endColumn":29,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[323,326],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[323,326],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[616,619],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[616,619],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":16,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":19,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[767,770],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[767,770],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\test\\spf-debug.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\test\\spf.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_d' is defined but never used.","line":41,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":41,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_d' is defined but never used.","line":42,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":42,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_d' is defined but never used.","line":43,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":43,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_d' is defined but never used.","line":44,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":44,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_ip' is defined but never used.","line":45,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":45,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":46,"column":8,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":46,"endColumn":11,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1715,1718],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1715,1718],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":67,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":67,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2443,2446],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2443,2446],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":68,"column":92,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":68,"endColumn":95,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2543,2546],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2543,2546],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":77,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":77,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2968,2971],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2968,2971],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":78,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":78,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3057,3060],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3057,3060],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":83,"column":84,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":83,"endColumn":87,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3376,3379],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3376,3379],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_d' is defined but never used.","line":94,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":94,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_d' is defined but never used.","line":95,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":95,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_d' is defined but never used.","line":96,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":96,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_ip' is defined but never used.","line":97,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":97,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":98,"column":8,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":98,"endColumn":11,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4045,4048],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4045,4048],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":103,"column":45,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":103,"endColumn":48,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4262,4265],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4262,4265],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_d' is defined but never used.","line":114,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":114,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_d' is defined but never used.","line":115,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":115,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_d' is defined but never used.","line":116,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":116,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_d' is defined but never used.","line":117,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":117,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_ip' is defined but never used.","line":118,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":118,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":119,"column":8,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":119,"endColumn":11,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4978,4981],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4978,4981],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_d' is defined but never used.","line":133,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":133,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_ip' is defined but never used.","line":134,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":134,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_d' is defined but never used.","line":136,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":136,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_d' is defined but never used.","line":137,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":137,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":138,"column":8,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":138,"endColumn":11,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5839,5842],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5839,5842],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_d' is defined but never used.","line":151,"column":24,"nodeType":null,"messageId":"unusedVar","endLine":151,"endColumn":26},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_ip' is defined but never used.","line":152,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":152,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_d' is defined but never used.","line":153,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":153,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_d' is defined but never used.","line":154,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":154,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_d' is defined but never used.","line":155,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":155,"endColumn":25},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":156,"column":8,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":156,"endColumn":11,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6509,6512],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6509,6512],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_d' is defined but never used.","line":183,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":183,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_d' is defined but never used.","line":184,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":184,"endColumn":24},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_d' is defined but never used.","line":185,"column":23,"nodeType":null,"messageId":"unusedVar","endLine":185,"endColumn":25},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_ip' is defined but never used.","line":186,"column":21,"nodeType":null,"messageId":"unusedVar","endLine":186,"endColumn":24},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":187,"column":8,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":187,"endColumn":11,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7671,7674],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7671,7674],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":39,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import assert from 'node:assert/strict';\r\nimport { test } from 'node:test';\r\nimport { parseSPF, composeSPF, validateSPF, SPFRecord, setDnsResolverForTest, ipMatchesCIDR } from '../src/lib/spf';\r\nimport { buildSPFGraphFromContent, validateSPFContentAsync, simulateSPF, expandSPFMacro } from '../src/lib/spf';\r\n\r\ntest('parseSPF should parse mechanisms', () => {\r\n  const input = 'v=spf1 ip4:1.2.3.0/24 include:example.com -all';\r\n  const parsed = parseSPF(input);\r\n  assert.ok(parsed);\r\n  assert.equal(parsed?.version, 'v=spf1');\r\n  assert.equal(parsed?.mechanisms.length, 3);\r\n  assert.equal(parsed?.mechanisms[0].mechanism, 'ip4');\r\n  assert.equal(parsed?.mechanisms[1].mechanism, 'include');\r\n});\r\n\r\ntest('composeSPF should create spf string from record', () => {\r\n  const rec: SPFRecord = {\r\n    version: 'v=spf1',\r\n    mechanisms: [\r\n      { mechanism: 'ip4', value: '1.2.3.0/24' },\r\n      { mechanism: 'all' }\r\n    ]\r\n  };\r\n  const s = composeSPF(rec);\r\n  assert.ok(s.startsWith('v=spf1'));\r\n});\r\n\r\ntest('validateSPF should flag errors when missing prefix', () => {\r\n  const res = validateSPF('ip4:1.2.3.4');\r\n  assert.equal(res.ok, false);\r\n});\r\n\r\ntest('validateSPF should accept valid spf', () => {\r\n  const res = validateSPF('v=spf1 ip4:1.2.3.0/24 -all');\r\n  assert.equal(res.ok, true);\r\n});\r\n\r\ntest('simulateSPF should detect ip4 pass', async () => {\r\n  const domain = 'example.local';\r\n  const mockResolver: import('../src/lib/spf').DNSResolver = {\r\n    resolveTxt: async (_d: string) => ([['v=spf1 ip4:1.2.3.0/24 -all']]),\r\n    resolve4: async (_d: string) => ['1.2.3.5'],\r\n    resolve6: async (_d: string) => [],\r\n    resolveMx: async (_d: string) => [],\r\n    reverse: async (_ip: string) => [],\r\n  } as any;\r\n  setDnsResolverForTest(mockResolver);\r\n  try {\r\n    const res = await simulateSPF({ domain, ip: '1.2.3.5' });\r\n    assert.equal(res.result, 'pass');\r\n  } finally {\r\n    setDnsResolverForTest(undefined);\r\n  }\r\n});\r\n\r\ntest('ipMatchesCIDR should support IPv6 CIDR matching', () => {\r\n  assert.ok(ipMatchesCIDR('2001:db8::1', '2001:db8::/32'));\r\n  assert.ok(!ipMatchesCIDR('2001:db9::1', '2001:db8::/32'));\r\n});\r\n\r\ntest('composeSPF and parseSPF support add/edit/remove operations', () => {\r\n  const base = 'v=spf1 ip4:1.2.3.0/24 -all';\r\n  const parsed = parseSPF(base);\r\n  assert.ok(parsed);\r\n  // add an include\r\n  const mechs = [...(parsed?.mechanisms ?? [])];\r\n  mechs.push({ mechanism: 'include', value: 'inc.example' as any });\r\n  const composed = composeSPF({ version: parsed?.version ?? 'v=spf1', mechanisms: mechs as any });\r\n  \r\n  const parsed2 = parseSPF(composed);\r\n  \r\n  assert.equal(parsed2?.mechanisms.some((m) => m.mechanism === 'include' && m.value === 'inc.example'), true);\r\n  // edit the include to ip6 value\r\n  const idx = parsed2?.mechanisms.findIndex((m) => m.mechanism === 'include') ?? -1;\r\n  if (idx >= 0 && parsed2) {\r\n    const mechs2 = [...parsed2.mechanisms];\r\n    mechs2[idx] = { mechanism: 'ip6', value: '::1/128' } as any;\r\n    const composed2 = composeSPF({ version: parsed2.version, mechanisms: mechs2 as any });\r\n    const parsed3 = parseSPF(composed2);\r\n    assert.equal(parsed3?.mechanisms.some((m) => m.mechanism === 'ip6' && m.value === '::1/128'), true);\r\n    // remove the ip6\r\n    const mechs3 = mechs2.filter((_, i) => i !== idx);\r\n    const composed3 = composeSPF({ version: parsed3.version, mechanisms: mechs3 as any });\r\n    const parsed4 = parseSPF(composed3);\r\n    assert.equal(parsed4?.mechanisms.some((m) => m.mechanism === 'ip6' && m.value === '::1/128'), false);\r\n  }\r\n});\r\n\r\ntest('buildSPFGraphFromContent should build include nodes', async () => {\r\n  const domain = 'example.org';\r\n  const content = 'v=spf1 include:inc.example -all';\r\n  const mockResolver: import('../src/lib/spf').DNSResolver = {\r\n    resolveTxt: async (d: string) => (d === 'inc.example' ? [['v=spf1 ip4:1.2.3.0/24 -all']] : []),\r\n    resolve4: async (_d: string) => [],\r\n    resolve6: async (_d: string) => [],\r\n    resolveMx: async (_d: string) => [],\r\n    reverse: async (_ip: string) => [],\r\n  } as any;\r\n  setDnsResolverForTest(mockResolver);\r\n  try {\r\n    const graph = await buildSPFGraphFromContent(domain, content);\r\n    assert.equal(graph.nodes.length >= 1, true);\r\n    const includes = graph.edges.filter((e: any) => e.type === 'include');\r\n    assert.equal(includes.length, 1);\r\n  } finally {\r\n    setDnsResolverForTest(undefined);\r\n  }\r\n});\r\n\r\ntest('validateSPFContentAsync should reject lookup limit', async () => {\r\n  const domain = 'example.org';\r\n  const content = 'v=spf1 include:one include:two include:three include:four include:five include:six include:seven include:eight include:nine include:ten include:eleven -all';\r\n  const mockResolver: import('../src/lib/spf').DNSResolver = {\r\n    resolveTxt: async (_d: string) => [['v=spf1 -all']],\r\n    resolve4: async (_d: string) => [],\r\n    resolve6: async (_d: string) => [],\r\n    resolveMx: async (_d: string) => [],\r\n    reverse: async (_ip: string) => [],\r\n  } as any;\r\n  setDnsResolverForTest(mockResolver);\r\n  try {\r\n    const res = await validateSPFContentAsync(content, domain, { maxLookups: 10 });\r\n    assert.equal(res.ok, false);\r\n    assert.ok(res.problems.some((p: string) => p.indexOf('requires') !== -1 || p.indexOf('exceeds') !== -1 || p.indexOf('DNS lookups') !== -1));\r\n  } finally {\r\n    setDnsResolverForTest(undefined);\r\n  }\r\n});\r\n\r\ntest('simulateSPF should honor ptr with forward-confirmation', async () => {\r\n  const domain = 'ptr.example';\r\n  const mockResolver: import('../src/lib/spf').DNSResolver = {\r\n    resolveTxt: async (_d: string) => ([['v=spf1 ptr:example.com -all']]),\r\n    reverse: async (_ip: string) => ['example.com'],\r\n    resolve4: async (d: string) => (d === 'example.com' ? ['1.2.3.4'] : []),\r\n    resolve6: async (_d: string) => ([]),\r\n    resolveMx: async (_d: string) => [],\r\n  } as any;\r\n  setDnsResolverForTest(mockResolver);\r\n  try {\r\n    const res = await simulateSPF({ domain, ip: '1.2.3.4' });\r\n    assert.equal(res.result, 'pass');\r\n  } finally {\r\n    setDnsResolverForTest(undefined);\r\n  }\r\n});\r\n\r\ntest('simulateSPF should not match ptr without forward-confirmation', async () => {\r\n  const domain = 'ptr.example';\r\n  const mockResolver: import('../src/lib/spf').DNSResolver = {\r\n    resolveTxt: async (_d: string) => ([['v=spf1 ptr:example.com -all']]),\r\n    reverse: async (_ip: string) => ['example.com'],\r\n    resolve4: async (_d: string) => ([]),\r\n    resolve6: async (_d: string) => ([]),\r\n    resolveMx: async (_d: string) => [],\r\n  } as any;\r\n  setDnsResolverForTest(mockResolver);\r\n  try {\r\n    const res = await simulateSPF({ domain, ip: '1.2.3.4' });\r\n    assert.equal(res.result, 'fail');\r\n  } finally {\r\n    setDnsResolverForTest(undefined);\r\n  }\r\n});\r\n\r\ntest('expandSPFMacro basic tokens', () => {\r\n  const out = expandSPFMacro('%{s} hello %{l} %{d} %{i} %% %_', { domain: 'example.com', ip: '1.2.3.4', sender: 'user@example.com' });\r\n  assert.ok(out.includes('user@example.com'));\r\n  assert.ok(out.includes('user'));\r\n  assert.ok(out.includes('example.com'));\r\n  assert.ok(out.includes('1.2.3.4'));\r\n  assert.ok(out.includes('%'));\r\n});\r\n\r\ntest('simulateSPF should include exp TXT explanation on fail', async () => {\r\n  const domain = 'exp.example';\r\n  const mockResolver: import('../src/lib/spf').DNSResolver = {\r\n    resolveTxt: async (d: string) => {\r\n      if (d === 'explain.exp.example') return [['Explanation text']];\r\n      if (d === domain) return [['v=spf1 -all exp=explain.%{d}']];\r\n      return [];\r\n    },\r\n    resolve4: async (_d: string) => [],\r\n    resolve6: async (_d: string) => [],\r\n    resolveMx: async (_d: string) => [],\r\n    reverse: async (_ip: string) => [],\r\n  } as any;\r\n  setDnsResolverForTest(mockResolver);\r\n  try {\r\n    const res = await simulateSPF({ domain, ip: '1.2.3.4' });\r\n    assert.equal(res.result, 'fail');\r\n    assert.ok(res.reasons.some((r) => String(r).includes('explain=Explanation')));\r\n  } finally {\r\n    setDnsResolverForTest(undefined);\r\n  }\r\n});\r\n\r\ntest('ipMatchesCIDR should treat IPv4-mapped IPv6 as IPv4 for IPv4 CIDRs', () => {\r\n  assert.ok(ipMatchesCIDR('::ffff:1.2.3.5', '1.2.3.0/24'));\r\n  assert.ok(!ipMatchesCIDR('::ffff:2.2.3.5', '1.2.3.0/24'));\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\test\\sqlite-driver.test.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'SqliteCredentialStore' is defined but never used.","line":4,"column":10,"nodeType":null,"messageId":"unusedVar","endLine":4,"endColumn":31},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":10,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":39},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":10,"column":41,"nodeType":"BlockStatement","messageId":"unexpected","endLine":10,"endColumn":43,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[460,460],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[618,621],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[618,621],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":17,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":17,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[890,893],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[890,893],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":23,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":23,"endColumn":39},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":23,"column":41,"nodeType":"BlockStatement","messageId":"unexpected","endLine":23,"endColumn":43,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1235,1235],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":28,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":28,"endColumn":41},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":28,"column":43,"nodeType":"BlockStatement","messageId":"unexpected","endLine":28,"endColumn":45,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[1443,1443],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":30,"column":93,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":30,"endColumn":96,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1582,1585],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1582,1585],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":31,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":31,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1631,1634],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1631,1634],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":33,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":33,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1695,1698],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1695,1698],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":34,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":34,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1732,1735],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1732,1735],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2137,2140],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2137,2140],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":43,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":43,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2169,2172],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2169,2172],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":44,"column":40,"nodeType":null,"messageId":"unusedVar","endLine":44,"endColumn":41},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":44,"column":43,"nodeType":"BlockStatement","messageId":"unexpected","endLine":44,"endColumn":45,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[2230,2230],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":17,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import assert from 'node:assert/strict';\r\nimport { test } from 'node:test';\r\nimport openSqlite from '../src/lib/sqlite-driver.ts';\r\nimport { SqliteCredentialStore } from '../src/lib/credential-store.ts';\r\nimport path from 'path';\r\nimport fs from 'fs';\r\n\r\ntest('openSqlite should return a sqlite wrapper and support basic calls', async () => {\r\n  const tmp = path.resolve(process.cwd(), 'data', 'test-credentials.db');\r\n  try { fs.unlinkSync(tmp); } catch (_) {}\r\n  const wrapper = openSqlite(tmp);\r\n  assert.ok(wrapper, 'openSqlite returned a wrapper');\r\n  assert.ok(['better-sqlite3', 'sqlite3'].includes((wrapper as any).type), 'driver type should be known');\r\n  // basic run & get & all interface\r\n  await wrapper.run('CREATE TABLE IF NOT EXISTS tmp (id INTEGER PRIMARY KEY, v TEXT)');\r\n  const res = await wrapper.run('INSERT INTO tmp(v) VALUES(?)', ['x']);\r\n  assert.ok(res && (res as any).lastInsertRowid, 'insert returns lastInsertRowid');\r\n  const row = await wrapper.get('SELECT id, v FROM tmp WHERE id = ?', [1]);\r\n  assert.equal(row.v, 'x');\r\n  const rows = await wrapper.all('SELECT id, v FROM tmp');\r\n  assert.ok(Array.isArray(rows));\r\n  if (wrapper.close) await wrapper.close();\r\n  try { fs.unlinkSync(tmp); } catch (_) {}\r\n});\r\n\r\ntest('SqliteCredentialStore can add/get/delete credentials', async () => {\r\n  const tmpDB = path.resolve(process.cwd(), 'data', 'test-credentials-2.db');\r\n  try { fs.unlinkSync(tmpDB); } catch (_) {}\r\n  process.env.CREDENTIAL_STORE = 'sqlite';\r\n  const createCredentialStore = (await import('../src/lib/credential-store.ts')).default as any;\r\n  const store = createCredentialStore() as any;\r\n  // ensure the store's init completes\r\n  await (store as any).initPromise;\r\n  await (store as any).initPromise;\r\n  const id = 'u-test';\r\n  await store.addCredential(id, { credentialID: 'cid1', credentialPublicKey: 'pk', counter: 0 });\r\n  const creds = await store.getCredentials(id);\r\n  assert.ok(Array.isArray(creds));\r\n  assert.equal(creds.length, 1);\r\n  await store.deleteCredential(id, 'cid1');\r\n  const after = await store.getCredentials(id);\r\n  assert.equal(after.length, 0);\r\n  if ((store as any).db?.close) await (store as any).db.close();\r\n  try { fs.unlinkSync(tmpDB); } catch (_) {}\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\test\\sqlite-fallback.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":10,"column":30,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":10,"endColumn":33,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[371,374],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[371,374],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'file' is defined but never used.","line":10,"column":35,"nodeType":null,"messageId":"unusedVar","endLine":10,"endColumn":39},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":11,"column":72,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":11,"endColumn":75,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[464,467],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[464,467],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[510,513],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[510,513],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[518,521],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[518,521],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[528,531],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[528,531],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":32,"column":64,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":32,"endColumn":67,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1644,1647],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1644,1647],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":48,"column":52,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":48,"endColumn":55,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2606,2609],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2606,2609],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"no-useless-escape","severity":2,"message":"Unnecessary escape character: \\'.","line":48,"column":80,"nodeType":"Literal","messageId":"unnecessaryEscape","endLine":48,"endColumn":81,"suggestions":[{"messageId":"removeEscape","fix":{"range":[2634,2635],"text":""},"desc":"Remove the `\\`. This maintains the current functionality."},{"messageId":"escapeBackslash","fix":{"range":[2634,2634],"text":"\\"},"desc":"Replace the `\\` with `\\\\` to include the actual backslash character."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":51,"column":22,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":51,"endColumn":25,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[2785,2788],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[2785,2788],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":61,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3189,3192],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3189,3192],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":61,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3197,3200],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3197,3200],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":61,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":61,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3207,3210],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3207,3210],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":70,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":70,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3664,3667],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3664,3667],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":76,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":76,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[3934,3937],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[3934,3937],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":87,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4295,4298],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4295,4298],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":87,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4303,4306],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4303,4306],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":87,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":87,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4313,4316],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4313,4316],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":95,"column":23,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":95,"endColumn":26,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4705,4708],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4705,4708],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":97,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":97,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4842,4845],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4842,4845],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":99,"column":61,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":99,"endColumn":64,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[4947,4950],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[4947,4950],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":106,"column":62,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":106,"endColumn":65,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5294,5297],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5294,5297],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":116,"column":25,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":116,"endColumn":28,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5645,5648],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5645,5648],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":118,"column":8,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":118,"endColumn":11,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[5680,5683],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[5680,5683],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":123,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":123,"endColumn":39},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":123,"column":41,"nodeType":"BlockStatement","messageId":"unexpected","endLine":123,"endColumn":43,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[5967,5967],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":129,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":129,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6212,6215],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6212,6215],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'res' is assigned a value but never used.","line":132,"column":9,"nodeType":null,"messageId":"unusedVar","endLine":132,"endColumn":12},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":136,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":136,"endColumn":39},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":136,"column":41,"nodeType":"BlockStatement","messageId":"unexpected","endLine":136,"endColumn":43,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[6621,6621],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_name' is defined but never used.","line":140,"column":22,"nodeType":null,"messageId":"unusedVar","endLine":140,"endColumn":27},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":142,"column":40,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":142,"endColumn":43,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6825,6828],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6825,6828],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":144,"column":17,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":144,"endColumn":20,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[6923,6926],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[6923,6926],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":151,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":151,"endColumn":39},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":151,"column":41,"nodeType":"BlockStatement","messageId":"unexpected","endLine":151,"endColumn":43,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[7206,7206],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":157,"column":48,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":157,"endColumn":51,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7470,7473],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7470,7473],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":158,"column":59,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":158,"endColumn":62,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7535,7538],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7535,7538],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":164,"column":33,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":164,"endColumn":36,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[7820,7823],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[7820,7823],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":173,"column":19,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":173,"endColumn":22,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8277,8280],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8277,8280],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":173,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":173,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[8307,8310],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[8307,8310],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":174,"column":38,"nodeType":null,"messageId":"unusedVar","endLine":174,"endColumn":39},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":174,"column":41,"nodeType":"BlockStatement","messageId":"unexpected","endLine":174,"endColumn":43,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[8363,8363],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":42,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import assert from 'node:assert/strict';\r\nimport { test } from 'node:test';\r\nimport path from 'path';\r\nimport fs from 'fs';\r\nimport { openSqlite } from '../src/lib/sqlite-driver.ts';\r\nimport { createRequire } from 'module';\r\nconst requireCJS = createRequire(import.meta.url);\r\n  const fakeSqlite3 = {\r\n    verbose() { return fakeSqlite3; },\r\n    Database: function(this: any, file: string) {\r\n      const dbState = { credentials: [], audit_log: [], lastID: 0 } as any;\r\n      this.run = (sql: string, params?: any[] | any, cb?: any) => {\r\n        const s = String(sql).trim().toUpperCase();\r\n        const p = Array.isArray(params) ? params : typeof params !== 'function' ? [params] : [];\r\n        // CREATE TABLE -> no-op\r\n        if (s.startsWith('CREATE TABLE')) {\r\n          if (cb) cb.call({ lastID: 0, changes: 0 }, null);\r\n          return;\r\n        }\r\n        // robust detection for INSERT INTO CREDENTIALS (including OR REPLACE and quoting)\r\n        if (s.includes('INSERT') && s.includes('INTO') && s.includes('CREDENTIALS')) {\r\n          // params: [id, credential_id, public_key, counter, created_at, label]\r\n          const [id, cid, pk, counter, createdAt, label] = p;\r\n          dbState.credentials.push({ id, credential_id: cid, credentialPublicKey: pk, counter, createdAt, label });\r\n          dbState.lastID += 1;\r\n          if (cb) cb.call({ lastID: dbState.lastID, changes: 1 }, null);\r\n          return;\r\n        }\r\n        if (/DELETE\\s+FROM\\s+CREDENTIALS/i.test(sql)) {\r\n          const [id, cid] = p;\r\n          const before = dbState.credentials.length;\r\n          dbState.credentials = dbState.credentials.filter((r: any) => !(r.id === id && r.credential_id === cid));\r\n          dbState.lastID += 1;\r\n          if (cb) cb.call({ lastID: dbState.lastID, changes: before - dbState.credentials.length }, null);\r\n          return;\r\n        }\r\n        if (s.startsWith('INSERT INTO AUDIT_LOG')) {\r\n          const [actor, operation, resource, details, timestamp] = p;\r\n          dbState.audit_log.unshift({ id: ++dbState.lastID, actor, operation, resource, details, timestamp });\r\n          if (cb) cb.call({ lastID: dbState.lastID, changes: 1 }, null);\r\n          return;\r\n        }\r\n        // generic INSERT into arbitrary tables (e.g. t)\r\n        if (s.startsWith('INSERT INTO') && !s.includes('CREDENTIALS') && !s.includes('AUDIT_LOG')) {\r\n          // naive parse: INSERT INTO table(columns...) VALUES(...)\r\n          const m = sql.match(/INSERT INTO\\s+([\\w.]+)\\s*\\(([^)]+)\\)/i);\r\n          const tbl = m ? m[1] : 'unknown';\r\n          const cols = m ? m[2].split(',').map((c: any) => c.trim().replace(/\"|\\'|`/g, '')) : [];\r\n          dbState.tables = dbState.tables ?? {};\r\n          dbState.tables[tbl] = dbState.tables[tbl] ?? [];\r\n          const obj: any = { id: ++dbState.lastID };\r\n          for (let i = 0; i < cols.length; i++) obj[cols[i]] = p[i];\r\n          dbState.tables[tbl].push(obj);\r\n          if (cb) cb.call({ lastID: dbState.lastID, changes: 1 }, null);\r\n          return;\r\n        }\r\n\r\n        // default fallback\r\n        if (cb) cb.call({ lastID: dbState.lastID, changes: 0 }, null);\r\n      };\r\n        this.get = (sql: string, params?: any[] | any, cb?: any) => {\r\n          const s = String(sql).trim().toUpperCase();\r\n          const p = Array.isArray(params) ? params : [params];\r\n          // generic SELECT id... FROM table WHERE id = ?\r\n          const m = sql.match(/FROM\\s+([\\w.]+)\\s+WHERE\\s+id\\s*=\\s*\\?/i);\r\n          if (m) {\r\n            const tbl = m[1];\r\n            const id = p[0];\r\n            dbState.tables = dbState.tables ?? {};\r\n            const row = (dbState.tables[tbl] || []).find((r: any) => r.id === id);\r\n            if (cb) cb(null, row);\r\n            return;\r\n          }\r\n          if (s.startsWith('SELECT CREDENTIAL_ID') || s.includes('FROM CREDENTIALS')) {\r\n            const id = p[0];\r\n            const row = id ? dbState.credentials.find((r: any) => r.id === id) : dbState.credentials[0];\r\n            if (cb) cb(null, row);\r\n            return;\r\n          }\r\n        if (s.startsWith('SELECT ID, ACTOR')) {\r\n          const row = dbState.audit_log[0];\r\n          if (cb) cb(null, row);\r\n          return;\r\n        }\r\n        if (cb) cb(null, null);\r\n      };\r\n        this.all = (sql: string, params?: any[] | any, cb?: any) => {\r\n          const s = String(sql).trim().toUpperCase();\r\n          // generic SELECT id... FROM table WHERE id = ?\r\n          const m = sql.match(/FROM\\s+([\\w.]+)\\s+WHERE\\s+id\\s*=\\s*\\?/i);\r\n          if (m) {\r\n            const tbl = m[1];\r\n            const id = Array.isArray(params) ? params[0] : params;\r\n            dbState.tables = dbState.tables ?? {};\r\n            let rows: any[] = [];\r\n            if (String(tbl).toLowerCase() === 'credentials') {\r\n              rows = (dbState.credentials || []).filter((r: any) => r.id === id);\r\n            } else {\r\n              rows = (dbState.tables[tbl] || []).filter((r: any) => r.id === id);\r\n            }\r\n            if (cb) cb(null, rows);\r\n            return;\r\n          }\r\n          if (s.startsWith('SELECT CREDENTIAL_ID') || s.includes('FROM CREDENTIALS')) {\r\n            const id = Array.isArray(params) && params.length ? params[0] : undefined;\r\n            const rows = id ? dbState.credentials.filter((r: any) => r.id === id) : dbState.credentials;\r\n            if (cb) cb(null, rows);\r\n            return;\r\n          }\r\n        if (s.startsWith('SELECT ID, ACTOR, OPERATION') || s.includes('FROM AUDIT_LOG')) {\r\n          if (cb) cb(null, dbState.audit_log);\r\n          return;\r\n        }\r\n        if (cb) cb(null, []);\r\n      };\r\n      this.close = (cb: any) => cb?.(null);\r\n    }\r\n  } as any;\r\nimport { SqliteCredentialStore } from '../src/lib/credential-store.ts';\r\n\r\ntest('openSqlite falls back to sqlite3 when better-sqlite3 is not available', async () => {\r\n  const tmp = path.resolve(process.cwd(), 'data', 'test-fallback.db');\r\n  try { fs.unlinkSync(tmp); } catch (_) {}\r\n  const requireFn = (name: string) => {\r\n     if (name === 'better-sqlite3') throw new Error('not found');\r\n     if (name === 'sqlite3') return fakeSqlite3; \r\n    return requireCJS(name);\r\n  };\r\n  const wrapper = openSqlite(tmp, requireFn as any);\r\n  assert.equal(wrapper.type, 'sqlite3');\r\n  await wrapper.run('CREATE TABLE IF NOT EXISTS t (id INTEGER PRIMARY KEY, name TEXT)');\r\n  const res = await wrapper.run('INSERT INTO t(name) VALUES(?)', ['x']);\r\n  const row = await wrapper.get('SELECT id, name FROM t WHERE id = ?', [1]);\r\n  assert.equal(row.name, 'x');\r\n  if (wrapper.close) await wrapper.close();\r\n  try { fs.unlinkSync(tmp); } catch (_) {}\r\n});\r\n\r\ntest('openSqlite throws when no sqlite driver available', async () => {\r\n  const requireFn = (_name: string) => { throw new Error('missing'); };\r\n  try {\r\n    openSqlite(undefined, requireFn as any);\r\n    assert.fail('openSqlite should throw when both drivers unavailable');\r\n  } catch (err: any) {\r\n    assert.ok(err.message.includes('No sqlite driver available'));\r\n  }\r\n});\r\n\r\ntest('SqliteCredentialStore works with injected sqlite3 wrapper', async () => {\r\n  const tmp = path.resolve(process.cwd(), 'data', 'test-credstore.db');\r\n  try { fs.unlinkSync(tmp); } catch (_) {}\r\n  const requireFn = (name: string) => {\r\n     if (name === 'better-sqlite3') throw new Error('not found');\r\n     if (name === 'sqlite3') return fakeSqlite3;\r\n    return createRequire(import.meta.url)(name);\r\n  };\r\n  const wrapper = openSqlite(tmp, requireFn as any);\r\n  const store = new SqliteCredentialStore(tmp, wrapper as any);\r\n  await store.initPromise;\r\n  const id = 'u-test-fb';\r\n  await store.addCredential(id, { credentialID: 'c1', credentialPublicKey: 'pk1' });\r\n  const list = await store.getCredentials(id);\r\n  // debug: also check raw DB wrapper for inserted rows\r\n  const raw = await (wrapper as any).all('SELECT * FROM credentials');\r\n  console.debug('raw rows', raw);\r\n  assert.equal(list.length, 1);\r\n  await store.writeAudit({ actor: 'test', operation: 'test-op', resource: 'r1', details: {} });\r\n  const audits = await store.getAuditEntries();\r\n  assert.ok(Array.isArray(audits) && audits.length >= 1);\r\n  await store.deleteCredential(id, 'c1');\r\n  const after = await store.getCredentials(id);\r\n  assert.equal(after.length, 0);\r\n  if ((wrapper as any).close) await (wrapper as any).close();\r\n  try { fs.unlinkSync(tmp); } catch (_) {}\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\test\\sqliteCredentialStore.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":12,"column":41,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":12,"endColumn":44,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[511,514],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[511,514],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_' is defined but never used.","line":21,"column":85,"nodeType":null,"messageId":"unusedVar","endLine":21,"endColumn":86},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":21,"column":88,"nodeType":"BlockStatement","messageId":"unexpected","endLine":21,"endColumn":90,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[913,913],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import assert from 'node:assert/strict';\r\nimport { test } from 'node:test';\r\nimport createCredentialStore from '../src/lib/credential-store.ts';\r\nimport { unlinkSync } from 'fs';\r\nimport path from 'path';\r\n\r\ntest('sqlite credential store add/get/delete', async () => {\r\n  process.env.CREDENTIAL_STORE = 'sqlite';\r\n  const store = createCredentialStore();\r\n  const id = 'test-sqlite-1';\r\n  const cred = { credentialID: 'cid-1', credentialPublicKey: 'pk-1', counter: 0 };\r\n  await store.addCredential(id, cred as any);\r\n  let got = await store.getCredentials(id);\r\n  assert.ok(Array.isArray(got));\r\n  assert.equal(got.length, 1);\r\n  assert.equal(got[0].credentialID, 'cid-1');\r\n  await store.deleteCredential(id, 'cid-1');\r\n  got = await store.getCredentials(id);\r\n  assert.equal(got.length, 0);\r\n  // cleanup DB file created\r\n  try { unlinkSync(path.resolve(process.cwd(), 'data', 'credentials.db')); } catch (_) {}\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\test\\storageManager.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\test\\storagePref.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\test\\useCloudflareApi.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\test\\userManagement.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":9,"column":44,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":9,"endColumn":47,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[403,406],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[403,406],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":13,"column":170,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":13,"endColumn":173,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[717,720],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[717,720],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":28,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":31,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[750,753],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[750,753],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":43,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":46,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[765,768],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[765,768],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":95,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":98,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[817,820],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[817,820],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":129,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":132,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[851,854],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[851,854],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":14,"column":141,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":14,"endColumn":144,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[863,866],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[863,866],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":19,"column":82,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":19,"endColumn":85,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1070,1073],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1070,1073],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":31,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":34,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1106,1109],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1106,1109],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":49,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":52,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1124,1127],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1124,1127],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":104,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":107,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1179,1182],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1179,1182],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":141,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":144,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1216,1219],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1216,1219],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":20,"column":153,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":20,"endColumn":156,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1228,1231],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1228,1231],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'name' is defined but never used.","line":25,"column":80,"nodeType":null,"messageId":"unusedVar","endLine":25,"endColumn":84},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":25,"column":125,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":25,"endColumn":128,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1490,1493],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1490,1493],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":34,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":37,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1529,1532],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1529,1532],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":55,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":58,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1550,1553],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1550,1553],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":113,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":116,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1608,1611],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1608,1611],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":153,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":156,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1648,1651],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1648,1651],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]},{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":26,"column":165,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":26,"endColumn":168,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1660,1663],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1660,1663],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":20,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import assert from 'node:assert/strict';\r\nimport { test } from 'node:test';\r\nimport { ServerAPI } from '../src/lib/server-api.ts';\r\nimport createCredentialStore from '../src/lib/credential-store.ts';\r\n\r\ntest('admin user creation and roles update (sqlite)', async () => {\r\n  process.env.CREDENTIAL_STORE = 'sqlite';\r\n  process.env.ADMIN_TOKEN = 'admin-token';\r\n  const store = createCredentialStore() as any;\r\n  // ensure ServerAPI uses sqlite store in tests\r\n  ServerAPI.setCredentialStore(store);\r\n  const handlerCreate = ServerAPI.createUser();\r\n  const req = { body: { id: 'u1', email: 'u1@example.com', roles: ['user'] }, header(name: string) { return name === 'x-admin-token' ? 'admin-token' : undefined; } } as any;\r\n  const res = { json(data: any) { (res as any).data = data; }, status(code: number) { (res as any).status = code; return res as any; } } as any;\r\n  await handlerCreate(req, res);\r\n  assert.equal(res.data.success, true);\r\n\r\n  const handlerGet = ServerAPI.getUser();\r\n  const reqGet = { params: { id: 'u1' }, header() { return 'admin-token'; } } as any;\r\n  const resGet = { json(data: any) { (resGet as any).data = data; }, status(code: number) { (resGet as any).status = code; return resGet as any; } } as any;\r\n  await handlerGet(reqGet, resGet);\r\n  assert.equal(resGet.data.id, 'u1');\r\n\r\n  const handlerUpdate = ServerAPI.updateUserRoles();\r\n  const reqUpdate = { params: { id: 'u1' }, body: { roles: ['admin'] }, header(name: string) { return 'admin-token'; } } as any;\r\n  const resUpdate = { json(data: any) { (resUpdate as any).data = data; }, status(code: number) { (resUpdate as any).status = code; return resUpdate as any; } } as any;\r\n  await handlerUpdate(reqUpdate, resUpdate);\r\n  assert.equal(resUpdate.data.success, true);\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\test\\validation-debug-spf.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\test\\validation-mx-srv.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\test\\validation-naptr.test.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\test\\validation.test.ts","messages":[{"ruleId":"@typescript-eslint/no-explicit-any","severity":2,"message":"Unexpected any. Specify a different type.","line":28,"column":51,"nodeType":"TSAnyKeyword","messageId":"unexpectedAny","endLine":28,"endColumn":54,"suggestions":[{"messageId":"suggestUnknown","fix":{"range":[1567,1570],"text":"unknown"},"desc":"Use `unknown` instead, this will force you to explicitly, and safely assert the type is correct."},{"messageId":"suggestNever","fix":{"range":[1567,1570],"text":"never"},"desc":"Use `never` instead, this is useful when instantiating generic type parameters that you don't need to know the type of."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import assert from 'node:assert/strict';\r\nimport { test } from 'node:test';\r\nimport { RECORD_TYPES } from '../src/types/dns';\r\nimport { dnsRecordSchema } from '../src/lib/validation';\r\n\r\ntest('dnsRecordSchema accepts all known record types', () => {\r\n  for (const t of RECORD_TYPES) {\r\n    const base: Record<string, unknown> = { type: t, name: 'test', content: 'x', ttl: 'auto' };\r\n    // provide sane defaults for types that require specific content\r\n    if (t === 'A') base.content = '1.2.3.4';\r\n    if (t === 'AAAA') base.content = '::1';\r\n    if (t === 'MX') { base.content = 'mail.example.com'; base.priority = 10; }\r\n    if (t === 'SRV') base.content = '10 5 8080 host.example.com';\r\n    if (['CNAME', 'NS', 'PTR', 'ALIAS', 'ANAME', 'DS', 'DNSKEY', 'DNAME', 'CDNSKEY'].includes(t)) base.content = 'example.com';\r\n    if (t === 'SPF') base.content = 'v=spf1 ip4:1.2.3.0/24 -all';\r\n    if (t === 'NAPTR') base.content = '10 20 A S ! example.com';\r\n    if (['TXT', 'CERT', 'URI', 'SVCB', 'HTTPS', 'HINFO', 'LOC', 'RP', 'CAA', 'AFSDB', 'APL', 'DCHID', 'HIP', 'IPSECKEY', 'NSEC', 'RRSIG'].includes(t)) base.content = 'x';\r\n    if (t === 'SSHFP') base.content = '1 1 123abc';\r\n    if (t === 'TLSA') base.content = '3 1 1 a1b2c3';\r\n    if (t === 'SOA') base.content = 'ns.example.com hostmaster.example.com 1 7200 3600 1209600 3600';\r\n    if (t === 'MX') {\r\n      base.content = 'mail.example.com';\r\n      base.priority = 10;\r\n    }\r\n    if (t === 'SRV') {\r\n      base.content = '10 5 8080 host.example.com';\r\n    }\r\n    const res = dnsRecordSchema.safeParse(base as any);\r\n    assert.ok(res.success, `type ${t} should be valid`);\r\n  }\r\n});\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\vite.config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Projects\\better-cloudflare\\vite.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
